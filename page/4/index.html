<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="正忙着优秀~~~"><meta name="keywords" content><meta name="author" content="YoungDream,undefined"><meta name="copyright" content="YoungDream"><title>小小搬砖工【YD Blog】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon-16x16-user.png"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!--link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!--link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!--script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"0BGAOITLJQ","apiKey":"2c864a8b4720c83c2ddfc7e53d4c1711","indexName":"article_NAME","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="author-info"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/user.jpg"></div><div class="author-info-name">YoungDream</div><div class="author-info-description">正忙着优秀~~~</div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/qq994300880" target="_blank">GitHub<i class="icon-dot bg-color4"></i></a><a class="links-button button-hover" href="http://wpa.qq.com/msgrd?v=3&amp;uin=994300880&amp;site=qq&amp;menu=yes" target="_blank">QQ<i class="icon-dot bg-color5"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">53</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">65</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">10</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">YD Blog</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><div id="recent-posts"><!-- each post in page.posts.sort('date', -1).limit(10).toArray()--><!-- config中配置按照什么排序--><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-NoSQL数据库/">使用SpringBoot-NoSQL数据库</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/database/">database</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/nosql/">nosql</a></div></div><div class="post-content"><div class="main-content content"><h1 id="NoSQL-Technologies"><a href="#NoSQL-Technologies" class="headerlink" title="NoSQL Technologies"></a>NoSQL Technologies</h1><p>Spring Data提供了其他项目，可帮助您访问各种NoSQL技术，包括： <a href="https://projects.spring.io/spring-data-mongodb/" target="_blank" rel="noopener">MongoDB</a>， <a href="https://projects.spring.io/spring-data-neo4j/" target="_blank" rel="noopener">Neo4J</a>， <a href="https://github.com/spring-projects/spring-data-elasticsearch/" target="_blank" rel="noopener">Elasticsearch</a>， <a href="https://projects.spring.io/spring-data-solr/" target="_blank" rel="noopener">Solr</a>， <a href="https://projects.spring.io/spring-data-redis/" target="_blank" rel="noopener">Redis</a>， <a href="https://projects.spring.io/spring-data-gemfire/" target="_blank" rel="noopener">Gemfire</a>， <a href="https://projects.spring.io/spring-data-cassandra/" target="_blank" rel="noopener">Cassandra</a>， <a href="https://projects.spring.io/spring-data-couchbase/" target="_blank" rel="noopener">Couchbase</a>和<a href="https://projects.spring.io/spring-data-ldap/" target="_blank" rel="noopener">LDAP</a>。Spring Boot为Redis，MongoDB，Neo4j，Elasticsearch，Solr Cassandra，Couchbase和LDAP提供自动配置。您可以使用其他项目，但必须自己配置它们。请参阅<a href="https://projects.spring.io/spring-data" target="_blank" rel="noopener">projects.spring.io/spring-data</a>上的相应参考文档 。</p>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p><a href="http://redis.io/" target="_blank" rel="noopener">Redis</a>是一个缓存，消息代理和功能丰富的键值存储。Spring Boot为<a href="https://github.com/lettuce-io/lettuce-core/" target="_blank" rel="noopener">Lettuce</a>和 <a href="https://github.com/xetorthio/jedis/" target="_blank" rel="noopener">Jedis</a>客户端库提供了基本的自动配置， 并为<a href="https://github.com/spring-projects/spring-data-redis" target="_blank" rel="noopener">Spring Data Redis</a>提供了它们之外的抽象。</p>
<p>有一个<code>spring-boot-starter-data-redis</code>“Starter”用于以方便的方式收集依赖项。默认情况下，它使用 <a href="https://github.com/lettuce-io/lettuce-core/" target="_blank" rel="noopener">Lettuce</a>。该启动器处理传统和反应应用程序。</p>
<blockquote>
<p>我们还提供一个<code>spring-boot-starter-data-redis-reactive</code>启动器，以便与其他具有反应支持的商店保持一致。</p>
</blockquote>
<h3 id="连接到Redis"><a href="#连接到Redis" class="headerlink" title="连接到Redis"></a>连接到Redis</h3><p>你可以注入的自动配置<code>RedisConnectionFactory</code>，<code>StringRedisTemplate</code>或香草<code>RedisTemplate</code>，就像任何其他的Spring Bean实例。默认情况下，实例尝试连接到Redis服务器<code>localhost:6379</code>。以下清单显示了这样一个bean的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> StringRedisTemplate template;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(StringRedisTemplate template)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.template = template;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>您还可以注册任意数量的bean，以实现 <code>LettuceClientConfigurationBuilderCustomizer</code>更高级的自定义。如果您使用Jedis，<code>JedisClientConfigurationBuilderCustomizer</code>也可以使用。</p>
</blockquote>
<p>如果您添加自己<code>@Bean</code>的任何自动配置类型，它将替换默认值（除非在<code>RedisTemplate</code>排除基于bean名称时 <code>redisTemplate</code>，而不是其类型）。默认情况下，如果<code>commons-pool2</code>在类路径上，则会获得池化连接工厂。</p>
<h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><p><a href="https://www.mongodb.com/" target="_blank" rel="noopener">MongoDB</a>是一个开源的NoSQL文档数据库，它使用类似JSON的模式而不是传统的基于表的关系数据。Spring Boot提供了一些使用MongoDB的便利，包括<code>spring-boot-starter-data-mongodb</code>和<code>spring-boot-starter-data-mongodb-reactive</code> 启动器。</p>
<h3 id="连接到MongoDB数据库"><a href="#连接到MongoDB数据库" class="headerlink" title="连接到MongoDB数据库"></a>连接到MongoDB数据库</h3><p>要访问Mongo数据库，可以注入自动配置 <code>org.springframework.data.mongodb.MongoDbFactory</code>。默认情况下，实例尝试连接到MongoDB服务器<code>mongodb://localhost/test</code>。以下示例显示如何连接到MongoDB数据库：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.MongoDbFactory;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.DB;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> MongoDbFactory mongo;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(MongoDbFactory mongo)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mongo = mongo;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">example</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DB db = mongo.getDb();</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您可以设置该<code>spring.data.mongodb.uri</code>属性以更改URL并配置其他设置，例如<em>副本集</em>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.data.mongodb.uri=mongodb://user:secret@mongo1.example.com:12345,mongo2.example.com:23456/test</span><br></pre></td></tr></table></figure>
<p>或者，只要您使用Mongo 2.x，就可以指定<code>host</code>/ <code>port</code>。例如，您可以在以下内容中声明以下设置<code>application.properties</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.data.mongodb.host=mongoserver</span><br><span class="line">spring.data.mongodb.port=27017</span><br></pre></td></tr></table></figure>
<p>如果您已经定义了自己的<code>MongoClient</code>，它将用于自动配置合适的 <code>MongoDbFactory</code>。这两个<code>com.mongodb.MongoClient</code>和<code>com.mongodb.client.MongoClient</code> 支持。</p>
<blockquote>
<p>如果使用蒙戈3.0 Java驱动程序，<code>spring.data.mongodb.host</code>并且 <code>spring.data.mongodb.port</code>不支持。在这种情况下，<code>spring.data.mongodb.uri</code> 应该用于提供所有配置。</p>
</blockquote>
<blockquote>
<p>如果<code>spring.data.mongodb.port</code>未指定，<code>27017</code>则使用默认值。您可以从前面显示的示例中删除此行。</p>
</blockquote>
<blockquote>
<p>如果您不使用Spring Data Mongo，则可以注入<code>com.mongodb.MongoClient</code>bean而不是使用<code>MongoDbFactory</code>。如果要完全控制建立MongoDB连接，还可以声明自己的 bean <code>MongoDbFactory</code>或<code>MongoClient</code>bean。</p>
</blockquote>
<blockquote>
<p>如果您使用的是反应式驱动程序，则SSL需要Netty。如果Netty可用并且尚未自定义要使用的工厂，则自动配置会自动配置此工厂。</p>
</blockquote>
<h3 id="MongoTemplate"><a href="#MongoTemplate" class="headerlink" title="MongoTemplate"></a>MongoTemplate</h3><p><a href="https://projects.spring.io/spring-data-mongodb/" target="_blank" rel="noopener">Spring Data MongoDB</a>提供了一个<a href="https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/MongoTemplate.html" target="_blank" rel="noopener"><code>MongoTemplate</code></a>与Spring的设计非常相似的 类<code>JdbcTemplate</code>。与此同时<code>JdbcTemplate</code>，Spring Boot会自动为您配置一个bean来注入模板，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> MongoTemplate mongoTemplate;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(MongoTemplate mongoTemplate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mongoTemplate = mongoTemplate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有关完整的详细信息，请参阅 <a href="https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/MongoOperations.html" target="_blank" rel="noopener"><code>MongoOperations</code> Javadoc</a>。</p>
<h3 id="Spring-Data-MongoDB存储库"><a href="#Spring-Data-MongoDB存储库" class="headerlink" title="Spring Data MongoDB存储库"></a>Spring Data MongoDB存储库</h3><p>Spring Data包括MongoDB的存储库支持。与前面讨论的JPA存储库一样，基本原则是基于方法名称自动构造查询。</p>
<p>事实上，Spring Data JPA和Spring Data MongoDB共享相同的通用基础架构。您可以从之前获取JPA示例，并假设它<code>City</code>现在是Mongo数据类而不是JPA <code>@Entity</code>，它的工作方式相同，如下例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CityRepository</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">City</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">Page&lt;City&gt; <span class="title">findAll</span><span class="params">(Pageable pageable)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">City <span class="title">findByNameAndStateAllIgnoringCase</span><span class="params">(String name, String state)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>您可以使用<code>@EntityScan</code>注释自定义文档扫描位置。</p>
</blockquote>
<blockquote>
<p>有关Spring Data MongoDB的完整详细信息，包括其丰富的对象映射技术，请参阅其<a href="https://projects.spring.io/spring-data-mongodb/" target="_blank" rel="noopener">参考文档</a>。</p>
</blockquote>
<h3 id="嵌入式Mongo"><a href="#嵌入式Mongo" class="headerlink" title="嵌入式Mongo"></a>嵌入式Mongo</h3><p>Spring Boot为<a href="https://github.com/flapdoodle-oss/de.flapdoodle.embed.mongo" target="_blank" rel="noopener">Embedded Mongo</a>提供自动配置 。要在Spring Boot应用程序中使用它，请添加依赖项 <code>de.flapdoodle.embed:de.flapdoodle.embed.mongo</code>。</p>
<p>可以通过设置<code>spring.data.mongodb.port</code> 属性来配置Mongo侦听的端口。要使用随机分配的空闲端口，请使用值0. <code>MongoClient</code> 创建者<code>MongoAutoConfiguration</code>自动配置为使用随机分配的端口。</p>
<blockquote>
<p>如果未配置自定义端口，则默认情况下，嵌入式支持使用随机端口（而不是27017）。</p>
</blockquote>
<p>如果类路径上有SLF4J，则Mongo生成的输出会自动路由到名为的记录器<code>org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongo</code>。</p>
<p>您可以声明自己的bean <code>IMongodConfig</code>和<code>IRuntimeConfig</code>bean来控制Mongo实例的配置和日志记录路由。</p>
<h2 id="Neo4j"><a href="#Neo4j" class="headerlink" title="Neo4j"></a>Neo4j</h2><p><a href="http://neo4j.com/" target="_blank" rel="noopener">Neo4j</a>是一个开源的NoSQL图形数据库，它使用由一级关系连接的节点的丰富数据模型，与传统的RDBMS方法相比，它更适合于连接的大数据。Spring Boot为使用Neo4j提供了一些便利，包括<code>spring-boot-starter-data-neo4j</code> 启动器。</p>
<h3 id="连接到Neo4j数据库"><a href="#连接到Neo4j数据库" class="headerlink" title="连接到Neo4j数据库"></a>连接到Neo4j数据库</h3><p>要访问Neo4j服务器，您可以注入自动配置 <code>org.neo4j.ogm.session.Session</code>。默认情况下，实例尝试<code>localhost:7687</code>使用Bolt协议连接到Neo4j服务器。以下示例显示了如何注入Neo4j <code>Session</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Session session;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.session = session;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您可以通过设置<code>spring.data.neo4j.*</code> 属性来配置要使用的URI和凭据，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.data.neo4j.uri=bolt://my-server:7687</span><br><span class="line">spring.data.neo4j.username=neo4j</span><br><span class="line">spring.data.neo4j.password=secret</span><br></pre></td></tr></table></figure>
<p>您可以通过添加a来完全控制会话创建 <code>org.neo4j.ogm.config.Configuration</code> <code>@Bean</code>。此外，添加一个<code>@Bean</code>类型 <code>SessionFactory</code>会禁用自动配置并为您提供完全控制。</p>
<h3 id="使用嵌入模式"><a href="#使用嵌入模式" class="headerlink" title="使用嵌入模式"></a>使用嵌入模式</h3><p>如果添加<code>org.neo4j:neo4j-ogm-embedded-driver</code>到应用程序的依赖项，Spring Boot会自动配置Neo4j的进程内嵌入式实例，该应用程序在应用程序关闭时不会保留任何数据。</p>
<blockquote>
<p>由于嵌入式Neo4j OGM驱动程序本身不提供Neo4j内核，因此您必须自己声明<code>org.neo4j:neo4j</code>为依赖项。有关兼容版本的列表，请参阅 <a href="https://neo4j.com/docs/ogm-manual/current/reference/#reference:getting-started" target="_blank" rel="noopener">Neo4j OGM文档</a>。</p>
</blockquote>
<p>当类路径上有多个驱动程序时，嵌入式驱动程序优先于其他驱动程序。您可以通过设置明确禁用嵌入模式 <code>spring.data.neo4j.embedded.enabled=false</code>。</p>
<p>如果嵌入式驱动程序和Neo4j内核如上所述位于类路径上，则<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-neo4j-test" target="_blank" rel="noopener">数据Neo4j测试会</a>自动使用嵌入式Neo4j实例。</p>
<blockquote>
<p>您可以通过在配置中提供数据库文件的路径来为嵌入模式启用持久性，例如<code>spring.data.neo4j.uri=file://var/tmp/graph.db</code>。</p>
</blockquote>
<h3 id="Neo4jSession"><a href="#Neo4jSession" class="headerlink" title="Neo4jSession"></a>Neo4jSession</h3><p>默认情况下，如果您正在运行Web应用程序，则会话将绑定到线程以进行整个请求处理（即，它使用“在视图中打开会话”模式）。如果您不想要此行为，请将以下行添加到您的 <code>application.properties</code>文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.data.neo4j.embedded.enabled=false</span><br></pre></td></tr></table></figure>
<h3 id="Spring-Data-Neo4j存储库"><a href="#Spring-Data-Neo4j存储库" class="headerlink" title="Spring Data Neo4j存储库"></a>Spring Data Neo4j存储库</h3><p>Spring Data包含对Neo4j的存储库支持。</p>
<p>Spring Data Neo4j与Spring Data JPA共享通用基础架构，就像许多其他Spring Data模块一样。您可以从之前的JPA示例中获取并定义 <code>City</code>为Neo4j OGM <code>@NodeEntity</code>而不是JPA <code>@Entity</code>，并且存储库抽象以相同的方式工作，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.repository.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CityRepository</span> <span class="keyword">extends</span> <span class="title">Neo4jRepository</span>&lt;<span class="title">City</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">	<span class="function">Optional&lt;City&gt; <span class="title">findOneByNameAndState</span><span class="params">(String name, String state)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>spring-boot-starter-data-neo4j</code>“入门”使仓库的支持以及事务管理。您可以自定义的位置通过查找资料库和实体<code>@EnableNeo4jRepositories</code>，并<code>@EntityScan</code>分别在 <code>@Configuration</code>-bean。</p>
<blockquote>
<p>有关Spring Data Neo4j的完整详细信息，包括其对象映射技术，请参阅<a href="https://projects.spring.io/spring-data-neo4j/" target="_blank" rel="noopener">参考文档</a>。</p>
</blockquote>
<h2 id="Gemfire"><a href="#Gemfire" class="headerlink" title="Gemfire"></a>Gemfire</h2><p><a href="https://github.com/spring-projects/spring-data-gemfire" target="_blank" rel="noopener">Spring Data Gemfire</a>为访问<a href="https://pivotal.io/big-data/pivotal-gemfire#details" target="_blank" rel="noopener">Pivotal Gemfire</a>数据管理平台提供了方便的Spring友好工具 。有一个<code>spring-boot-starter-data-gemfire</code>启动器用于以方便的方式收集依赖项。目前没有对Gemfire的自动配置支持，但您可以使用单个注释<a href="https://github.com/spring-projects/spring-data-gemfire/blob/master/src/main/java/org/springframework/data/gemfire/repository/config/EnableGemfireRepositories.java" target="_blank" rel="noopener"><code>@EnableGemfireRepositories</code></a>启用Spring Data Repositories <a href="https://github.com/spring-projects/spring-data-gemfire/blob/master/src/main/java/org/springframework/data/gemfire/repository/config/EnableGemfireRepositories.java" target="_blank" rel="noopener">:</a> .</p>
<h2 id="Solr"><a href="#Solr" class="headerlink" title="Solr"></a>Solr</h2><p><a href="https://lucene.apache.org/solr/" target="_blank" rel="noopener">Apache Solr</a>是一个搜索引擎。Spring Boot为Solr 5客户端库提供了基本的自动配置，并为<a href="https://github.com/spring-projects/spring-data-solr" target="_blank" rel="noopener">Spring Data Solr</a>提供了它的抽象。有一个<code>spring-boot-starter-data-solr</code>启动器用于以方便的方式收集依赖项。</p>
<h3 id="连接到Solr"><a href="#连接到Solr" class="headerlink" title="连接到Solr"></a>连接到Solr</h3><p>您可以<code>SolrClient</code>像任何其他Spring bean一样注入自动配置的实例。默认情况下，实例尝试连接到服务器 <code>localhost:8983/solr</code>。以下示例显示如何注入Solr bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> SolrClient solr;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(SolrClient solr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.solr = solr;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果添加自己<code>@Bean</code>的类型<code>SolrClient</code>，则会替换默认值。</p>
<h3 id="Spring-Data-Solr存储库"><a href="#Spring-Data-Solr存储库" class="headerlink" title="Spring Data Solr存储库"></a>Spring Data Solr存储库</h3><p>Spring Data包括Apache Solr的存储库支持。与前面讨论的JPA存储库一样，基本原则是根据方法名称自动构造查询。</p>
<p>事实上，Spring Data JPA和Spring Data Solr共享相同的通用基础架构。您可以从之前获取JPA示例，并假设它<code>City</code>现在是一个 <code>@SolrDocument</code>类而不是JPA <code>@Entity</code>，它以相同的方式工作。</p>
<blockquote>
<p>有关Spring Data Solr的完整详细信息，请参阅 <a href="https://projects.spring.io/spring-data-solr/" target="_blank" rel="noopener">参考文档</a>。</p>
</blockquote>
<h2 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h2><p><a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener">Elasticsearch</a>是一个开源，分布式，RESTful搜索和分析引擎。Spring Boot为Elasticsearch提供基本的自动配置。</p>
<p>Spring Boot支持多个HTTP客户端：</p>
<ul>
<li>官方Java“低级”和“高级”REST客户端</li>
<li><a href="https://github.com/searchbox-io/Jest" target="_blank" rel="noopener">笑话</a></li>
</ul>
<p><a href="https://github.com/spring-projects/spring-data-elasticsearch" target="_blank" rel="noopener">Spring Data Elasticsearch</a>仍在使用传输客户端 ，您可以使用<code>spring-boot-starter-data-elasticsearch</code>启动器开始使用它。</p>
<h3 id="REST客户端连接到Elasticsearch"><a href="#REST客户端连接到Elasticsearch" class="headerlink" title="REST客户端连接到Elasticsearch"></a>REST客户端连接到Elasticsearch</h3><p>Elasticsearch提供了 <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html" target="_blank" rel="noopener">两个</a> 可用于查询集群的<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html" target="_blank" rel="noopener">REST客户端</a>：“低级”客户端和“高级”客户端。</p>
<p>如果您<code>org.elasticsearch.client:elasticsearch-rest-client</code>依赖于类路径，Spring Boot将自动配置并注册<code>RestClient</code>默认目标的bean <code>localhost:9200</code>。您可以进一步调整<code>RestClient</code>配置方式，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.elasticsearch.rest.uris=http://search.example.com:9200</span><br><span class="line">spring.elasticsearch.rest.username=user</span><br><span class="line">spring.elasticsearch.rest.password=secret</span><br></pre></td></tr></table></figure>
<p>您还可以注册任意数量的bean，以实现 <code>RestClientBuilderCustomizer</code>更高级的自定义。要完全控制注册，请定义<code>RestClient</code>bean。</p>
<p>如果您<code>org.elasticsearch.client:elasticsearch-rest-high-level-client</code>对类路径有依赖性，Spring Boot将自动配置a <code>RestHighLevelClient</code>，它包装任何现有的<code>RestClient</code>bean，重用其HTTP配置。</p>
<h3 id="使用Jest连接到Elasticsearch"><a href="#使用Jest连接到Elasticsearch" class="headerlink" title="使用Jest连接到Elasticsearch"></a>使用Jest连接到Elasticsearch</h3><p>如果您具有<code>Jest</code>类路径，则可以注入<code>JestClient</code>默认目标的自动配置<code>localhost:9200</code>。您可以进一步调整客户端的配置方式，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.elasticsearch.jest.uris=http://search.example.com:9200</span><br><span class="line">spring.elasticsearch.jest.read-timeout=10000</span><br><span class="line">spring.elasticsearch.jest.username=user</span><br><span class="line">spring.elasticsearch.jest.password=secret</span><br></pre></td></tr></table></figure>
<p>您还可以注册任意数量的bean，以实现 <code>HttpClientConfigBuilderCustomizer</code>更高级的自定义。以下示例调整其他HTTP设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpSettingsCustomizer</span> <span class="keyword">implements</span> <span class="title">HttpClientConfigBuilderCustomizer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(HttpClientConfig.Builder builder)</span> </span>&#123;</span><br><span class="line">		builder.maxTotalConnection(<span class="number">100</span>).defaultMaxTotalConnectionPerRoute(<span class="number">5</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要完全控制注册，请定义<code>JestClient</code>bean。</p>
<h3 id="使用Spring数据连接Elasticsearch"><a href="#使用Spring数据连接Elasticsearch" class="headerlink" title="使用Spring数据连接Elasticsearch"></a>使用Spring数据连接Elasticsearch</h3><p>要连接到Elasticsearch，您必须提供一个或多个群集节点的地址。可以通过将<code>spring.data.elasticsearch.cluster-nodes</code> 属性设置为逗号分隔<code>host:port</code>列表来指定地址。使用此配置， 可以像任何其他Spring bean一样注入<code>ElasticsearchTemplate</code>或<code>TransportClient</code>注入，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.data.elasticsearch.cluster-nodes=localhost:9300</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> ElasticsearchTemplate template;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(ElasticsearchTemplate template)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.template = template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果您添加自己的<code>ElasticsearchTemplate</code>或<code>TransportClient</code> <code>@Bean</code>，它将替换默认值。</p>
<h3 id="Spring-Data-Elasticsearch存储库"><a href="#Spring-Data-Elasticsearch存储库" class="headerlink" title="Spring Data Elasticsearch存储库"></a>Spring Data Elasticsearch存储库</h3><p>Spring Data包括对Elasticsearch的存储库支持。与前面讨论的JPA存储库一样，基本原则是根据方法名称自动为您构建查询。</p>
<p>事实上，Spring Data JPA和Spring Data Elasticsearch共享相同的通用基础架构。您可以从之前的JPA示例中获取，假设它<code>City</code>现在是Elasticsearch <code>@Document</code>类而不是JPA <code>@Entity</code>，它的工作方式相同。</p>
<blockquote>
<p>有关Spring Data Elasticsearch的完整详细信息，请参阅 <a href="https://docs.spring.io/spring-data/elasticsearch/docs/" target="_blank" rel="noopener">参考文档</a>。</p>
</blockquote>
<h2 id="Cassandra"><a href="#Cassandra" class="headerlink" title="Cassandra"></a>Cassandra</h2><p><a href="https://cassandra.apache.org/" target="_blank" rel="noopener">Cassandra</a>是一个开源的分布式数据库管理系统，旨在处理许多商用服务器上的大量数据。Spring Boot提供了Cassandra的自动配置以及<a href="https://github.com/spring-projects/spring-data-cassandra" target="_blank" rel="noopener">Spring Data Cassandra</a>提供的抽象。有一个<code>spring-boot-starter-data-cassandra</code>启动器用于以方便的方式收集依赖项。</p>
<h3 id="连接到Cassandra"><a href="#连接到Cassandra" class="headerlink" title="连接到Cassandra"></a>连接到Cassandra</h3><p>您可以像使用任何其他Spring Bean一样注入自动配置<code>CassandraTemplate</code>或Cassandra <code>Session</code>实例。这些<code>spring.data.cassandra.*</code>属性可用于自定义连接。通常，您提供<code>keyspace-name</code>和 <code>contact-points</code>属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.data.cassandra.keyspace-name=mykeyspace</span><br><span class="line">spring.data.cassandra.contact-points=cassandrahost1,cassandrahost2</span><br></pre></td></tr></table></figure>
<p>您还可以注册任意数量的bean，以实现 <code>ClusterBuilderCustomizer</code>更高级的自定义。</p>
<p>以下代码清单显示了如何注入Cassandra bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> CassandraTemplate template;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(CassandraTemplate template)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.template = template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果添加自己<code>@Bean</code>的类型<code>CassandraTemplate</code>，则会替换默认值。</p>
<h3 id="Spring-Data-Cassandra存储库"><a href="#Spring-Data-Cassandra存储库" class="headerlink" title="Spring Data Cassandra存储库"></a>Spring Data Cassandra存储库</h3><p>Spring Data包含对Cassandra的基本存储库支持。目前，这比前面讨论的JPA存储库更有限，需要使用注释查找器方法<code>@Query</code>。</p>
<blockquote>
<p>有关Spring Data Cassandra的完整详细信息，请参阅 <a href="https://docs.spring.io/spring-data/cassandra/docs/" target="_blank" rel="noopener">参考文档</a>。</p>
</blockquote>
<h2 id="Couchbase"><a href="#Couchbase" class="headerlink" title="Couchbase"></a>Couchbase</h2><p><a href="https://www.couchbase.com/" target="_blank" rel="noopener">Couchbase</a>是一个开源的，分布式的，多模型的NoSQL面向文档的数据库，针对交互式应用程序进行了优化。Spring Boot提供了Couchbase的自动配置以及<a href="https://github.com/spring-projects/spring-data-couchbase" target="_blank" rel="noopener">Spring Data Couchbase</a>提供的抽象 。有一个 <code>spring-boot-starter-data-couchbase</code>和<code>spring-boot-starter-data-couchbase-reactive</code> 启动器方便的方法收集的依赖关系。</p>
<h3 id="连接到Couchbase"><a href="#连接到Couchbase" class="headerlink" title="连接到Couchbase"></a>连接到Couchbase</h3><p>你可以得到一个<code>Bucket</code>和<code>Cluster</code>通过添加Couchbase SDK和一些配置。这些<code>spring.couchbase.*</code>属性可用于自定义连接。通常，您提供引导主机，存储桶名称和密码，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.couchbase.bootstrap-hosts=my-host-1,192.168.1.123</span><br><span class="line">spring.couchbase.bucket.name=my-bucket</span><br><span class="line">spring.couchbase.bucket.password=secret</span><br></pre></td></tr></table></figure>
<blockquote>
<p>您需要<em>至少</em>提供引导主机，在这种情况下，存储桶名称为 <code>default</code>，密码为空字符串。或者，您可以定义自己的<code>org.springframework.data.couchbase.config.CouchbaseConfigurer</code> <code>@Bean</code>控件来控制整个配置。</p>
</blockquote>
<p>也可以自定义一些<code>CouchbaseEnvironment</code>设置。例如，以下配置更改用于打开新的超时<code>Bucket</code> 并启用SSL支持的超时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.couchbase.env.timeouts.connect=3000</span><br><span class="line">spring.couchbase.env.ssl.key-store=/location/of/keystore.jks</span><br><span class="line">spring.couchbase.env.ssl.key-store-password=secret</span><br></pre></td></tr></table></figure>
<p>检查<code>spring.couchbase.env.*</code>属性以获取更多详细信息。</p>
<h3 id="Spring-Data-Couchbase存储库"><a href="#Spring-Data-Couchbase存储库" class="headerlink" title="Spring Data Couchbase存储库"></a>Spring Data Couchbase存储库</h3><p>Spring Data包括对Couchbase的存储库支持。有关Spring Data Couchbase的完整详细信息，请参阅 <a href="https://docs.spring.io/spring-data/couchbase/docs/current/reference/html/" target="_blank" rel="noopener">参考文档</a>。</p>
<p>您可以<code>CouchbaseTemplate</code>像使用任何其他Spring Bean一样注入自动配置的实例，只要有<em>默认值</em> <code>CouchbaseConfigurer</code>（当您启用Couchbase支持时会发生这种情况，如前所述）。</p>
<p>以下示例显示了如何注入Couchbase bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> CouchbaseTemplate template;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(CouchbaseTemplate template)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.template = template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您可以在自己的配置中定义一些bean来覆盖自动配置提供的bean：</p>
<ul>
<li><code>CouchbaseTemplate</code> <code>@Bean</code>的名字是<code>couchbaseTemplate</code>。</li>
<li><code>IndexManager</code> <code>@Bean</code>用的名称<code>couchbaseIndexManager</code>。</li>
<li><code>CustomConversions</code> <code>@Bean</code>的名字是<code>couchbaseCustomConversions</code>。</li>
</ul>
<p>为避免在您自己的配置中对这些名称进行硬编码，您可以重复使用<code>BeanNames</code>Spring Data Couchbase。例如，您可以自定义要使用的转换器，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span>(BeanNames.COUCHBASE_CUSTOM_CONVERSIONS)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> CustomConversions <span class="title">myCustomConversions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> CustomConversions(...);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果要完全绕过Spring Data Couchbase的自动配置，请提供自己的实现<code>org.springframework.data.couchbase.config.AbstractCouchbaseDataConfiguration</code>。</p>
</blockquote>
<h2 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h2><p><a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" target="_blank" rel="noopener">LDAP</a>（轻量级目录访问协议）是一种开放的，与供应商无关的行业标准应用程序协议，用于通过IP网络访问和维护分布式目录信息服务。Spring Boot为任何兼容的LDAP服务器提供自动配置，并为<a href="https://www.ldap.com/unboundid-ldap-sdk-for-java" target="_blank" rel="noopener">UnboundID</a>支持嵌入式内存中LDAP服务器 。</p>
<p>LDAP抽象由 <a href="https://github.com/spring-projects/spring-data-ldap" target="_blank" rel="noopener">Spring Data LDAP提供</a>。有一个<code>spring-boot-starter-data-ldap</code>启动器用于以方便的方式收集依赖项。</p>
<h3 id="连接LDAP服务器"><a href="#连接LDAP服务器" class="headerlink" title="连接LDAP服务器"></a>连接LDAP服务器</h3><p>要连接到LDAP服务器，请确保声明对<code>spring-boot-starter-data-ldap</code>启动器 的依赖关系 <code>spring-ldap-core</code>，然后在application.properties中声明服务器的URL，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.ldap.urls=ldap://myserver:1235</span><br><span class="line">spring.ldap.username=admin</span><br><span class="line">spring.ldap.password=secret</span><br></pre></td></tr></table></figure>
<p>如果需要自定义连接设置，可以使用<code>spring.ldap.base</code>和 <code>spring.ldap.base-environment</code>属性。</p>
<p>一种<code>LdapContextSource</code>是自动配置基于这些设置。如果您需要自定义它，例如使用a <code>PooledContextSource</code>，您仍然可以注入自动配置<code>LdapContextSource</code>。确保将自定义标记<code>ContextSource</code>为<code>@Primary</code>自动配置<code>LdapTemplate</code>使用它。</p>
<h3 id="Spring-Data-LDAP存储库"><a href="#Spring-Data-LDAP存储库" class="headerlink" title="Spring Data LDAP存储库"></a>Spring Data LDAP存储库</h3><p>Spring Data包括对LDAP的存储库支持。有关Spring Data LDAP的完整详细信息，请参阅 <a href="https://docs.spring.io/spring-data/ldap/docs/1.0.x/reference/html/" target="_blank" rel="noopener">参考文档</a>。</p>
<p>您也可以<code>LdapTemplate</code>像使用任何其他Spring Bean一样注入自动配置的实例，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> LdapTemplate template;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(LdapTemplate template)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.template = template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="嵌入式内存LDAP服务器"><a href="#嵌入式内存LDAP服务器" class="headerlink" title="嵌入式内存LDAP服务器"></a>嵌入式内存LDAP服务器</h3><p>出于测试目的，Spring Boot支持从<a href="https://www.ldap.com/unboundid-ldap-sdk-for-java" target="_blank" rel="noopener">UnboundID</a>自动配置内存中的LDAP服务器。要配置服务器，请向依赖项添加依赖项<code>com.unboundid:unboundid-ldapsdk</code>并声明<code>base-dn</code>属性，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.ldap.embedded.base-dn=dc=spring,dc=io</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以定义多个base-dn值，但是，由于可分辨名称通常包含逗号，因此必须使用正确的表示法定义它们。</p>
<p>在yaml文件中，您可以使用yaml列表表示法：</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">spring.ldap.embedded.base-dn:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">dc=spring,dc=io</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">dc=pivotal,dc=io</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>在属性文件中，必须包含索引作为属性名称的一部分：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.ldap.embedded.base-dn[0]=dc=spring,dc=io</span><br><span class="line">spring.ldap.embedded.base-dn[1]=dc=pivotal,dc=io</span><br></pre></td></tr></table></figure>
<p>默认情况下，服务器在随机端口上启动并触发常规LDAP支持。无需指定<code>spring.ldap.urls</code>属性。</p>
<p>如果<code>schema.ldif</code>类路径中有文件，则用于初始化服务器。如果要从其他资源加载初始化脚本，还可以使用该<code>spring.ldap.embedded.ldif</code>属性。</p>
<p>默认情况下，标准模式用于验证<code>LDIF</code>文件。您可以通过设置<code>spring.ldap.embedded.validation.enabled</code>属性完全关闭验证。如果您有自定义属性，则可以使用它<code>spring.ldap.embedded.validation.schema</code>来定义自定义属性类型或对象类。</p>
<h2 id="InfluxDB"><a href="#InfluxDB" class="headerlink" title="InfluxDB"></a>InfluxDB</h2><p><a href="https://www.influxdata.com/" target="_blank" rel="noopener">InfluxDB</a>是一个开源时间序列数据库，针对运营监控，应用程序指标，物联网传感器数据和实时分析等领域中的时间序列数据的快速，高可用性存储和检索进行了优化。</p>
<h3 id="连接到InfluxDB"><a href="#连接到InfluxDB" class="headerlink" title="连接到InfluxDB"></a>连接到InfluxDB</h3><p><code>InfluxDB</code>如果<code>influxdb-java</code>客户端在类路径上并且设置了数据库的URL，则Spring Boot会自动配置实例，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.influx.url=http://172.0.0.1:8086</span><br></pre></td></tr></table></figure>
<p>如果与InfluxDB的连接需要用户和密码，则可以相应地设置 <code>spring.influx.user</code>和<code>spring.influx.password</code>属性。</p>
<p>InfluxDB依赖于OkHttp。如果需要调整http客户端<code>InfluxDB</code>在幕后使用，可以注册一个<code>InfluxDbOkHttpClientBuilderProvider</code>bean。</p>
</div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-NoSQL数据库/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/20/使用SpringBoot-SQL数据库/">使用SpringBoot-SQL数据库</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/sql/">sql</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/database/">database</a></div></div><div class="post-content"><div class="main-content content"><h1 id="SQL数据库"><a href="#SQL数据库" class="headerlink" title="SQL数据库"></a>SQL数据库</h1><p>在<a href="https://projects.spring.io/spring-framework/" target="_blank" rel="noopener">Spring框架</a>提供了广泛的支持使用使用SQL数据库，直接JDBC访问<code>JdbcTemplate</code>来完成“对象关系映射”技术，比如Hibernate。<a href="https://projects.spring.io/spring-data/" target="_blank" rel="noopener">Spring Data</a>提供了更多级别的功能：<code>Repository</code>直接从接口创建实现，并使用约定从方法名称生成查询。</p>
<h2 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h2><p>Java的<code>javax.sql.DataSource</code>接口提供了一种使用数据库连接的标准方法。传统上，’DataSource’使用<code>URL</code>一些凭证来建立数据库连接。</p>
<blockquote>
<p>有关更多高级示例，请参阅<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-configure-a-datasource" target="_blank" rel="noopener">“操作方法”</a>，通常可以完全控制DataSource的配置。</p>
</blockquote>
<h3 id="嵌入式数据库支持"><a href="#嵌入式数据库支持" class="headerlink" title="嵌入式数据库支持"></a>嵌入式数据库支持</h3><p>通过使用内存中的嵌入式数据库来开发应用程序通常很方便。显然，内存数据库不提供持久存储。您需要在应用程序启动时填充数据库，并准备在应用程序结束时丢弃数据。</p>
<blockquote>
<p>“操作方法”部分包含<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-database-initialization" target="_blank" rel="noopener">有关如何初始化数据库的部分</a>。</p>
</blockquote>
<p>Spring Boot可以自动配置嵌入式<a href="http://www.h2database.com/" target="_blank" rel="noopener">H2</a>， <a href="http://hsqldb.org/" target="_blank" rel="noopener">HSQL</a>和<a href="https://db.apache.org/derby/" target="_blank" rel="noopener">Derby</a>数据库。您无需提供任何连接URL。您只需要包含要使用的嵌入式数据库的构建依赖项。</p>
<blockquote>
<p>如果您在测试中使用此功能，您可能会注意到整个测试套件都会重复使用相同的数据库，而不管您使用的应用程序上下文的数量。如果要确保每个上下文都有一个单独的嵌入式数据库，则应设置<code>spring.datasource.generate-unique-name</code>为<code>true</code>。</p>
</blockquote>
<p>例如，典型的POM依赖关系如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hsqldb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hsqldb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>您需要依赖于<code>spring-jdbc</code>自动配置嵌入式数据库。在这个例子中，它被传递过来 <code>spring-boot-starter-data-jpa</code>。</p>
</blockquote>
<blockquote>
<p>如果由于某种原因，您确实为嵌入式数据库配置了连接URL，请注意确保禁用数据库的自动关闭。如果你使用H2，你应该<code>DB_CLOSE_ON_EXIT=FALSE</code>这样做。如果使用HSQLDB，则应确保<code>shutdown=true</code>未使用HSQLDB 。禁用数据库的自动关闭可以在数据库关闭时进行Spring Boot控制，从而确保在不再需要访问数据库时发生。</p>
</blockquote>
<h3 id="连接到生产数据库"><a href="#连接到生产数据库" class="headerlink" title="连接到生产数据库"></a>连接到生产数据库</h3><p>也可以使用池自动配置生产数据库连接 <code>DataSource</code>。Spring Boot使用以下算法来选择特定的实现：</p>
<ol>
<li>我们更喜欢<a href="https://github.com/brettwooldridge/HikariCP" target="_blank" rel="noopener">HikariCP</a>的性能和并发性。如果HikariCP可用，我们总是选择它。</li>
<li>否则，如果Tomcat池<code>DataSource</code>可用，我们将使用它。</li>
<li>如果HikariCP和Tomcat池化数据源都不可用，并且 <a href="https://commons.apache.org/proper/commons-dbcp/" target="_blank" rel="noopener">Commons DBCP2</a>可用，我们就会使用它。</li>
</ol>
<p>如果您使用<code>spring-boot-starter-jdbc</code>或<code>spring-boot-starter-data-jpa</code>启动器，您将自动获得依赖<code>HikariCP</code>。</p>
<blockquote>
<p>您可以完全绕过该算法，并通过设置<code>spring.datasource.type</code>属性指定要使用的连接池。如果您在Tomcat容器中运行应用程序<code>tomcat-jdbc</code>（默认情况下提供），这一点尤为重要。</p>
</blockquote>
<blockquote>
<p>始终可以手动配置其他连接池。如果您定义自己的<code>DataSource</code>bean，则不会进行自动配置。</p>
</blockquote>
<p>DataSource配置由外部配置属性控制 <code>spring.datasource.*</code>。例如，您可以在以下部分声明以下部分 <code>application.properties</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url=jdbc:mysql://localhost/test</span><br><span class="line">spring.datasource.username=dbuser</span><br><span class="line">spring.datasource.password=dbpass</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure>
<blockquote>
<p>您至少应该通过设置<code>spring.datasource.url</code> 属性来指定URL 。否则，Spring Boot会尝试自动配置嵌入式数据库。</p>
</blockquote>
<blockquote>
<p>您通常不需要指定<code>driver-class-name</code>，因为Spring Boot可以从大多数数据库推断它<code>url</code>。</p>
</blockquote>
<blockquote>
<p>对于<code>DataSource</code>要创建的池，我们需要能够验证有效的 <code>Driver</code>类是否可用，因此我们在执行任何操作之前检查它。换句话说，如果你设置<code>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</code>，那么该类必须是可加载的。</p>
</blockquote>
<p>有关<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceProperties.java" target="_blank" rel="noopener"><code>DataSourceProperties</code></a> 更多支持的选项，请参阅 。无论实际实施如何，这些都是标准选项。也可以微调实现特定的设置，使用各自的前缀（<code>spring.datasource.hikari.*</code>， <code>spring.datasource.tomcat.*</code>，和<code>spring.datasource.dbcp2.*</code>）。有关更多详细信息，请参阅您正在使用的连接池实现的文档。</p>
<p>例如，如果使用 <a href="https://tomcat.apache.org/tomcat-8.0-doc/jdbc-pool.html#Common_Attributes" target="_blank" rel="noopener">Tomcat连接池</a>，则可以自定义许多其他设置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">＃如果没有可用连接，则在抛出异常之前要等待的ms数。</span><br><span class="line">spring.datasource.tomcat.max-wait = 10000</span><br><span class="line"></span><br><span class="line">＃可以同时从该池分配的最大活动连接数。</span><br><span class="line">spring.datasource.tomcat.max-active = 50</span><br><span class="line"></span><br><span class="line">＃在从池中借用连接之前验证连接。</span><br><span class="line">spring.datasource.tomcat.test-on-borrow = true</span><br></pre></td></tr></table></figure>
<h3 id="连接到JNDI数据源"><a href="#连接到JNDI数据源" class="headerlink" title="连接到JNDI数据源"></a>连接到JNDI数据源</h3><p>如果将Spring Boot应用程序部署到Application Server，则可能需要使用Application Server的内置功能配置和管理DataSource，并使用JNDI访问它。</p>
<p>该<code>spring.datasource.jndi-name</code>属性可以被用作一个替代 <code>spring.datasource.url</code>，<code>spring.datasource.username</code>和<code>spring.datasource.password</code>属性来访问<code>DataSource</code>从一个特定的JNDI位置。例如，以下部分<code>application.properties</code>显示了如何访问定义的JBoss AS <code>DataSource</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.jndi-name=java:jboss/datasources/customers</span><br></pre></td></tr></table></figure>
<h2 id="使用JdbcTemplate"><a href="#使用JdbcTemplate" class="headerlink" title="使用JdbcTemplate"></a>使用JdbcTemplate</h2><p>Spring <code>JdbcTemplate</code>和<code>NamedParameterJdbcTemplate</code>类是自动配置的，您可以<code>@Autowire</code>直接将它们放入自己的bean中，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您可以使用<code>spring.jdbc.template.*</code> 属性自定义模板的某些属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jdbc.template.max-rows=500</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在<code>NamedParameterJdbcTemplate</code>重复使用相同的<code>JdbcTemplate</code>幕后情况。如果<code>JdbcTemplate</code>定义了多个且没有主要候选项，<code>NamedParameterJdbcTemplate</code>则不会自动配置。</p>
</blockquote>
<h2 id="JPA和Spring-Data-JPA"><a href="#JPA和Spring-Data-JPA" class="headerlink" title="JPA和Spring Data JPA"></a>JPA和Spring Data JPA</h2><p>Java Persistence API是一种标准技术，可让您将对象“映射”到关系数据库。该<code>spring-boot-starter-data-jpa</code>POM提供了上手的快捷方式。它提供以下关键依赖项：</p>
<ul>
<li>Hibernate：最受欢迎的JPA实现之一。</li>
<li>Spring Data JPA：使实现基于JPA的存储库变得容易。</li>
<li>Spring ORMs：Spring Framework的核心ORM支持。</li>
</ul>
<blockquote>
<p>我们不会在这里详细介绍JPA或<a href="https://projects.spring.io/spring-data/" target="_blank" rel="noopener">Spring Data</a>。您可以按照<a href="https://spring.io/guides/gs/accessing-data-jpa/" target="_blank" rel="noopener">“访问数据与JPA”</a> 从指导<a href="https://spring.io/" target="_blank" rel="noopener">spring.io</a>并宣读了<a href="https://projects.spring.io/spring-data-jpa/" target="_blank" rel="noopener">春天的数据JPA</a>和 <a href="https://hibernate.org/orm/documentation/" target="_blank" rel="noopener">Hibernate的</a>参考文档。</p>
</blockquote>
<h3 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h3><p>传统上，JPA“实体”类在<code>persistence.xml</code>文件中指定。使用Spring Boot，此文件不是必需的，而是使用“实体扫描”。默认情况下，将搜索主配置类（注释为<code>@EnableAutoConfiguration</code>或者<code>@SpringBootApplication</code>）下的所有包 。</p>
<p>任何类别标注了<code>@Entity</code>，<code>@Embeddable</code>或者<code>@MappedSuperclass</code>被认为是。典型的实体类类似于以下示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">City</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Column</span>(nullable = <span class="keyword">false</span>)</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Column</span>(nullable = <span class="keyword">false</span>)</span><br><span class="line">	<span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...其他成员，通常包括@OneToMany映射</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="title">City</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//JPA规范要求的no-args构造函数</span></span><br><span class="line">		<span class="comment">//这个是受保护的，因为它不应该直接使用</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">City</span><span class="params">(String name, String state)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ... etc</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>您可以使用<code>@EntityScan</code>注释自定义实体扫描位置。请参阅“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-separate-entity-definitions-from-spring-configuration" target="_blank" rel="noopener">第84.4节</a> ” <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-separate-entity-definitions-from-spring-configuration" target="_blank" rel="noopener">，“从Spring配置中分离@Entity定义”</a> “ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-separate-entity-definitions-from-spring-configuration" target="_blank" rel="noopener">操作方法”</a>。</p>
</blockquote>
<h3 id="Spring-Data-JPA存储库"><a href="#Spring-Data-JPA存储库" class="headerlink" title="Spring Data JPA存储库"></a>Spring Data JPA存储库</h3><p><a href="https://projects.spring.io/spring-data-jpa/" target="_blank" rel="noopener">Spring Data JPA</a>存储库是您可以定义以访问数据的接口。JPA查询是从您的方法名称自动创建的。例如， <code>CityRepository</code>接口可能会声明一种<code>findAllByState(String state)</code>方法来查找给定状态中的所有城市。</p>
<p>对于更复杂的查询，您可以使用Spring Data的<a href="https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/Query.html" target="_blank" rel="noopener"><code>Query</code></a>注释来注释您的方法 。</p>
<p>Spring Data存储库通常从<a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/Repository.html" target="_blank" rel="noopener"><code>Repository</code></a>或 <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html" target="_blank" rel="noopener"><code>CrudRepository</code></a> 接口扩展 。如果使用自动配置，则会从包含主配置类（带有<code>@EnableAutoConfiguration</code>或标注的<code>@SpringBootApplication</code>）的包中搜索存储库 。</p>
<p>以下示例显示了典型的Spring Data存储库接口定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CityRepository</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">City</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">	<span class="function">Page&lt;City&gt; <span class="title">findAll</span><span class="params">(Pageable pageable)</span></span>;</span><br><span class="line">	<span class="function">City <span class="title">findByNameAndStateAllIgnoringCase</span><span class="params">(String name, String state)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring Data JPA存储库支持三种不同的引导模式：default，deferred和lazy。要启用延迟或延迟引导，请分别设置<code>spring.data.jpa.repositories.bootstrap-mode</code>为<code>deferred</code>或<code>lazy</code>。使用延迟或延迟引导时，自动配置<code>EntityManagerFactoryBuilder</code> 将使用上下文（<code>AsyncTaskExecutor</code>如果有）作为引导程序执行程序。如果存在多个，则使用命名的那个<code>applicationTaskExecutor</code>。</p>
<blockquote>
<p>我们几乎没有涉及Spring Data JPA的表面。有关完整的详细信息，请参阅<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/" target="_blank" rel="noopener">Spring Data JPA参考文档</a>。</p>
</blockquote>
<h3 id="创建和删除JPA数据库"><a href="#创建和删除JPA数据库" class="headerlink" title="创建和删除JPA数据库"></a>创建和删除JPA数据库</h3><p>默认情况下，<strong>仅</strong>当您使用嵌入式数据库（H2，HSQL或Derby）时，<strong>才会</strong>自动创建JPA数据库。您可以使用<code>spring.jpa.*</code>属性显式配置JPA设置 。例如，要创建和删除表，您可以将以下行添加到<code>application.properties</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.hibernate.ddl-auto=create-drop</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Hibernate自己的内部属性名称（如果你碰巧记得更好）是<code>hibernate.hbm2ddl.auto</code>。您可以使用<code>spring.jpa.properties.*</code>（在将它们添加到实体管理器之前剥离前缀）来设置它以及其他Hibernate本机属性。以下行显示了为Hibernate设置JPA属性的示例：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.properties.hibernate.globally_quoted_identifiers=true</span><br></pre></td></tr></table></figure>
<p>在前面的示例中的线穿过的一个值<code>true</code>的 <code>hibernate.globally_quoted_identifiers</code>属性设置为休眠实体管理器。</p>
<p>默认情况下，DDL执行（或验证）将延迟到<code>ApplicationContext</code> 启动。还有一个<code>spring.jpa.generate-ddl</code>标志，但如果Hibernate自动配置处于活动状态，则不会使用该标志，因为<code>ddl-auto</code>设置更精细。</p>
<h3 id="在View中打开EntityManager"><a href="#在View中打开EntityManager" class="headerlink" title="在View中打开EntityManager"></a>在View中打开EntityManager</h3><p>如果您正在运行Web应用程序，则默认情况下Spring Boot会注册 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/javadoc-api/org/springframework/orm/jpa/support/OpenEntityManagerInViewInterceptor.html" target="_blank" rel="noopener"><code>OpenEntityManagerInViewInterceptor</code></a> 以应用“在视图中打开EntityManager”模式，以允许在Web视图中进行延迟加载。如果你不希望这种行为，你应该设置<code>spring.jpa.open-in-view</code>到 <code>false</code>你<code>application.properties</code>。</p>
<h2 id="Spring-Data-JDBC"><a href="#Spring-Data-JDBC" class="headerlink" title="Spring Data JDBC"></a>Spring Data JDBC</h2><p>Spring Data包含对JDBC的存储库支持，并将自动为方法生成SQL <code>CrudRepository</code>。对于更高级的查询，<code>@Query</code>提供了注释。</p>
<p>当必要的依赖项在类路径上时，Spring Boot将自动配置Spring Data的JDBC存储库。它们可以通过单个依赖项添加到项目中<code>spring-boot-starter-data-jdbc</code>。如有必要，您可以通过向应用程序添加<code>@EnableJdbcRepositories</code>注释或 <code>JdbcConfiguration</code>子类来控制Spring Data JDBC的配置。</p>
<blockquote>
<p>有关Spring Data JDBC的完整详细信息，请参阅 <a href="https://projects.spring.io/spring-data-jdbc/" target="_blank" rel="noopener">参考文档</a>。</p>
</blockquote>
<h2 id="使用H2的Web控制台"><a href="#使用H2的Web控制台" class="headerlink" title="使用H2的Web控制台"></a>使用H2的Web控制台</h2><p>该<a href="http://www.h2database.com/" target="_blank" rel="noopener">H2数据库</a>提供了一个 <a href="http://www.h2database.com/html/quickstart.html#h2_console" target="_blank" rel="noopener">基于浏览器的控制台</a>,Spring启动即可自动配置。满足以下条件时，将自动配置控制台：</p>
<ul>
<li>您正在开发基于servlet的Web应用程序。</li>
<li><code>com.h2database:h2</code> 在类路径上。</li>
<li>您正在使用<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#using-boot-devtools" target="_blank" rel="noopener">Spring Boot的开发人员工具</a>。</li>
</ul>
<blockquote>
<p>如果您没有使用Spring Boot的开发人员工具但仍希望使用H2的控制台，则可以<code>spring.h2.console.enabled</code>使用值配置属性<code>true</code>。</p>
</blockquote>
<blockquote>
<p>H2控制台仅用于开发期间，因此您应该注意确保<code>spring.h2.console.enabled</code>在生产中不要设置为<code>true</code>。</p>
</blockquote>
<h3 id="更改H2控制台的路径"><a href="#更改H2控制台的路径" class="headerlink" title="更改H2控制台的路径"></a>更改H2控制台的路径</h3><p>默认情况下，控制台可用于<code>/h2-console</code>。您可以使用该<code>spring.h2.console.path</code>属性自定义控制台的路径。</p>
<h2 id="使用jOOQ"><a href="#使用jOOQ" class="headerlink" title="使用jOOQ"></a>使用jOOQ</h2><p>Java面向对象查询（<a href="http://www.jooq.org/" target="_blank" rel="noopener">jOOQ</a>）是<a href="http://www.datageekery.com/" target="_blank" rel="noopener">Data Geekery的</a>一个流行产品， 它从您的数据库生成Java代码，并允许您通过其流畅的API构建类型安全的SQL查询。商业版和开源版都可以与Spring Boot一起使用。</p>
<h3 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h3><p>为了使用jOOQ类型安全查询，您需要从数据库模式生成Java类。您可以按照<a href="https://www.jooq.org/doc/3.11.9/manual-single-page/#jooq-in-7-steps-step3" target="_blank" rel="noopener">jOOQ用户手册中</a>的说明进行 <a href="https://www.jooq.org/doc/3.11.9/manual-single-page/#jooq-in-7-steps-step3" target="_blank" rel="noopener">操作</a>。如果您使用该 <code>jooq-codegen-maven</code>插件并且还使用<code>spring-boot-starter-parent</code> “父POM”，则可以安全地省略插件的<code>&lt;version&gt;</code>标签。您还可以使用Spring Boot定义的版本变量（例如<code>h2.version</code>）来声明插件的数据库依赖性。以下清单显示了一个示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jooq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jooq-codegen-maven<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;h2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">jdbc</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">driver</span>&gt;</span>org.h2.Driver<span class="tag">&lt;/<span class="name">driver</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>jdbc:h2:~/yourdatabase<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">jdbc</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">generator</span>&gt;</span></span><br><span class="line">			...</span><br><span class="line">		<span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="使用DSLContext"><a href="#使用DSLContext" class="headerlink" title="使用DSLContext"></a>使用DSLContext</h3><p>jOOQ提供的流畅API通过<code>org.jooq.DSLContext</code>界面启动。Spring Boot自动配置<code>DSLContext</code>为Spring Bean并将其连接到您的应用程序<code>DataSource</code>。要使用<code>DSLContext</code>，您可以使用<code>@Autowire</code>它，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JooqExample</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> DSLContext create;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">JooqExample</span><span class="params">(DSLContext dslContext)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.create = dslContext;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>jOOQ手册倾向于使用一个名为<code>create</code>hold的变量<code>DSLContext</code>。</p>
</blockquote>
<p>然后，您可以使用它<code>DSLContext</code>来构建查询，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;GregorianCalendar&gt; <span class="title">authorsBornAfter1980</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.create.selectFrom(AUTHOR)</span><br><span class="line">		.where(AUTHOR.DATE_OF_BIRTH.greaterThan(<span class="keyword">new</span> GregorianCalendar(<span class="number">1980</span>, <span class="number">0</span>, <span class="number">1</span>)))</span><br><span class="line">		.fetch(AUTHOR.DATE_OF_BIRTH);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="jOOQ-SQL方言"><a href="#jOOQ-SQL方言" class="headerlink" title="jOOQ SQL方言"></a>jOOQ SQL方言</h3><p>除非<code>spring.jooq.sql-dialect</code>已配置该属性，否则Spring Boot会确定用于数据源的SQL方言。如果Spring Boot无法检测到方言，则使用<code>DEFAULT</code>。</p>
<blockquote>
<p>Spring Boot只能自动配置开源版本的jOOQ支持的方言。</p>
</blockquote>
<h3 id="自定义jOOQ"><a href="#自定义jOOQ" class="headerlink" title="自定义jOOQ"></a>自定义jOOQ</h3><p>通过定义自己的<code>@Bean</code>定义可以实现更高级的自定义，这些定义在<code>Configuration</code>创建jOOQ时使用。您可以为以下jOOQ类型定义bean：</p>
<ul>
<li><code>ConnectionProvider</code></li>
<li><code>ExecutorProvider</code></li>
<li><code>TransactionProvider</code></li>
<li><code>RecordMapperProvider</code></li>
<li><code>RecordUnmapperProvider</code></li>
<li><code>RecordListenerProvider</code></li>
<li><code>ExecuteListenerProvider</code></li>
<li><code>VisitListenerProvider</code></li>
<li><code>TransactionListenerProvider</code></li>
</ul>
<p><code>org.jooq.Configuration</code> <code>@Bean</code>如果要完全控制jOOQ配置，也可以创建自己的。</p>
</div></div><a class="button-hover more" href="/2019/03/20/使用SpringBoot-SQL数据库/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/20/使用SpringBoot-Security/">使用SpringBoot-Security</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/security/">security</a></div></div><div class="post-content"><div class="main-content content"><h2 id="Security-安全"><a href="#Security-安全" class="headerlink" title="Security(安全)"></a>Security(安全)</h2><p>如果<a href="https://projects.spring.io/spring-security/" target="_blank" rel="noopener">Spring Security</a>位于类路径上，则默认情况下Web应用程序是安全的。Spring Boot依赖于Spring Security的内容协商策略来确定是否使用<code>httpBasic</code>或<code>formLogin</code>。要向Web应用程序添加方法级安全性，您还可以<code>@EnableGlobalMethodSecurity</code>使用所需的设置进行添加。其他信息可以在 <a href="https://docs.spring.io/spring-security/site/docs/5.1.4.RELEASE/reference/htmlsingle#jc-method" target="_blank" rel="noopener">Spring Security Reference Guide中找到</a>。</p>
<p>默认设置<code>UserDetailsService</code>只有一个用户。用户名是<code>user</code>，密码是随机的，在应用程序启动时以INFO级别打印，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用生成的安全密码：78fa095d-3f4c-48b1-ad50-e24c31d5cf35</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果您对日志记录配置进行微调，请确保将 <code>org.springframework.boot.autoconfigure.security</code>类别设置为log <code>INFO</code>-level messages。否则，不会打印默认密码。</p>
</blockquote>
<p>您可以通过提供<code>spring.security.user.name</code>和 更改用户名和密码<code>spring.security.user.password</code>。</p>
<p>您在Web应用程序中默认获得的基本功能包括：</p>
<ul>
<li>A <code>UserDetailsService</code>（或<code>ReactiveUserDetailsService</code>WebFlux应用程序的情况）bean具有内存存储，单个用户具有生成的密码（请参阅<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api/org/springframework/boot/autoconfigure/security/SecurityProperties.User.html" target="_blank" rel="noopener"><code>SecurityProperties.User</code></a> 用户的属性）。</li>
<li>基于表单的登录或HTTP基本安全性（取决于Content-Type）用于整个应用程序（如果执行器在类路径上，则包括执行器端点）。</li>
<li>一个<code>DefaultAuthenticationEventPublisher</code>用于发布身份验证事件。</li>
</ul>
<p>你可以<code>AuthenticationEventPublisher</code>通过为它添加一个bean 来提供不同的东西。</p>
<h3 id="MVC安全性"><a href="#MVC安全性" class="headerlink" title="MVC安全性"></a>MVC安全性</h3><p>默认安全配置在<code>SecurityAutoConfiguration</code>和中 实现<code>UserDetailsServiceAutoConfiguration</code>。<code>SecurityAutoConfiguration</code>导入<code>SpringBootWebSecurityConfiguration</code>Web安全性并 <code>UserDetailsServiceAutoConfiguration</code>配置身份验证，这也与非Web应用程序相关。要完全关闭默认Web应用程序安全配置，您可以添加类型的bean <code>WebSecurityConfigurerAdapter</code>（这样做不会禁用<code>UserDetailsService</code>配置或Actuator的安全性）。</p>
<p>为了还关闭<code>UserDetailsService</code>的配置，您可以添加类型的豆 <code>UserDetailsService</code>，<code>AuthenticationProvider</code>或<code>AuthenticationManager</code>。<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-samples/" target="_blank" rel="noopener">Spring Boot示例中</a>有几个安全的应用程序可以帮助您开始使用常见的用例。</p>
<p>可以通过添加自定义来覆盖访问规则<code>WebSecurityConfigurerAdapter</code>。Spring Boot提供了便捷方法，可用于覆盖执行器端点和静态资源的访问规则。<code>EndpointRequest</code>可用于创建<code>RequestMatcher</code> 基于<code>management.endpoints.web.base-path</code>属性的。 <code>PathRequest</code>可用于<code>RequestMatcher</code>在常用位置创建资源。</p>
<h3 id="WebFlux安全性"><a href="#WebFlux安全性" class="headerlink" title="WebFlux安全性"></a>WebFlux安全性</h3><p>与Spring MVC应用程序类似，您可以通过添加<code>spring-boot-starter-security</code>依赖项来保护WebFlux应用程序。默认安全配置在<code>ReactiveSecurityAutoConfiguration</code>和中 实现<code>UserDetailsServiceAutoConfiguration</code>。<code>ReactiveSecurityAutoConfiguration</code>导入<code>WebFluxSecurityConfiguration</code>Web安全性并<code>UserDetailsServiceAutoConfiguration</code> 配置身份验证，这也与非Web应用程序相关。要完全关闭默认Web应用程序安全配置，您可以添加类型的bean <code>WebFilterChainProxy</code>（这样做不会禁用<code>UserDetailsService</code>配置或Actuator的安全性）。</p>
<p>要关闭<code>UserDetailsService</code>配置，可以添加类型为<code>ReactiveUserDetailsService</code>或的bean <code>ReactiveAuthenticationManager</code>。</p>
<p>可以通过添加自定义来配置访问规则<code>SecurityWebFilterChain</code>。Spring Boot提供了便捷方法，可用于覆盖执行器端点和静态资源的访问规则。<code>EndpointRequest</code>可用于创建 <code>ServerWebExchangeMatcher</code>基于<code>management.endpoints.web.base-path</code> 属性的。</p>
<p><code>PathRequest</code>可用于<code>ServerWebExchangeMatcher</code>在常用位置创建资源。</p>
<p>例如，您可以通过添加以下内容来自定义安全配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SecurityWebFilterChain <span class="title">springSecurityFilterChain</span><span class="params">(ServerHttpSecurity http)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> http.authorizeExchange()</span><br><span class="line">			.matchers(PathRequest.toStaticResources().atCommonLocations()).permitAll()</span><br><span class="line">			.pathMatchers(<span class="string">"/foo"</span>, <span class="string">"/bar"</span>)</span><br><span class="line">			.authenticated().and()</span><br><span class="line">			.formLogin().and()</span><br><span class="line">			.build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="OAuth2"><a href="#OAuth2" class="headerlink" title="OAuth2"></a>OAuth2</h3><p><a href="https://oauth.net/2/" target="_blank" rel="noopener">OAuth2</a>是Spring支持的一种广泛使用的授权框架。</p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><p>如果您具有<code>spring-security-oauth2-client</code>类路径，则可以利用某些自动配置来轻松设置OAuth2 / Open ID Connect客户端。此配置使用下的属性<code>OAuth2ClientProperties</code>。相同的属性适用于servlet和反应式应用程序。</p>
<p>您可以在<code>spring.security.oauth2.client</code>前缀下注册多个OAuth2客户端和提供程序 ，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">spring.security.oauth2.client.registration.my-client-1.client-id=abcd</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.client-secret=password</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.client-name=Client for user scope</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.provider=my-oauth-provider</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.scope=user</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.redirect-uri-template=http://my-redirect-uri.com</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.client-authentication-method=basic</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.authorization-grant-type=authorization_code</span><br><span class="line"></span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.client-id=abcd</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.client-secret=password</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.client-name=Client for email scope</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.provider=my-oauth-provider</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.scope=email</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.redirect-uri-template=http://my-redirect-uri.com</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.client-authentication-method=basic</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.authorization-grant-type=authorization_code</span><br><span class="line"></span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.authorization-uri=http://my-auth-server/oauth/authorize</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.token-uri=http://my-auth-server/oauth/token</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.user-info-uri=http://my-auth-server/userinfo</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.user-info-authentication-method=header</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.jwk-set-uri=http://my-auth-server/token_keys</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.user-name-attribute=name</span><br></pre></td></tr></table></figure>
<p>对于支持<a href="https://openid.net/specs/openid-connect-discovery-1_0.html" target="_blank" rel="noopener">OpenID Connect发现的</a> OpenID Connect提供程序，可以进一步简化配置。需要为提供程序配置一个<code>issuer-uri</code>URI，它将其声明为其颁发者标识符。例如，如果 <code>issuer-uri</code>提供的是“<a href="https://example.com”，`OpenID" target="_blank" rel="noopener">https://example.com”，`OpenID</a> Provider Configuration Request<code>则会进行“https://example.com/.well-known/openid-configuration”。结果预计是一个</code>OpenID Provider Configuration Response<code>。以下示例显示如何使用以下命令配置OpenID Connect Provider</code>issuer-uri`：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.security.oauth2.client.provider.oidc-provider.issuer-uri = https://dev-123456.oktapreview.com/oauth2/default/</span><br></pre></td></tr></table></figure>
<p>默认情况下，Spring Security <code>OAuth2LoginAuthenticationFilter</code>仅处理URL匹配<code>/login/oauth2/code/*</code>。如果要自定义<code>redirect-uri</code>以使用其他模式，则需要提供配置以处理该自定义模式。例如，对于servlet应用程序，您可以添加<code>WebSecurityConfigurerAdapter</code>类似于以下内容的应用程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OAuth2LoginSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		http</span><br><span class="line">			.authorizeRequests()</span><br><span class="line">				.anyRequest().authenticated()</span><br><span class="line">				.and()</span><br><span class="line">			.oauth2Login()</span><br><span class="line">				.redirectionEndpoint()</span><br><span class="line">					.baseUri(<span class="string">"/custom-callback"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>OAuth2客户端注册常见providers</strong></p>
<p>对于常见的OAuth2和OpenID提供商，包括谷歌，Github上，Facebook和1563，我们提供了一组供应商默认的（<code>google</code>，<code>github</code>，<code>facebook</code>，和<code>okta</code>，分别）。</p>
<p>如果您不需要自定义这些提供程序，则可以将<code>provider</code>属性设置为需要推断默认值的属性。此外，如果客户端注册的密钥与默认支持的提供程序匹配，则Spring Boot也会推断出。</p>
<p>换句话说，以下示例中的两个配置使用Google提供程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.security.oauth2.client.registration.my-client.client-id = abcd</span><br><span class="line">spring.security.oauth2.client.registration.my-client.client-secret = password</span><br><span class="line">spring.security.oauth2.client.registration.my- client.provider = google</span><br><span class="line"></span><br><span class="line">spring.security.oauth2.client.registration.google.client-id = abcd</span><br><span class="line">spring.security.oauth2.client.registration.google.client-secret = password</span><br></pre></td></tr></table></figure>
<h4 id="Resource-Server-资源服务器"><a href="#Resource-Server-资源服务器" class="headerlink" title="Resource Server(资源服务器)"></a>Resource Server(资源服务器)</h4><p>如果您具有<code>spring-security-oauth2-resource-server</code>类路径，则只要指定了JWK Set URI或OIDC Issuer URI，Spring Boot就可以设置OAuth2资源服务器，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.security.oauth2.resourceserver.jwt.jwk-set-uri = https://example.com/oauth2/default/v1/keys</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.security.oauth2.resourceserver.jwt.issuer-uri = https://dev-123456.oktapreview.com/oauth2/default/</span><br></pre></td></tr></table></figure>
<p>相同的属性适用于servlet和反应应用程序。</p>
<p>或者，您可以<code>JwtDecoder</code>为servlet应用程序或<code>ReactiveJwtDecoder</code>响应应用程序定义自己的bean 。</p>
<h4 id="Authorization-Server-授权服务器"><a href="#Authorization-Server-授权服务器" class="headerlink" title="Authorization Server(授权服务器)"></a>Authorization Server(授权服务器)</h4><p>目前，Spring Security不支持实施OAuth 2.0授权服务器。但是，此功能可从<a href="https://projects.spring.io/spring-security-oauth/" target="_blank" rel="noopener">Spring Security OAuth</a>项目获得，该项目最终将完全被Spring Security取代。在此之前，您可以使用该<code>spring-security-oauth2-autoconfigure</code>模块轻松设置OAuth 2.0授权服务器; 请参阅其<a href="https://docs.spring.io/spring-security-oauth2-boot" target="_blank" rel="noopener">文档</a>以获取说明</p>
<h3 id="Actuator-Security-执行器安全性"><a href="#Actuator-Security-执行器安全性" class="headerlink" title="Actuator Security(执行器安全性)"></a>Actuator Security(执行器安全性)</h3><p>出于安全考虑，默认情况下除了<code>/health</code>和<code>/info</code>禁用所有执行器。该<code>management.endpoints.web.exposure.include</code>属性可用于启用执行器。</p>
<p>如果春季安全是在类路径上，并没有其他WebSecurityConfigurerAdapter存在，比其他所有的驱动器<code>/health</code>，并<code>/info</code>通过春天开机自动配置安全。如果您定义自定义<code>WebSecurityConfigurerAdapter</code>，Spring Boot自动配置将退回，您将完全控制执行器访问规则。</p>
<blockquote>
<p>在设置之前<code>management.endpoints.web.exposure.include</code>，请确保暴露的执行器不包含敏感信息和/或通过将它们放在防火墙后面或通过Spring Security等方式进行保护。</p>
</blockquote>
<h4 id="跨站点请求伪造保护"><a href="#跨站点请求伪造保护" class="headerlink" title="跨站点请求伪造保护"></a>跨站点请求伪造保护</h4><p>由于Spring Boot依赖于Spring Security的默认值，因此默认情况下会启用CSRF保护。这意味着执行器端点需要<code>POST</code>（关闭和记录器端点），<code>PUT</code>或者<code>DELETE</code>在使用默认安全配置时将获得403禁止错误。</p>
<blockquote>
<p>我们建议仅在创建非浏览器客户端使用的服务时才完全禁用CSRF保护。</p>
</blockquote>
<p>有关CSRF保护的其他信息，请参阅“ <a href="https://docs.spring.io/spring-security/site/docs/5.1.4.RELEASE/reference/htmlsingle#csrf" target="_blank" rel="noopener">Spring Security参考指南”</a>。</p>
</div></div><a class="button-hover more" href="/2019/03/20/使用SpringBoot-Security/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/20/使用SpringBoot-开发Web应用程序/">使用SpringBoot-开发Web应用程序</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/web/">web</a></div></div><div class="post-content"><div class="main-content content"><h2 id="开发Web应用程序"><a href="#开发Web应用程序" class="headerlink" title="开发Web应用程序"></a>开发Web应用程序</h2><p>Spring Boot非常适合Web应用程序开发。您可以使用嵌入式Tomcat，Jetty，Undertow或Netty创建自包含的HTTP服务器。大多数Web应用程序使用该<code>spring-boot-starter-web</code>模块快速启动和运行。您还可以选择使用该<code>spring-boot-starter-webflux</code>模块构建响应式Web应用程序 。</p>
<p>如果您还没有开发Spring Boot Web应用程序，可以按照“Hello World！”进行操作。“ <em>入门”</em>部分中的示例 。</p>
<h3 id="Spring-Web-MVC框架"><a href="#Spring-Web-MVC框架" class="headerlink" title="Spring Web MVC框架"></a>Spring Web MVC框架</h3><p>在<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">SpringWeb MVC框架</a>（通常简称为“SpringMVC”）是一个丰富的“模型视图控制器” Web框架。Spring MVC允许您创建特殊<code>@Controller</code>或<code>@RestController</code>bean来处理传入的HTTP请求。控制器中的方法通过使用<code>@RequestMapping</code>注释映射到HTTP 。</p>
<p>以下代码显示了<code>@RestController</code>为JSON数据提供服务的典型代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span> </span><br><span class="line"><span class="meta">@RequestMapping</span>（value =“/ users”）</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRestController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping</span>（value =“/ &#123;user&#125;”，method = RequestMethod.GET）</span><br><span class="line">	 <span class="keyword">public</span> User getUser（ <span class="meta">@PathVariable</span> Long user）&#123;</span><br><span class="line">		 <span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping</span>（value =“/ &#123;user&#125; / customers”，method = RequestMethod.GET） </span><br><span class="line">	List &lt;Customer&gt; getUserCustomers（ <span class="meta">@PathVariable</span> Long user）&#123;</span><br><span class="line">		 <span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping</span>（value =“/ &#123;user&#125;”，method = RequestMethod.DELETE）</span><br><span class="line">	 <span class="keyword">public</span> User deleteUser（ <span class="meta">@PathVariable</span> Long user）&#123;</span><br><span class="line">		 <span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring MVC是核心Spring Framework的一部分，详细信息可在<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">参考文档中找到</a>。也有涵盖Spring MVC中提供一些指南<a href="https://spring.io/guides" target="_blank" rel="noopener">spring.io/guides</a>。</p>
<h4 id="Spring-MVC自动配置"><a href="#Spring-MVC自动配置" class="headerlink" title="Spring MVC自动配置"></a>Spring MVC自动配置</h4><p>Spring Boot为Spring MVC提供自动配置，适用于大多数应用程序。</p>
<p>自动配置在Spring的默认值之上添加了以下功能：</p>
<ul>
<li>包含<code>ContentNegotiatingViewResolver</code>和<code>BeanNameViewResolver</code>豆类。</li>
<li>支持提供静态资源，包括对WebJars的支持（ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-static-content" target="_blank" rel="noopener">本文档稍后介绍</a>））。</li>
<li>自动注册<code>Converter</code>，<code>GenericConverter</code>和<code>Formatter</code>豆类。</li>
<li>支持<code>HttpMessageConverters</code>（ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-message-converters" target="_blank" rel="noopener">本文档后面部分</a>）。</li>
<li>自动注册<code>MessageCodesResolver</code>（ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-spring-message-codes" target="_blank" rel="noopener">本文档后面部分</a>）。</li>
<li>静态<code>index.html</code>支持。</li>
<li>自定义<code>Favicon</code>支持（<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-favicon" target="_blank" rel="noopener">本文档稍后介绍</a>）。</li>
<li>自动使用<code>ConfigurableWebBindingInitializer</code>bean（ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-web-binding-initializer" target="_blank" rel="noopener">本文档稍后介绍</a>）。</li>
</ul>
<p>如果您想保留Spring Boot MVC功能并且想要添加其他 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">MVC配置</a>（拦截器，格式化程序，视图控制器和其他功能），您可以添加自己的<code>@Configuration</code>类类型<code>WebMvcConfigurer</code>但<strong>不需要</strong> <code>@EnableWebMvc</code>。如果您希望提供，或的 自定义实例<code>RequestMappingHandlerMapping</code>，则可以声明 实例以提供此类组件。<code>RequestMappingHandlerAdapter`</code>ExceptionHandlerExceptionResolver<code></code>WebMvcRegistrationsAdapter`</p>
<p>如果您想完全控制Spring MVC，可以添加自己的<code>@Configuration</code> 注释<code>@EnableWebMvc</code>。</p>
<h4 id="HttpMessageConverters"><a href="#HttpMessageConverters" class="headerlink" title="HttpMessageConverters"></a>HttpMessageConverters</h4><p>Spring MVC使用该<code>HttpMessageConverter</code>接口来转换HTTP请求和响应。明智的默认设置包含在开箱即用中。例如，对象可以自动转换为JSON（通过使用Jackson库）或XML（如果可用，则使用Jackson XML扩展，或者如果Jackson XML扩展不可用，则使用JAXB）。默认情况下，字符串是以编码的<code>UTF-8</code>。</p>
<p>如果需要添加或自定义转换器，可以使用Spring Boot的 <code>HttpMessageConverters</code>类，如下面的清单所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.web.HttpMessageConverters;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> HttpMessageConverters <span class="title">customConverters</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		HttpMessageConverter&lt;?&gt; additional = ...</span><br><span class="line">		HttpMessageConverter&lt;?&gt; another = ...</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> HttpMessageConverters(additional, another);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>HttpMessageConverter</code>上下文中存在的任何bean都将添加到转换器列表中。您也可以以相同的方式覆盖默认转换器。</p>
<h4 id="自定义JSON序列化程序和反序列化程序"><a href="#自定义JSON序列化程序和反序列化程序" class="headerlink" title="自定义JSON序列化程序和反序列化程序"></a>自定义JSON序列化程序和反序列化程序</h4><p>如果您使用Jackson序列化和反序列化JSON数据，您可能希望编写自己的类<code>JsonSerializer</code>和<code>JsonDeserializer</code>类。自定义序列化程序通常 <a href="https://github.com/FasterXML/jackson-docs/wiki/JacksonHowToCustomSerializers" target="_blank" rel="noopener">通过模块向Jackson注册</a>，但Spring Boot提供了另一种<code>@JsonComponent</code>注释，可以更容易地直接注册Spring Beans。</p>
<p>您可以<code>@JsonComponent</code>直接使用注释<code>JsonSerializer</code>或 <code>JsonDeserializer</code>实现。您还可以在包含序列化程序/反序列化程序作为内部类的类上使用它，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.*;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.jackson.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonComponent</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Serializer</span> <span class="keyword">extends</span> <span class="title">JsonSerializer</span>&lt;<span class="title">SomeObject</span>&gt; </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Deserializer</span> <span class="keyword">extends</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">SomeObject</span>&gt; </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中的所有<code>@JsonComponent</code>豆子都会<code>ApplicationContext</code>自动在杰克逊注册。因为<code>@JsonComponent</code>是元注释<code>@Component</code>，所以通常的组件扫描规则适用。</p>
<p>春季启动也提供 <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectSerializer.java" target="_blank" rel="noopener"><code>JsonObjectSerializer</code></a>和 <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectDeserializer.java" target="_blank" rel="noopener"><code>JsonObjectDeserializer</code></a>基础类，序列化对象时提供标准版本的杰克逊有用的替代。见 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api/org/springframework/boot/jackson/JsonObjectSerializer.html" target="_blank" rel="noopener"><code>JsonObjectSerializer</code></a>和<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api/org/springframework/boot/jackson/JsonObjectDeserializer.html" target="_blank" rel="noopener"><code>JsonObjectDeserializer</code></a>在Javadoc了解详情。</p>
<h4 id="MessageCodesResolver"><a href="#MessageCodesResolver" class="headerlink" title="MessageCodesResolver"></a>MessageCodesResolver</h4><p>Spring MVC有一个生成错误代码的策略，用于从绑定错误中呈现错误消息：<code>MessageCodesResolver</code>。如果设置了<code>spring.mvc.message-codes-resolver.format</code>财产<code>PREFIX_ERROR_CODE</code>或 <code>POSTFIX_ERROR_CODE</code>春季启动为您创建一个（见枚举<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.Format.html" target="_blank" rel="noopener"><code>DefaultMessageCodesResolver.Format</code></a>）。</p>
<h4 id="静态内容"><a href="#静态内容" class="headerlink" title="静态内容"></a>静态内容</h4><p>默认情况下，Spring Boot从类路径中的<code>/static</code>（ <code>/public</code>或<code>/resources</code>或<code>/META-INF/resources</code>）目录或者根目录中提供静态内容<code>ServletContext</code>。它使用<code>ResourceHttpRequestHandler</code>Spring MVC，以便您可以通过添加自己<code>WebMvcConfigurer</code>的<code>addResourceHandlers</code>方法来修改该行为并覆盖该 方法。</p>
<p>在独立的Web应用程序中，容器中的默认servlet也会启用，并作为后备，从<code>ServletContext</code>if 的根目录提供内容，决定不处理它。大多数情况下，这不会发生（除非你修改默认的MVC配置），因为Spring总是可以通过它来处理请求 <code>DispatcherServlet</code>。</p>
<p>默认情况下，会映射资源<code>/**</code>，但您可以使用该<code>spring.mvc.static-path-pattern</code>属性对其进行调整 。例如，重新定位所有资源 <code>/resources/**</code>可以实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.static-path-pattern = /resources/**</span><br></pre></td></tr></table></figure>
<p>您还可以使用该<code>spring.resources.static-locations</code>属性自定义静态资源位置 （将默认值替换为目录位置列表）。根Servlet上下文路径<code>&quot;/&quot;</code>也会自动添加为位置。</p>
<p>除了前面提到的“标准”静态资源位置之外，还为<a href="https://www.webjars.org/" target="_blank" rel="noopener">Webjars内容</a>制作了一个特例。具有路径的任何资源 <code>/webjars/**</code>都是从jar文件提供的，如果它们以Webjars格式打包的话。</p>
<blockquote>
<p><code>src/main/webapp</code>如果您的应用程序打包为jar，请不要使用该目录。虽然这个目录是一个通用的标准，它的工作原理<strong>只是</strong>war的包装，它是默默大多数构建工具忽略，如果你生成一个jar。</p>
</blockquote>
<p>Spring Boot还支持Spring MVC提供的高级资源处理功能，允许使用缓存破坏静态资源或使用与Webjars无关的URL。</p>
<p>要为Webjars使用版本无关的URL，请添加<code>webjars-locator-core</code>依赖项。然后声明你的Webjar。以jQuery为例，添加 <code>&quot;/webjars/jquery/jquery.min.js&quot;</code>结果 <code>&quot;/webjars/jquery/x.y.z/jquery.min.js&quot;</code>。<code>x.y.z</code>Webjar版本在哪里。</p>
<blockquote>
<p>如果你使用JBoss，你需要声明<code>webjars-locator-jboss-vfs</code> 依赖而不是<code>webjars-locator-core</code>。否则，所有Webjars都会解析为 <code>404</code>。</p>
</blockquote>
<p>要使用缓存清除，以下配置会为所有静态资源配置缓存清除解决方案，从而有效地<code>&lt;link href=&quot;/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css&quot;/&gt;</code>在URL中添加内容哈希，例如 ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.resources.chain.strategy.content.enabled = true</span><br><span class="line">spring.resources.chain.strategy.content.paths = /**</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于<code>ResourceUrlEncodingFilter</code>为Thymeleaf和FreeMarker自动配置了资源链接，因此在运行时会在模板中重写 。您应该在使用JSP时手动声明此过滤器。目前不支持其他模板引擎，但可以使用自定义模板宏/帮助程序和使用 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/javadoc-api/org/springframework/web/servlet/resource/ResourceUrlProvider.html" target="_blank" rel="noopener"><code>ResourceUrlProvider</code></a>。</p>
</blockquote>
<p>使用（例如）JavaScript模块加载器动态加载资源时，不能重命名文件。这就是为什么其他策略也得到支持并可以合并的原因。“固定”策略在URL中添加静态版本字符串而不更改文件名，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.resources.chain.strategy.content.enabled = true</span><br><span class="line">spring.resources.chain.strategy.content.paths = / **</span><br><span class="line">spring.resources.chain.strategy.fixed.enabled = true</span><br><span class="line">spring.resources.chain.strategy.fixed .paths = / js / lib /</span><br><span class="line">spring.resources.chain.strategy.fixed.version = v12</span><br></pre></td></tr></table></figure>
<p>使用此配置，JavaScript模块位于<code>&quot;/js/lib/&quot;</code>使用固定版本控制策略（<code>&quot;/v12/js/lib/mymodule.js&quot;</code>），而其他资源仍使用内容one（<code>&lt;link href=&quot;/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css&quot;/&gt;</code>）。</p>
<p>有关更多支持选项，请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ResourceProperties.java" target="_blank" rel="noopener"><code>ResourceProperties</code></a> </p>
<blockquote>
<p>此功能已在专门的<a href="https://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources" target="_blank" rel="noopener">博客文章</a>和Spring Framework的 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#mvc-config-static-resources" target="_blank" rel="noopener">参考文档中</a>进行了详细描述 。</p>
</blockquote>
<h4 id="欢迎页面"><a href="#欢迎页面" class="headerlink" title="欢迎页面"></a>欢迎页面</h4><p>Spring Boot支持静态和模板化欢迎页面。它首先<code>index.html</code>在配置的静态内容位置中查找 文件。如果找不到，则查找<code>index</code>模板。如果找到任何一个，它将自动用作应用程序的欢迎页面。</p>
<h4 id="自定义Favicon"><a href="#自定义Favicon" class="headerlink" title="自定义Favicon"></a>自定义Favicon</h4><p>Spring Boot <code>favicon.ico</code>在配置的静态内容位置和类路径的根（按此顺序）中查找a 。如果存在这样的文件，它将自动用作应用程序的favicon。</p>
<h4 id="路径匹配和内容协商"><a href="#路径匹配和内容协商" class="headerlink" title="路径匹配和内容协商"></a>路径匹配和内容协商</h4><p>Spring MVC可以通过查看请求路径并将其与应用程序中定义的映射（例如，<code>@GetMapping</code> Controller方法上的注释）相匹配，将传入的HTTP请求映射到处理程序。</p>
<p>Spring Boot默认选择禁用后缀模式匹配，这意味着请求<code>&quot;GET /projects/spring-boot.json&quot;</code>不会与<code>@GetMapping(&quot;/projects/spring-boot&quot;)</code>映射匹配 。这被认为是<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-suffix-pattern-match" target="_blank" rel="noopener">Spring MVC应用程序</a>的 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-suffix-pattern-match" target="_blank" rel="noopener">最佳实践</a>。对于没有发送正确“接受”请求标头的HTTP客户端，此功能在过去主要有用; 我们需要确保将正确的内容类型发送给客户端。如今，内容协商更加可靠。</p>
<p>还有其他方法可以处理不一致发送正确“接受”请求标头的HTTP客户端。我们可以使用查询参数来确保将请求<code>&quot;GET /projects/spring-boot?format=json&quot;</code> 映射到<code>@GetMapping(&quot;/projects/spring-boot&quot;)</code>以下内容，而不是使用后缀匹配：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.contentnegotiation.favor-parameter = true</span><br><span class="line"></span><br><span class="line">＃我们可以更改参数名称，默认为“format”：</span><br><span class="line">＃spring.mvc.contentnegotiation.parameter-name = myparam</span><br><span class="line"></span><br><span class="line">＃我们还可以注册其他文件扩展名/媒体类型：</span><br><span class="line">spring.mvc.contentnegotiation.media-types.markdown = text/markdown</span><br></pre></td></tr></table></figure>
<p>如果您了解警告并仍希望您的应用程序使用后缀模式匹配，则需要以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.contentnegotiation.favor-path-extension = true</span><br><span class="line">spring.mvc.pathmatch.use-suffix-pattern = true</span><br></pre></td></tr></table></figure>
<p>或者，不是打开所有后缀模式，而是仅支持已注册的后缀模式更安全：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.contentnegotiation.favor-path-extension = true</span><br><span class="line">spring.mvc.pathmatch.use-registered-suffix-pattern = true</span><br><span class="line"></span><br><span class="line">＃您还可以注册其他文件扩展名/媒体类型：</span><br><span class="line">＃spring.mvc.contentnegotiation.media-types.adoc = text/asciidoc</span><br></pre></td></tr></table></figure>
<h4 id="ConfigurableWebBindingInitializer"><a href="#ConfigurableWebBindingInitializer" class="headerlink" title="ConfigurableWebBindingInitializer"></a>ConfigurableWebBindingInitializer</h4><p>Spring MVC使用一个 <code>WebBindingInitializer</code>来初始化<code>WebDataBinder</code>特定请求。如果你自己创建<code>ConfigurableWebBindingInitializer</code> <code>@Bean</code>，Spring Boot会自动配置Spring MVC来使用它。</p>
<h4 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h4><p>除REST Web服务外，您还可以使用Spring MVC来提供动态HTML内容。Spring MVC支持各种模板技术，包括Thymeleaf，FreeMarker和JSP。此外，许多其他模板引擎包括他们自己的Spring MVC集成。</p>
<p>Spring Boot包括对以下模板引擎的自动配置支持：</p>
<ul>
<li><a href="https://freemarker.apache.org/docs/" target="_blank" rel="noopener">FreeMarker</a></li>
<li><a href="http://docs.groovy-lang.org/docs/next/html/documentation/template-engines.html#_the_markuptemplateengine" target="_blank" rel="noopener">Groovy</a></li>
<li><a href="http://www.thymeleaf.org/" target="_blank" rel="noopener">Thymeleaf</a></li>
<li><a href="https://mustache.github.io/" target="_blank" rel="noopener">Mustache</a></li>
</ul>
<blockquote>
<p>如果可能，应该避免使用JSP。将它们与嵌入式servlet容器一起使用时有几个 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-jsp-limitations" target="_blank" rel="noopener">已知的限制</a>。</p>
</blockquote>
<p>当您使用其中一个模板引擎和默认配置时，您的模板将自动从中获取<code>src/main/resources/templates</code>。</p>
<blockquote>
<p>根据您运行应用程序的方式，IntelliJ IDEA以不同方式对类路径进行排序。从主方法在IDE中运行应用程序会导致与使用Maven或Gradle或其打包的jar运行应用程序时的顺序不同。这可能导致Spring Boot无法在类路径中找到模板。如果遇到此问题，可以在IDE中重新排序类路径，以便首先放置模块的类和资源。或者，您可以配置模板前缀以搜索<code>templates</code>类路径上的每个目录，如下所示： <code>classpath*:/templates/</code>。</p>
</blockquote>
<h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><p>默认情况下，Spring Boot提供了一个<code>/error</code>以合理方式处理所有错误的映射，并将其注册为servlet容器中的“全局”错误页面。对于计算机客户端，它会生成一个JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，有一个“whitelabel”错误视图，它以HTML格式呈现相同的数据（以自定义它，添加<code>View</code>解析后的数据<code>error</code>）。要完全替换默认行为，您可以实现 <code>ErrorController</code>并注册该类型的bean定义，或者添加类型的bean <code>ErrorAttributes</code>以使用现有机制但替换内容。</p>
<blockquote>
<p>在<code>BasicErrorController</code>可以用作自定义基类 <code>ErrorController</code>。如果要为新内容类型添加处理程序（默认情况下是<code>text/html</code>专门处理并为其他所有内容提供后备），这将特别有用。为此，请扩展<code>BasicErrorController</code>，添加<code>@RequestMapping</code>具有<code>produces</code>属性的公共方法 ，并创建新类型的bean。</p>
</blockquote>
<p>您还可以定义一个带注释的类，<code>@ControllerAdvice</code>以自定义要为特定控制器和/或异常类型返回的JSON文档，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span>(basePackageClasses = AcmeController.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeControllerAdvice</span> <span class="keyword">extends</span> <span class="title">ResponseEntityExceptionHandler</span> </span>&#123;</span><br><span class="line">	<span class="meta">@ExceptionHandler</span>(YourException.class)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	ResponseEntity&lt;?&gt; handleControllerException(HttpServletRequest request, Throwable ex) &#123;</span><br><span class="line">		HttpStatus status = getStatus(request);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(<span class="keyword">new</span> CustomErrorType(status.value(), ex.getMessage()), status);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> HttpStatus <span class="title">getStatus</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		Integer statusCode = (Integer) request.getAttribute(<span class="string">"javax.servlet.error.status_code"</span>);</span><br><span class="line">		<span class="keyword">if</span> (statusCode == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> HttpStatus.INTERNAL_SERVER_ERROR;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> HttpStatus.valueOf(statusCode);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在前面的示例中，如果<code>YourException</code>由在同一个包中定义的控制器抛出，则使用POJO <code>AcmeController</code>的JSON表示<code>CustomErrorType</code>而不是<code>ErrorAttributes</code>表示。</p>
<p><strong>自定义错误页面</strong></p>
<p>如果要显示给定状态代码的自定义HTML错误页面，可以将文件添加到文件<code>/error</code>夹。错误页面可以是静态HTML（即，添加到任何静态资源文件夹下），也可以使用模板构建。文件名应该是确切的状态代码或系列掩码。</p>
<p>例如，要映射<code>404</code>到静态HTML文件，您的文件夹结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line"> +- main/</span><br><span class="line">     +- java/</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources/</span><br><span class="line">         +- public/</span><br><span class="line">             +- error/</span><br><span class="line">             |   +- 404.html</span><br><span class="line">             +- &lt;other public assets&gt;</span><br></pre></td></tr></table></figure>
<p>要<code>5xx</code>使用FreeMarker模板映射所有错误，您的文件夹结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line"> +- main/</span><br><span class="line">     +- java/</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources/</span><br><span class="line">         +- templates/</span><br><span class="line">             +- error/</span><br><span class="line">             |   +- 5xx.ftl</span><br><span class="line">             +- &lt;other templates&gt;</span><br></pre></td></tr></table></figure>
<p>对于更复杂的映射，您还可以添加实现该<code>ErrorViewResolver</code> 接口的bean ，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorViewResolver</span> <span class="keyword">implements</span> <span class="title">ErrorViewResolver</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// Use the request or status to optionally return a ModelAndView</span></span><br><span class="line">		<span class="keyword">return</span> ...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您还可以使用常规的Spring MVC功能，例如 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#mvc-exceptionhandlers" target="_blank" rel="noopener"><code>@ExceptionHandler</code>方法</a>和 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#mvc-ann-controller-advice" target="_blank" rel="noopener"><code>@ControllerAdvice</code></a>。在 <code>ErrorController</code>随后拿起任何未处理的异常。</p>
<p><strong>映射Spring MVC之外的错误页面</strong></p>
<p>对于不使用Spring MVC的应用程序，可以使用该<code>ErrorPageRegistrar</code> 接口直接注册<code>ErrorPages</code>。这种抽象直接与底层嵌入式servlet容器一起工作，即使你没有Spring MVC也可以工作 <code>DispatcherServlet</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ErrorPageRegistrar <span class="title">errorPageRegistrar</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> MyErrorPageRegistrar();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorPageRegistrar</span> <span class="keyword">implements</span> <span class="title">ErrorPageRegistrar</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerErrorPages</span><span class="params">(ErrorPageRegistry registry)</span> </span>&#123;</span><br><span class="line">		registry.addErrorPages(<span class="keyword">new</span> ErrorPage(HttpStatus.BAD_REQUEST, <span class="string">"/400"</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果您注册的<code>ErrorPage</code>路径最终由a处理<code>Filter</code> （与一些非Spring Web框架（如Jersey和Wicket）一样），那么 <code>Filter</code>必须将其显式注册为<code>ERROR</code>调度程序，如以下示例所示：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">myFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	FilterRegistrationBean registration = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">	registration.setFilter(<span class="keyword">new</span> MyFilter());</span><br><span class="line">	...</span><br><span class="line">	registration.setDispatcherTypes(EnumSet.allOf(DispatcherType.class));</span><br><span class="line">	<span class="keyword">return</span> registration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意，默认值<code>FilterRegistrationBean</code>不包括<code>ERROR</code>调度程序类型。</p>
<p>小心：当部署到servlet容器时，Spring Boot使用其错误页面过滤器将具有错误状态的请求转发到相应的错误页面。如果尚未提交响应，则只能将请求转发到正确的错误页面。缺省情况下，WebSphere Application Server 8.0及更高版本在成功完成servlet的服务方法后提交响应。您应该通过设置<code>com.ibm.ws.webcontainer.invokeFlushAfterService</code>为禁用此行为 <code>false</code>。</p>
<h4 id="Spring-HATEOAS"><a href="#Spring-HATEOAS" class="headerlink" title="Spring HATEOAS"></a>Spring HATEOAS</h4><p>如果您开发使用超媒体的RESTful API，Spring Boot为Spring HATEOAS提供自动配置，适用于大多数应用程序。自动配置取代了使用<code>@EnableHypermediaSupport</code>和注册多个bean 的需要，以便于构建基于超媒体的应用程序，包括 <code>LinkDiscoverers</code>（用于客户端支持）和<code>ObjectMapper</code>配置为正确编组响应到所需表示的响应。的<code>ObjectMapper</code>是通过设置各种定制的<code>spring.jackson.*</code>属性，或者，如果存在的话，通过一个<code>Jackson2ObjectMapperBuilder</code>豆。</p>
<p>您可以使用控制Spring HATEOAS的配置 <code>@EnableHypermediaSupport</code>。请注意，这样做会禁用<code>ObjectMapper</code>前面描述的自定义。</p>
<h4 id="CORS支持"><a href="#CORS支持" class="headerlink" title="CORS支持"></a>CORS支持</h4><p><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank" rel="noopener">跨源资源共享</a> （CORS）是<a href="https://caniuse.com/#feat=cors" target="_blank" rel="noopener">大多数浏览器</a>实现 的<a href="https://www.w3.org/TR/cors/" target="_blank" rel="noopener">W3C规范</a>，允许您以灵活的方式指定授权何种跨域请求，而不是使用一些安全性较低且功能较弱的方法，如IFRAME或JSONP。</p>
<p>从版本4.2开始，Spring MVC <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#cors" target="_blank" rel="noopener">支持CORS</a>。 在Spring Boot应用程序中使用带有 注释的<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#controller-method-cors-configuration" target="_blank" rel="noopener">控制器方法CORS配置</a><a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html" target="_blank" rel="noopener"><code>@CrossOrigin</code></a>不需要任何特定配置。 可以通过使用自定义方法注册bean 来定义<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#global-cors-configuration" target="_blank" rel="noopener">全局CORS配置</a>，如以下示例所示：<code>WebMvcConfigurer</code>. <code>addCorsMappings(CorsRegistry)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">corsConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">				registry.addMapping(<span class="string">"/api/**"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Spring-WebFlux框架"><a href="#Spring-WebFlux框架" class="headerlink" title="Spring WebFlux框架"></a>Spring WebFlux框架</h3><p>Spring WebFlux是Spring Framework 5.0中引入的新的响应式Web框架。与Spring MVC不同，它不需要Servlet API，完全异步且无阻塞，并 通过<a href="https://projectreactor.io/" target="_blank" rel="noopener">Reactor项目</a>实现<a href="http://www.reactive-streams.org/" target="_blank" rel="noopener">Reactive Streams</a>规范。</p>
<p>Spring WebFlux有两种版本：基于功能和注释。基于注释的注释非常接近Spring MVC模型，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRestController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/&#123;user&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title">getUser</span><span class="params">(@PathVariable Long user)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/&#123;user&#125;/customers"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Flux&lt;Customer&gt; <span class="title">getUserCustomers</span><span class="params">(@PathVariable Long user)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;user&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title">deleteUser</span><span class="params">(@PathVariable Long user)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>“WebFlux.fn”是功能变体，它将路由配置与请求的实际处理分开，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoutingConfiguration</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title">monoRouterFunction</span><span class="params">(UserHandler userHandler)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> route(GET(<span class="string">"/&#123;user&#125;"</span>)</span><br><span class="line">                .and(accept(APPLICATION_JSON)), userHandler::getUser)</span><br><span class="line">				.andRoute(GET(<span class="string">"/&#123;user&#125;/customers"</span>)</span><br><span class="line">                .and(accept(APPLICATION_JSON)), userHandler::getUserCustomers)</span><br><span class="line">				.andRoute(DELETE(<span class="string">"/&#123;user&#125;"</span>)</span><br><span class="line">                .and(accept(APPLICATION_JSON)), userHandler::deleteUser);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserHandler</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">getUser</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">getUserCustomers</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">deleteUser</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WebFlux是Spring Framework的一部分，详细信息可在其 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web-reactive.html#webflux-fn" target="_blank" rel="noopener">参考文档中找到</a>。</p>
<blockquote>
<p>您可以根据需要定义任意数量的<code>RouterFunction</code>bean来模块化路由器的定义。如果需要应用优先级，可以订购Bean。</p>
</blockquote>
<p>要开始，请将<code>spring-boot-starter-webflux</code>模块添加到您的应用程序中。</p>
<blockquote>
<p>在应用程序中添加两个<code>spring-boot-starter-web</code>和<code>spring-boot-starter-webflux</code>模块会导致Spring Boot自动配置Spring MVC，而不是WebFlux。选择此行为是因为许多Spring开发人员<code>spring-boot-starter-webflux</code> 在其Spring MVC应用程序中添加了使用被动的<code>WebClient</code>。您仍然可以通过将所选应用程序类型设置为来强制执行您的选择<code>SpringApplication.setWebApplicationType(WebApplicationType.REACTIVE)</code>。</p>
</blockquote>
<h4 id="Spring-WebFlux自动配置"><a href="#Spring-WebFlux自动配置" class="headerlink" title="Spring WebFlux自动配置"></a>Spring WebFlux自动配置</h4><p>Spring Boot为Spring WebFlux提供自动配置，适用于大多数应用程序。</p>
<p>自动配置在Spring的默认值之上添加了以下功能：</p>
<ul>
<li>为for <code>HttpMessageReader</code>和<code>HttpMessageWriter</code>实例配置编解码器（ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-webflux-httpcodecs" target="_blank" rel="noopener">在本文档后面介绍</a>）。</li>
<li>支持提供静态资源，包括对WebJars的支持（ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-static-content" target="_blank" rel="noopener">在本文档后面介绍</a>）。</li>
</ul>
<p>如果你想保留Spring Boot WebFlux功能，并且想要添加额外的 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#web-reactive" target="_blank" rel="noopener">WebFlux配置</a>，你可以添加自己的 <code>@Configuration</code>类类<code>WebFluxConfigurer</code>但<strong>不需要</strong><code>@EnableWebFlux</code>。</p>
<p>如果您想完全控制Spring WebFlux，可以添加自己的 <code>@Configuration</code>注释<code>@EnableWebFlux</code>。</p>
<h4 id="带有HttpMessageReaders和HttpMessageWriters的HTTP编解码器"><a href="#带有HttpMessageReaders和HttpMessageWriters的HTTP编解码器" class="headerlink" title="带有HttpMessageReaders和HttpMessageWriters的HTTP编解码器"></a>带有HttpMessageReaders和HttpMessageWriters的HTTP编解码器</h4><p>Spring WebFlux使用<code>HttpMessageReader</code>和<code>HttpMessageWriter</code>接口转换HTTP请求和响应。<code>CodecConfigurer</code>通过查看类路径中可用的库，它们被配置为具有合理的默认值。</p>
<p>Spring Boot通过使用<code>CodecCustomizer</code>实例进一步自定义。例如，<code>spring.jackson.*</code>配置密钥应用于Jackson编解码器。</p>
<p>如果需要添加或自定义编解码器，可以创建自定义<code>CodecCustomizer</code> 组件，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.codec.CodecCustomizer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> CodecCustomizer <span class="title">myCodecCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> codecConfigurer -&gt; &#123;</span><br><span class="line">			<span class="comment">// ...</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您还可以利用<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-json-components" target="_blank" rel="noopener">Boot的自定义JSON序列化程序和反序列化程序</a>。</p>
<h4 id="静态内容-1"><a href="#静态内容-1" class="headerlink" title="静态内容"></a>静态内容</h4><p>默认情况下，Spring Boot从类路径中名为<code>/static</code>（ <code>/public</code>或<code>/resources</code>或<code>/META-INF/resources</code>）的目录中提供静态内容。它使用<code>ResourceWebHandler</code>Spring WebFlux，以便您可以通过添加自己<code>WebFluxConfigurer</code>的<code>addResourceHandlers</code>方法来修改该行为并覆盖该方法。</p>
<p>默认情况下，映射资源<code>/**</code>，但您可以通过设置<code>spring.webflux.static-path-pattern</code>属性来调整它 。例如，重新定位所有资源 <code>/resources/**</code>可以实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.webflux.static-path-pattern = /resources/**</span><br></pre></td></tr></table></figure>
<p>您还可以使用自定义静态资源位置 <code>spring.resources.static-locations</code>。这样做会将默认值替换为目录位置列表。如果这样做，默认的欢迎页面检测将切换到您的自定义位置。因此，如果<code>index.html</code>您的任何位置在启动时存在，则它是应用程序的主页。</p>
<p>除了前面列出的“标准”静态资源位置之外，还为<a href="https://www.webjars.org/" target="_blank" rel="noopener">Webjars内容</a>制作了一个特例。具有路径的任何资源 <code>/webjars/**</code>都是从jar文件提供的，如果它们以Webjars格式打包的话。</p>
<blockquote>
<p>Spring WebFlux应用程序并不严格依赖于Servlet API，因此它们不能作为war文件部署，也不能使用该<code>src/main/webapp</code>目录。</p>
</blockquote>
<h4 id="模板引擎-1"><a href="#模板引擎-1" class="headerlink" title="模板引擎"></a>模板引擎</h4><p>除REST Web服务外，您还可以使用Spring WebFlux来提供动态HTML内容。Spring WebFlux支持各种模板技术，包括Thymeleaf，FreeMarker和Mustache。</p>
<p>Spring Boot包括对以下模板引擎的自动配置支持：</p>
<ul>
<li><a href="https://freemarker.apache.org/docs/" target="_blank" rel="noopener">FreeMarker</a></li>
<li><a href="http://www.thymeleaf.org/" target="_blank" rel="noopener">Thymeleaf</a></li>
<li><a href="https://mustache.github.io/" target="_blank" rel="noopener">Mustache</a></li>
</ul>
<p>当您使用其中一个模板引擎和默认配置时，您的模板将自动从中获取<code>src/main/resources/templates</code>。</p>
<h4 id="错误处理-1"><a href="#错误处理-1" class="headerlink" title="错误处理"></a>错误处理</h4><p>Spring Boot提供了<code>WebExceptionHandler</code>一种以合理的方式处理所有错误的方法。它在处理顺序中的位置紧接在WebFlux提供的处理程序之前，这些处理程序被认为是最后一个。对于计算机客户端，它会生成一个JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，有一个“whitelabel”错误处理程序，它以HTML格式呈现相同的数据。您还可以提供自己的HTML模板来显示错误（请参阅 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-webflux-error-handling-custom-error-pages" target="_blank" rel="noopener">下一节</a>）。</p>
<p>自定义此功能的第一步通常涉及使用现有机制，但替换或扩充错误内容。为此，您可以添加类型的bean <code>ErrorAttributes</code>。</p>
<p>要更改错误处理行为，可以实现<code>ErrorWebExceptionHandler</code>并注册该类型的bean定义。由于a <code>WebExceptionHandler</code>是一个非常低级的，Spring Boot还提供了一个方便<code>AbstractErrorWebExceptionHandler</code>的让你以WebFlux功能方式处理错误，如下例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomErrorWebExceptionHandler</span> <span class="keyword">extends</span> <span class="title">AbstractErrorWebExceptionHandler</span> </span>&#123;</span><br><span class="line">	<span class="comment">//在这里定义构造函数</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> RouterFunction&lt;ServerResponse&gt; <span class="title">getRoutingFunction</span><span class="params">(ErrorAttributes errorAttributes)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> RouterFunctions</span><br><span class="line">				.route(aPredicate, aHandler)</span><br><span class="line">				.andRoute(anotherPredicate, anotherHandler);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要获得更完整的图片，您还可以<code>DefaultErrorWebExceptionHandler</code> 直接子类化并覆盖特定方法。</p>
<p><strong>自定义错误页面</strong></p>
<p>如果要显示给定状态代码的自定义HTML错误页面，可以将文件添加到文件<code>/error</code>夹。错误页面可以是静态HTML（即，添加到任何静态资源文件夹下）或使用模板构建。文件名应该是确切的状态代码或系列掩码。</p>
<p>例如，要映射<code>404</code>到静态HTML文件，您的文件夹结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line"> +- main/</span><br><span class="line">     +- java/</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources/</span><br><span class="line">         +- public/</span><br><span class="line">             +- error/</span><br><span class="line">             |   +- 404.html</span><br><span class="line">             +- &lt;other public assets&gt;</span><br></pre></td></tr></table></figure>
<p>要<code>5xx</code>使用<code>Mustache</code>模板映射所有错误，您的文件夹结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line"> +- main/</span><br><span class="line">     +- java/</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources/</span><br><span class="line">         +- templates/</span><br><span class="line">             +- error/</span><br><span class="line">             |   +- 5xx.mustache</span><br><span class="line">             +- &lt;other templates&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Web过滤器"><a href="#Web过滤器" class="headerlink" title="Web过滤器"></a>Web过滤器</h4><p>Spring WebFlux提供了一个<code>WebFilter</code>可以实现过滤HTTP请求 - 响应交换的接口。<code>WebFilter</code>在应用程序上下文中找到的bean将自动用于过滤每个交换。</p>
<p>如果过滤器的顺序很重要，则可以实现<code>Ordered</code>或注释<code>@Order</code>。Spring Boot自动配置可以为您配置Web过滤器。执行此操作时，将使用下表中显示的订单：</p>
<table>
<thead>
<tr>
<th style="text-align:center">Web Filter</th>
<th style="text-align:center">Order</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>MetricsWebFilter</code></td>
<td style="text-align:center"><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td>
</tr>
<tr>
<td style="text-align:center"><code>WebFilterChainProxy</code> （spring Security）</td>
<td style="text-align:center"><code>-100</code></td>
</tr>
<tr>
<td style="text-align:center"><code>HttpTraceWebFilter</code></td>
<td style="text-align:center"><code>Ordered.LOWEST_PRECEDENCE - 10</code></td>
</tr>
</tbody>
</table>
<h3 id="JAX-RS-and-Jersey"><a href="#JAX-RS-and-Jersey" class="headerlink" title="JAX-RS and Jersey"></a>JAX-RS and Jersey</h3><p>如果您更喜欢REST端点的JAX-RS编程模型，则可以使用其中一个可用的实现而不是Spring MVC。<a href="https://jersey.github.io/" target="_blank" rel="noopener">Jersey</a>和 <a href="https://cxf.apache.org/" target="_blank" rel="noopener">Apache CXF</a>开箱即用。CXF要求您在应用程序上下文中注册<code>Servlet</code>或<code>Filter</code>作为其注册<code>@Bean</code>。Jersey有一些原生的Spring支持，因此我们还在Spring Boot中为它提供了自动配置支持以及启动器。</p>
<p>要开始使用Jersey，请将其<code>spring-boot-starter-jersey</code>作为依赖项包含在内，然后您需要一个注册所有端点<code>@Bean</code>的类型<code>ResourceConfig</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JerseyConfig</span> <span class="keyword">extends</span> <span class="title">ResourceConfig</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">JerseyConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		register(Endpoint.class);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Jersey对扫描可执行档案的支持相当有限。例如，它无法扫描<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#deployment-install" target="_blank" rel="noopener">完全可执行jar文件</a>中的包中或<code>WEB-INF/classes</code>运行可执行war文件时的端点。为避免此限制，<code>packages</code>不应使用该方法，并且应使用该<code>register</code>方法单独注册端点，如上例所示。</p>
</blockquote>
<p>对于更高级的自定义，您还可以注册实现的任意数量的bean <code>ResourceConfigCustomizer</code>。</p>
<p>所有已注册的端点都应<code>@Components</code>使用HTTP资源注释（<code>@GET</code>和其他），如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Path</span>(<span class="string">"/hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Endpoint</span> </span>&#123;</span><br><span class="line">	<span class="meta">@GET</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">message</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Hello"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于<code>Endpoint</code>是Spring <code>@Component</code>，它的生命周期由Spring管理，您可以使用<code>@Autowired</code>注释注入依赖项并使用<code>@Value</code> 注释注入外部配置。默认情况下，Jersey servlet已注册并映射到<code>/*</code>。您可以通过添加<code>@ApplicationPath</code>到您 的地图来更改映射<code>ResourceConfig</code>。</p>
<p>默认情况下，Jersey被设置为 名为<code>@Bean</code>的类型的Servlet 。默认情况下，servlet是懒惰地初始化的，但您可以通过设置来自定义该行为。您可以通过创建具有相同名称的bean来禁用或覆盖该bean。您还可以通过设置（在这种情况下，替换或覆盖是）来使用过滤器而不是servlet 。过滤器有一个，您可以设置。通过使用指定属性的映射，可以为servlet和过滤器注册提供init参数。<code>ServletRegistrationBean</code> <code>jerseyServletRegistration</code> <code>spring.jersey.servlet.load-on-startup</code> <code>spring.jersey.type=filter</code> <code>@Bean</code> <code>jerseyFilterRegistration</code> <code>@Order</code> <code>spring.jersey.filter.order</code> <code>spring.jersey.init.*</code></p>
<p>有一个<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-samples/spring-boot-sample-jersey" target="_blank" rel="noopener">Jersey sample</a>以便您可以看到如何设置。</p>
<h3 id="嵌入式Servlet容器支持"><a href="#嵌入式Servlet容器支持" class="headerlink" title="嵌入式Servlet容器支持"></a>嵌入式Servlet容器支持</h3><p>Spring Boot包括对嵌入式<a href="https://tomcat.apache.org/" target="_blank" rel="noopener">Tomcat</a>， <a href="https://www.eclipse.org/jetty/" target="_blank" rel="noopener">Jetty</a>和<a href="http://undertow.io/" target="_blank" rel="noopener">Undertow</a>服务器的支持。大多数开发人员使用适当的“Starter”来获取完全配置的实例。默认情况下，嵌入式服务器侦听端口上的HTTP请求<code>8080</code>。</p>
<blockquote>
<p>如果您选择在<a href="https://www.centos.org/" target="_blank" rel="noopener">CentOS</a>上使用Tomcat ，请注意，默认情况下，临时目录用于存储已编译的JSP，文件上载等。<code>tmpwatch</code>应用程序运行时可能会删除此目录，从而导致失败。要避免此行为，您可能希望自定义<code>tmpwatch</code>配置，以便<code>tomcat.*</code>不删除或配置目录以<code>server.tomcat.basedir</code>使嵌入式Tomcat使用其他位置。</p>
</blockquote>
<h4 id="Servlet，Filter和Listeners"><a href="#Servlet，Filter和Listeners" class="headerlink" title="Servlet，Filter和Listeners"></a>Servlet，Filter和Listeners</h4><p>使用嵌入式servlet容器时，可以<code>HttpSessionListener</code>通过使用Spring bean或扫描Servlet组件，从Servlet规范中注册servlet，过滤器和所有侦听器（如HttpSessionListener）。</p>
<p><strong>将Servlet，过滤器和监听器注册为Spring Bean</strong></p>
<p>作为Spring bean的任何<code>Servlet</code>，<code>Filter</code>或者servlet <code>*Listener</code>实例都是在嵌入式容器中注册的。如果要从<code>application.properties</code>配置期间引用值，这可能特别方便。</p>
<p>默认情况下，如果上下文仅包含一个Servlet，则将其映射到<code>/</code>。在多个servlet bean的情况下，bean名称用作路径前缀。过滤器映射到 <code>/*</code>。</p>
<p>如果以公约为基础测绘不够灵活，你可以使用 <code>ServletRegistrationBean</code>，<code>FilterRegistrationBean</code>以及 <code>ServletListenerRegistrationBean</code>类的完全控制。</p>
<p>Spring Boot附带了许多可以定义Filter bean的自动配置。以下是过滤器及其各自顺序的一些示例（较低的顺序值表示较高的优先级）：</p>
<table>
<thead>
<tr>
<th style="text-align:center">ServletFilter</th>
<th style="text-align:center">Order</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>OrderedCharacterEncodingFilter</code></td>
<td style="text-align:center"><code>Ordered.HIGHEST_PRECEDENCE</code></td>
</tr>
<tr>
<td style="text-align:center"><code>WebMvcMetricsFilter</code></td>
<td style="text-align:center"><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td>
</tr>
<tr>
<td style="text-align:center"><code>ErrorPageFilter</code></td>
<td style="text-align:center"><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td>
</tr>
<tr>
<td style="text-align:center"><code>HttpTraceFilter</code></td>
<td style="text-align:center"><code>Ordered.LOWEST_PRECEDENCE - 10</code></td>
</tr>
</tbody>
</table>
<p>将Filter beans无序放置通常是安全的。</p>
<p>如果需要特定的顺序，则应避免配置读取请求主体的过滤器<code>Ordered.HIGHEST_PRECEDENCE</code>，因为它可能违反应用程序的字符编码配置。如果Servlet过滤器包装请求，则应使用小于或等于的顺序进行配置 <code>OrderedFilter.REQUEST_WRAPPER_FILTER_MAX_ORDER</code>。</p>
<h4 id="Servlet上下文初始化"><a href="#Servlet上下文初始化" class="headerlink" title="Servlet上下文初始化"></a>Servlet上下文初始化</h4><p>嵌入式servlet容器不直接执行Servlet 3.0+ <code>javax.servlet.ServletContainerInitializer</code>接口或Spring<code>org.springframework.web.WebApplicationInitializer</code>接口。这是一个有意的设计决策，旨在降低设计在战争中运行的第三方库可能会破坏Spring Boot应用程序的风险。</p>
<p>如果需要在Spring Boot应用程序中执行servlet上下文初始化，则应注册实现该<code>org.springframework.boot.web.servlet.ServletContextInitializer</code>接口的bean 。单一<code>onStartup</code>方法提供对s的访问，<code>ServletContext</code>并且如果需要，可以轻松地用作现有的适配器<code>WebApplicationInitializer</code>。</p>
<p><strong>扫描Servlet，过滤器和侦听器</strong></p>
<p>当使用嵌入式容器中，类自动登记注释有 <code>@WebServlet</code>，<code>@WebFilter</code>和<code>@WebListener</code>可以通过使用被使能 <code>@ServletComponentScan</code>。</p>
<blockquote>
<p><code>@ServletComponentScan</code> 在独立容器中没有任何效果，而是使用容器的内置发现机制。</p>
</blockquote>
<h4 id="ServletWebServerApplicationContext"><a href="#ServletWebServerApplicationContext" class="headerlink" title="ServletWebServerApplicationContext"></a>ServletWebServerApplicationContext</h4><p>在引擎盖下，Spring Boot使用不同类型的<code>ApplicationContext</code>嵌入式servlet容器支持。该<code>ServletWebServerApplicationContext</code>是一种特殊类型的<code>WebApplicationContext</code>通过搜索单说引导自身 <code>ServletWebServerFactory</code>豆。通常是<code>TomcatServletWebServerFactory</code>,,<code>JettyServletWebServerFactory</code>或<code>UndertowServletWebServerFactory</code> 已经自动配置。</p>
<blockquote>
<p>您通常不需要了解这些实现类。大多数应用程序都自动配置，并适当的<code>ApplicationContext</code>和 <code>ServletWebServerFactory</code>以您的名义创建。</p>
</blockquote>
<h4 id="自定义嵌入式Servlet容器"><a href="#自定义嵌入式Servlet容器" class="headerlink" title="自定义嵌入式Servlet容器"></a>自定义嵌入式Servlet容器</h4><p>可以使用Spring <code>Environment</code> 属性配置公共servlet容器设置。通常，您将在<code>application.properties</code> 文件中定义属性。</p>
<p>常用服务器设置包括：</p>
<ul>
<li>网络设置：侦听传入HTTP请求的端口（<code>server.port</code>），要绑定的接口地址<code>server.address</code>等等。</li>
<li>会话设置：会话是持久性（<code>server.servlet.session.persistence</code>），会话超时（<code>server.servlet.session.timeout</code>），会话数据（<code>server.servlet.session.store-dir</code>）的位置以及会话cookie配置（<code>server.servlet.session.cookie.*</code>）。</li>
<li>错误管理：错误页面的位置（<code>server.error.path</code>）等。</li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-configure-ssl" target="_blank" rel="noopener">SSL</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#how-to-enable-http-response-compression" target="_blank" rel="noopener">HTTP compression</a></li>
</ul>
<p>Spring Boot尽可能尝试公开常见设置，但这并不总是可行。对于这些情况，专用命名空间提供特定于服务器的自定义（请参阅 <code>server.tomcat</code>和<code>server.undertow</code>）。例如， 可以使用嵌入式servlet容器的特定功能配置<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-configure-accesslogs" target="_blank" rel="noopener">访问日志</a>。</p>
<blockquote>
<p>请参阅 <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java" target="_blank" rel="noopener"><code>ServerProperties</code></a>课程以获取完整列表。</p>
</blockquote>
<p><strong>程序化定制</strong></p>
<p>如果需要以编程方式配置嵌入式servlet容器，可以注册实现该<code>WebServerFactoryCustomizer</code>接口的Spring bean 。 <code>WebServerFactoryCustomizer</code>提供对其的访问 <code>ConfigurableServletWebServerFactory</code>，其中包括许多自定义setter方法。以下示例以编程方式设置端口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.server.WebServerFactoryCustomizer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomizationBean</span> <span class="keyword">implements</span> <span class="title">WebServerFactoryCustomizer</span>&lt;<span class="title">ConfigurableServletWebServerFactory</span>&gt; </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableServletWebServerFactory server)</span> </span>&#123;</span><br><span class="line">		server.setPort(<span class="number">9000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>TomcatServletWebServerFactory</code>，<code>JettyServletWebServerFactory</code>并且<code>UndertowServletWebServerFactory</code> 是专用变体，<code>ConfigurableServletWebServerFactory</code>分别为Tomcat，Jetty和Undertow提供了额外的自定义setter方法。</p>
</blockquote>
<p><strong>直接自定义ConfigurableServletWebServerFactory</strong></p>
<p>如果前面的定制技术太有限，你可以注册 <code>TomcatServletWebServerFactory</code>，<code>JettyServletWebServerFactory</code>或 <code>UndertowServletWebServerFactory</code> bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableServletWebServerFactory <span class="title">webServerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	TomcatServletWebServerFactory factory = <span class="keyword">new</span> TomcatServletWebServerFactory();</span><br><span class="line">	factory.setPort(<span class="number">9000</span>);</span><br><span class="line">	factory.setSessionTimeout(<span class="number">10</span>, TimeUnit.MINUTES);</span><br><span class="line">	factory.addErrorPages(<span class="keyword">new</span> ErrorPage(HttpStatus.NOT_FOUND, <span class="string">"/notfound.html"</span>));</span><br><span class="line">	<span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为许多配置选项提供了Setter。如果您需要做一些更具异国情调的事情，还会提供一些受保护的方法“挂钩”。有关详细信息，请参阅 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api/org/springframework/boot/web/servlet/server/ConfigurableServletWebServerFactory.html" target="_blank" rel="noopener">源代码文档</a>。</p>
<h4 id="JSP限制"><a href="#JSP限制" class="headerlink" title="JSP限制"></a>JSP限制</h4><p>运行使用嵌入式servlet容器的Spring Boot应用程序（并打包为可执行存档）时，JSP支持存在一些限制。</p>
<ul>
<li>使用Jetty和Tomcat，如果使用war包装，它应该可以工作。可执行的war将在启动时运行<code>java -jar</code>，并且也可以部署到任何标准容器。使用可执行jar时不支持JSP。</li>
<li>Undertow不支持JSP。</li>
<li>创建自定义<code>error.jsp</code>页面不会覆盖<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-error-handling" target="_blank" rel="noopener">错误处理</a>的默认视图 。 应该使用<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-error-handling-custom-error-pages" target="_blank" rel="noopener">自定义错误页面</a>。</li>
</ul>
<p>有一个<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-samples/spring-boot-sample-web-jsp" target="_blank" rel="noopener">JSP示例</a>以便您可以看到如何设置。</p>
<h3 id="嵌入式Reactive-Server支持"><a href="#嵌入式Reactive-Server支持" class="headerlink" title="嵌入式Reactive Server支持"></a>嵌入式Reactive Server支持</h3><p>Spring Boot包括对以下嵌入式响应式Web服务器的支持：Reactor Netty，Tomcat，Jetty和Undertow。大多数开发人员使用适当的“Starter”来获取完全配置的实例。默认情况下，嵌入式服务器在端口8080上侦听HTTP请求。</p>
<h3 id="Reactive-Server资源配置"><a href="#Reactive-Server资源配置" class="headerlink" title="Reactive Server资源配置"></a>Reactive Server资源配置</h3><p>在自动配置Reactor Netty或Jetty服务器时，Spring Boot将创建特定的bean，为服务器实例提供HTTP资源：<code>ReactorResourceFactory</code>或<code>JettyResourceFactory</code>。</p>
<p>默认情况下，这些资源也将与Reactor Netty和Jetty客户端共享，以获得最佳性能，具体如下：</p>
<ul>
<li>相同的技术用于服务器和客户端</li>
<li>客户端实例是使用<code>WebClient.Builder</code>Spring Boot自动配置的bean 构建的</li>
</ul>
<p>开发人员可以通过提供自定义<code>ReactorResourceFactory</code>或<code>JettyResourceFactory</code>bean 来覆盖Jetty和Reactor Netty的资源配置- 这将应用于客户端和服务器。</p>
<p>您可以在<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-webclient-runtime" target="_blank" rel="noopener">WebClient Runtime</a>部分中了解有关客户端资源配置的更多信息 。</p>
</div></div><a class="button-hover more" href="/2019/03/20/使用SpringBoot-开发Web应用程序/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/20/使用SpringBoot-JSON/">使用SpringBoot-JSON</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/json/">json</a></div></div><div class="post-content"><div class="main-content content"><h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><p>Spring Boot提供了与三个JSON映射库的集成：</p>
<ul>
<li>GSON</li>
<li>Jackson</li>
<li>JSON-B</li>
</ul>
<p>Jackson是首选的默认库</p>
<h3 id="jackson"><a href="#jackson" class="headerlink" title="jackson"></a>jackson</h3><p>提供杰克逊的自动配置，杰克逊是其中的一部分 <code>spring-boot-starter-json</code>。当Jackson在类路径上时，<code>ObjectMapper</code> 会自动配置bean。提供了几个配置属性来自 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-customize-the-jackson-objectmapper" target="_blank" rel="noopener">定义配置 <code>ObjectMapper</code></a>。</p>
<h3 id="Gson"><a href="#Gson" class="headerlink" title="Gson"></a>Gson</h3><p>提供Gson的自动配置。当Gson在类路径上时，<code>Gson</code>会自动配置bean。<code>spring.gson.*</code>提供了几个配置属性来自定义配置。为了获得更多控制，<code>GsonBuilderCustomizer</code>可以使用一个或多个 bean。</p>
<h3 id="JSON-B"><a href="#JSON-B" class="headerlink" title="JSON-B"></a>JSON-B</h3><p>提供Gson的自动配置。当Gson在类路径上时，<code>Gson</code>会自动配置bean。<code>spring.gson.*</code>提供了几个配置属性来自定义配置。为了获得更多控制，<code>GsonBuilderCustomizer</code>可以使用一个或多个 bean。</p>
</div></div><a class="button-hover more" href="/2019/03/20/使用SpringBoot-JSON/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/20/使用SpringBoot-国际化/">使用SpringBoot-国际化</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/i18n/">i18n</a></div></div><div class="post-content"><div class="main-content content"><h2 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h2><p>Spring Boot支持本地化消息，以便您的应用程序可以满足不同语言首选项的用户。默认情况下，Spring Boot会<code>messages</code>在类路径的根目录中查找资源包的存在。</p>
<blockquote>
<p>当配置的资源包的默认属性文件可用时（即<code>messages.properties</code>默认情况下），将应用自动配置。如果资源包仅包含特定于语言的属性文件，则需要添加默认值。</p>
</blockquote>
<p>可以使用<code>spring.messages</code>命名空间配置资源包的基本名称以及其他几个属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.messages.basename = messages，config.i18n.messages</span><br><span class="line">spring.messages.fallback-to-system-locale = false</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>spring.messages.basename</code> 支持以逗号分隔的位置列表，包括限定符或从类路径根解析的资源。</p>
</blockquote>
<p>有关更多支持选项，请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/context/MessageSourceProperties.java" target="_blank" rel="noopener"> <code>MessageSourceProperties</code></a></p>
</div></div><a class="button-hover more" href="/2019/03/20/使用SpringBoot-国际化/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/20/使用SpringBoot-Logging/">使用SpringBoot-Logging</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/logging/">logging</a></div></div><div class="post-content"><div class="main-content content"><h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h2><p>Spring Boot使用<a href="https://commons.apache.org/logging" target="_blank" rel="noopener">Commons Logging</a>进行所有内部日志记录，但保留底层日志实现。为<a href="https://docs.oracle.com/javase/8/docs/api//java/util/logging/package-summary.html" target="_blank" rel="noopener">Java Util Logging</a>，<a href="https://logging.apache.org/log4j/2.x/" target="_blank" rel="noopener">Log4J2</a>和 <a href="http://logback.qos.ch/" target="_blank" rel="noopener">Logback</a>提供了默认配置 。在每种情况下，记录器都预先配置为使用控制台输出，并且还提供可选的文件输出。</p>
<p>默认情况下，如果使用“Starters”，则使用Logback进行日志记录。还包括适当的Logback路由，以确保使用Java Util Logging，Commons Logging，Log4J或SLF4J的依赖库都能正常工作。</p>
<blockquote>
<p>Java有很多日志框架可供使用。如果以上列表看起来令人困惑，请不要担心。通常，您不需要更改日志记录依赖项，并且Spring Boot默认值可以正常工作。</p>
</blockquote>
<h3 id="日志格式"><a href="#日志格式" class="headerlink" title="日志格式"></a>日志格式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2014-03-05 10:57:51.112  INFO 45469 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/7.0.52</span><br><span class="line">2014-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2014-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1358 ms</span><br><span class="line">2014-03-05 10:57:51.698  INFO 45469 --- [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean        : Mapping servlet: 'dispatcherServlet' to [/]</span><br><span class="line">2014-03-05 10:57:51.702  INFO 45469 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]</span><br></pre></td></tr></table></figure>
<p>输出以下信息：</p>
<ul>
<li>日期和时间：毫秒精度，易于排序。</li>
<li>日志级别：<code>ERROR</code>，<code>WARN</code>，<code>INFO</code>，<code>DEBUG</code>，或<code>TRACE</code>。</li>
<li>进程ID。</li>
<li>一个<code>---</code>分离器来区分实际日志消息的开始。</li>
<li>线程名称：用方括号括起来（可能会截断控制台输出）。</li>
<li>记录器名称：这通常是源类名称（通常缩写）。</li>
<li>日志消息。</li>
</ul>
<blockquote>
<p>Logback没有<code>FATAL</code>级别。它映射到<code>ERROR</code>。</p>
</blockquote>
<h3 id="控制台输出"><a href="#控制台输出" class="headerlink" title="控制台输出"></a>控制台输出</h3><p>默认日志配置会在写入时将消息回显到控制台。默认情况下，会记录<code>ERROR</code>-level，<code>WARN</code>-level和<code>INFO</code>-level消息。您还可以通过使用<code>--debug</code>标志启动应用程序来启用“调试”模式。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> java -jar myapp.jar --debug</span><br></pre></td></tr></table></figure>
<blockquote>
<p>你也可以<code>debug=true</code>在你的指定<code>application.properties</code>。</p>
</blockquote>
<p>启用调试模式后，将选择一些核心记录器（嵌入式容器，Hibernate和Spring Boot）以输出更多信息。启用调试模式并<em>没有</em>配置您的应用程序记录所有消息<code>DEBUG</code>的水平。</p>
<p>或者，您可以通过使用<code>--trace</code>标志（或<code>trace=true</code>在您的应用程序中）启动应用程序来启用“跟踪”模式 <code>application.properties</code>。这样做可以为选择的核心记录器（嵌入式容器，Hibernate模式生成和整个Spring组合）启用跟踪日志记录。</p>
<h3 id="彩色编码输出"><a href="#彩色编码输出" class="headerlink" title="彩色编码输出"></a>彩色编码输出</h3><p>如果您的终端支持ANSI，则使用颜色输出来提高可读性。您可以设置 <code>spring.output.ansi.enabled</code>为 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api/org/springframework/boot/ansi/AnsiOutput.Enabled.html" target="_blank" rel="noopener">支持的值</a>以覆盖自动检测。</p>
<p>通过使用<code>%clr</code>转换字配置颜色编码。在最简单的形式中，转换器根据日志级别为输出着色，如以下示例所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span>clr(%5p)</span><br></pre></td></tr></table></figure>
<p>下表描述了日志级别到颜色的映射：</p>
<table>
<thead>
<tr>
<th style="text-align:center">水平</th>
<th style="text-align:center">颜色</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>FATAL</code></td>
<td style="text-align:center">红色</td>
</tr>
<tr>
<td style="text-align:center"><code>ERROR</code></td>
<td style="text-align:center">红色</td>
</tr>
<tr>
<td style="text-align:center"><code>WARN</code></td>
<td style="text-align:center">黄色</td>
</tr>
<tr>
<td style="text-align:center"><code>INFO</code></td>
<td style="text-align:center">绿色</td>
</tr>
<tr>
<td style="text-align:center"><code>DEBUG</code></td>
<td style="text-align:center">绿色</td>
</tr>
<tr>
<td style="text-align:center"><code>TRACE</code></td>
<td style="text-align:center">绿色</td>
</tr>
</tbody>
</table>
<p>或者，您可以通过将其作为转换选项指定应使用的颜色或样式。例如，要使文本变为黄色，请使用以下设置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span>clr(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;)&#123;yellow&#125;</span><br></pre></td></tr></table></figure>
<p>支持以下颜色和样式：</p>
<ul>
<li><code>blue</code></li>
<li><code>cyan</code></li>
<li><code>faint</code></li>
<li><code>green</code></li>
<li><code>magenta</code></li>
<li><code>red</code></li>
<li><code>yellow</code></li>
</ul>
<h3 id="文件输出"><a href="#文件输出" class="headerlink" title="文件输出"></a>文件输出</h3><p>默认情况下，Spring Boot仅记录到控制台，不会写入日志文件。如果除了控制台输出之外还要编写日志文件，则需要设置 <code>logging.file</code>或<code>logging.path</code>属性（例如，在您的中 <code>application.properties</code>）。</p>
<p>下表显示了如何<code>logging.*</code>一起使用这些属性：</p>
<p><strong>记录属性</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center"><code>logging.file</code></th>
<th style="text-align:center"><code>logging.path</code></th>
<th style="text-align:center">例子</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><em>（没有）</em></td>
<td style="text-align:center"><em>（没有）</em></td>
<td style="text-align:center"></td>
<td style="text-align:center">仅控制台记录。</td>
</tr>
<tr>
<td style="text-align:center">具体文件</td>
<td style="text-align:center"><em>（没有）</em></td>
<td style="text-align:center"><code>my.log</code></td>
<td style="text-align:center">写入指定的日志文件。名称可以是精确位置或相对于当前目录。</td>
</tr>
<tr>
<td style="text-align:center"><em>（没有）</em></td>
<td style="text-align:center">具体目录</td>
<td style="text-align:center"><code>/var/log</code></td>
<td style="text-align:center">写入<code>spring.log</code>指定的目录。名称可以是精确位置或相对于当前目录。</td>
</tr>
</tbody>
</table>
<p>日志文件在达到10 MB时会轮换，与控制台输出一样，默认情况下会记录<code>ERROR</code>-level， <code>WARN</code>-level和<code>INFO</code>-level消息。可以使用<code>logging.file.max-size</code>属性更改大小限制。除非<code>logging.file.max-history</code>已设置属性，否则以前轮换的文件将无限期归档。</p>
<blockquote>
<p>日志记录系统在应用程序生命周期的早期初始化。因此，在通过<code>@PropertySource</code> 注释加载的属性文件中找不到日志记录属性。</p>
</blockquote>
<blockquote>
<p>日志记录属性独立于实际的日志记录基础结构。因此，<code>logback.configurationFile</code>spring Boot不管理特定的配置键（例如Logback）。</p>
</blockquote>
<h3 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h3><p>所有支持的日志系统可以在弹簧设置的记录器级别 <code>Environment</code>（例如，<code>application.properties</code>通过使用） <code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code>，其中<code>level</code>为TRACE，DEBUG，INFO，WARN，ERROR，FATAL或OFF之一。该<code>root</code>记录器可以通过使用被配置<code>logging.level.root</code>。</p>
<p>以下示例显示了潜在的日志记录设置<code>application.properties</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logging.level.root=WARN</span><br><span class="line">logging.level.org.springframework.web=DEBUG</span><br><span class="line">logging.level.org.hibernate=ERROR</span><br></pre></td></tr></table></figure>
<h3 id="日志组"><a href="#日志组" class="headerlink" title="日志组"></a>日志组</h3><p>能够将相关记录器组合在一起以便可以同时配置它们通常很有用。例如，您通常可以更改<em>所有</em> Tomcat相关记录器的日志记录级别 ，但您无法轻松记住顶级软件包。</p>
<p>为了解决这个问题，Spring Boot允许您在Spring中定义日志记录组 <code>Environment</code>。例如，以下是如何通过将“Tomcat”组添加到您的<code>application.properties</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.group.tomcat = org.apache.catalina，org.apache.coyote，org.apache.tomcat</span><br></pre></td></tr></table></figure>
<p>定义后，您可以使用一行更改组中所有记录器的级别：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.level.tomcat = TRACE</span><br></pre></td></tr></table></figure>
<p>Spring Boot包含以下预定义的日志记录组，可以直接使用：</p>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">Loggers</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">WEB</td>
<td style="text-align:center"><code>org.springframework.core.codec</code>，<code>org.springframework.http</code>，<code>org.springframework.web</code></td>
</tr>
<tr>
<td style="text-align:center">SQL</td>
<td style="text-align:center"><code>org.springframework.jdbc.core</code>， <code>org.hibernate.SQL</code></td>
</tr>
</tbody>
</table>
<h3 id="自定义日志配置"><a href="#自定义日志配置" class="headerlink" title="自定义日志配置"></a>自定义日志配置</h3><p>可以通过在类路径中包含适当的库来激活各种日志记录系统，并且可以通过在类路径的根目录中或在以下Spring <code>Environment</code> 属性指定的位置提供合适的配置文件来进一步自定义：<code>logging.config</code>。</p>
<p>您可以使用<code>org.springframework.boot.logging.LoggingSystem</code>系统属性强制Spring Boot使用特定的日志记录系统 。该值应该是实现的完全限定类名<code>LoggingSystem</code>。您还可以通过使用值来完全禁用Spring Boot的日志记录配置<code>none</code>。</p>
<blockquote>
<p>由于记录被初始化<strong>之前</strong>的<code>ApplicationContext</code>创建，这是不可能控制来自伐木<code>@PropertySources</code>春季<code>@Configuration</code>文件。更改日志记录系统或完全禁用它的唯一方法是通过系统属性。</p>
</blockquote>
<p>根据您的日志记录系统，将加载以下文件：</p>
<table>
<thead>
<tr>
<th style="text-align:center">日志实现</th>
<th style="text-align:center">定制</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">logback</td>
<td style="text-align:center"><code>logback-spring.xml</code>，<code>logback-spring.groovy</code>，<code>logback.xml</code>，或者<code>logback.groovy</code></td>
</tr>
<tr>
<td style="text-align:center">Log4j2</td>
<td style="text-align:center"><code>log4j2-spring.xml</code> 或者 <code>log4j2.xml</code></td>
</tr>
<tr>
<td style="text-align:center">JDK（Java Util Logging）</td>
<td style="text-align:center"><code>logging.properties</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>如果可能，我们建议您使用<code>-spring</code>变量进行日志记录配置（例如，<code>logback-spring.xml</code>而不是<code>logback.xml</code>）。如果使用标准配置位置，Spring无法完全控制日志初始化。</p>
</blockquote>
<blockquote>
<p>Java Util Logging存在已知的类加载问题，从“可执行jar”运行时会导致问题。如果可能的话，我们建议您在从“可执行jar”运行时避免使用它。</p>
</blockquote>
<p>为了帮助进行自定义，一些其他属性从Spring转移 <code>Environment</code>到System属性，如下表所述：</p>
<table>
<thead>
<tr>
<th style="text-align:center">Spring环境</th>
<th style="text-align:center">系统属性</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>logging.exception-conversion-word</code></td>
<td style="text-align:center"><code>LOG_EXCEPTION_CONVERSION_WORD</code></td>
<td style="text-align:center">记录异常时使用的转换字。</td>
</tr>
<tr>
<td style="text-align:center"><code>logging.file</code></td>
<td style="text-align:center"><code>LOG_FILE</code></td>
<td style="text-align:center">如果已定义，则在默认日志配置中使用它。</td>
</tr>
<tr>
<td style="text-align:center"><code>logging.file.max-size</code></td>
<td style="text-align:center"><code>LOG_FILE_MAX_SIZE</code></td>
<td style="text-align:center">最大日志文件大小（如果启用了LOG_FILE）。（仅支持默认的Logback设置。）</td>
</tr>
<tr>
<td style="text-align:center"><code>logging.file.max-history</code></td>
<td style="text-align:center"><code>LOG_FILE_MAX_HISTORY</code></td>
<td style="text-align:center">要保留的最大归档日志文件数（如果启用了LOG_FILE）。（仅支持默认的Logback设置。）</td>
</tr>
<tr>
<td style="text-align:center"><code>logging.path</code></td>
<td style="text-align:center"><code>LOG_PATH</code></td>
<td style="text-align:center">如果已定义，则在默认日志配置中使用它。</td>
</tr>
<tr>
<td style="text-align:center"><code>logging.pattern.console</code></td>
<td style="text-align:center"><code>CONSOLE_LOG_PATTERN</code></td>
<td style="text-align:center">要在控制台上使用的日志模式（stdout）。（仅支持默认的Logback设置。）</td>
</tr>
<tr>
<td style="text-align:center"><code>logging.pattern.dateformat</code></td>
<td style="text-align:center"><code>LOG_DATEFORMAT_PATTERN</code></td>
<td style="text-align:center">日志日期格式的Appender模式。（仅支持默认的Logback设置。）</td>
</tr>
<tr>
<td style="text-align:center"><code>logging.pattern.file</code></td>
<td style="text-align:center"><code>FILE_LOG_PATTERN</code></td>
<td style="text-align:center">要在文件中使用的日志模式（如果<code>LOG_FILE</code>已启用）。（仅支持默认的Logback设置。）</td>
</tr>
<tr>
<td style="text-align:center"><code>logging.pattern.level</code></td>
<td style="text-align:center"><code>LOG_LEVEL_PATTERN</code></td>
<td style="text-align:center">呈现日志级别时使用的格式（默认<code>%5p</code>）。（仅支持默认的Logback设置。）</td>
</tr>
<tr>
<td style="text-align:center"><code>PID</code></td>
<td style="text-align:center"><code>PID</code></td>
<td style="text-align:center">当前进程ID（如果可能，则在未定义为OS环境变量时发现）。</td>
</tr>
</tbody>
</table>
<p>所有受支持的日志记录系统在分析其配置文件时都可以查阅系统属性。有关<code>spring-boot.jar</code>示例，请参阅默认配置：</p>
<ul>
<li><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/defaults.xml" target="_blank" rel="noopener">logback</a></li>
<li><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/log4j2/log4j2.xml" target="_blank" rel="noopener">Log4j 2</a></li>
<li><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/java/logging-file.properties" target="_blank" rel="noopener">Java Util日志记录</a></li>
</ul>
<blockquote>
<p>如果要在日志记录属性中使用占位符，则应使用 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-external-config-placeholders-in-properties" target="_blank" rel="noopener">Spring Boot的语法</a>而不是底层框架的语法。值得注意的是，如果使用Logback，则应将其<code>:</code> 用作属性名称与其默认值之间的分隔符，而不是使用<code>:-</code>。</p>
</blockquote>
<blockquote>
<p>您可以通过仅覆盖<code>LOG_LEVEL_PATTERN</code>（或<code>logging.pattern.level</code>使用Logback）将MDC和其他临时内容添加到日志行 。例如，如果使用<code>logging.pattern.level=user:%X{user} %5p</code>，则默认日志格式包含“user”的MDC条目（如果存在），如以下示例所示。</p>
<p>2015-09-30 12:30:04.031 user:someone INFO 22174 — [  nio-8080-exec-0] demo.Controller<br>Handling authenticated request</p>
</blockquote>
<h3 id="Logback扩展"><a href="#Logback扩展" class="headerlink" title="Logback扩展"></a>Logback扩展</h3><p>Spring Boot包含许多Logback扩展，可以帮助进行高级配置。您可以在<code>logback-spring.xml</code>配置文件中使用这些扩展名。</p>
<blockquote>
<p>由于标准<code>logback.xml</code>配置文件加载过早，因此无法在其中使用扩展。您需要使用<code>logback-spring.xml</code>或定义 <code>logging.config</code>属性。</p>
</blockquote>
<blockquote>
<p>扩展不能与Logback的 <a href="http://logback.qos.ch/manual/configuration.html#autoScan" target="_blank" rel="noopener">配置扫描一起使用</a>。如果您尝试这样做，更改配置文件会导致类似于以下记录之一的错误：</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProperty], current ElementPath is [[configuration][springProperty]]</span><br><span class="line">ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProfile], current ElementPath is [[configuration][springProfile]]</span><br></pre></td></tr></table></figure>
<h4 id="特定于配置文件的配置"><a href="#特定于配置文件的配置" class="headerlink" title="特定于配置文件的配置"></a>特定于配置文件的配置</h4><p>该<code>&lt;springProfile&gt;</code>标签可以让你选择性地包括或排除基于主动春型材配置的部分。在<code>&lt;configuration&gt;</code>元素内的任何位置都支持配置文件节。使用该<code>name</code>属性指定哪个配置文件接受配置。所述<code>&lt;springProfile&gt;</code>标记可包含一个简单的配置文件的名称（例如<code>staging</code>）或轮廓表达。例如，简档表达式允许表达更复杂的简档逻辑 <code>production &amp; (eu-central | eu-west)</code>。有关详细信息，请查阅 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/core.html#beans-definition-profiles-java" target="_blank" rel="noopener">参考指南</a>。以下清单显示了三个示例配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span>  <span class="attr">name</span> = <span class="string">“staging”</span> &gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">！</span> <span class="attr">-</span> “暂存”配置文件处于活动状态时要启用的配置 <span class="attr">-</span> &gt;</span> </span><br><span class="line"><span class="tag">&lt;/ <span class="attr">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span>  <span class="attr">name</span> = <span class="string">“dev</span> | <span class="attr">staging</span>” &gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">！</span> <span class="attr">-</span> 在“<span class="attr">dev</span>”或“<span class="attr">staging</span>”配置文件处于活动状态时启用的配置 <span class="attr">-</span> &gt;</span> </span><br><span class="line"><span class="tag">&lt;/ <span class="attr">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span>  <span class="attr">name</span> = <span class="string">“！production”</span> &gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">！</span> <span class="attr">-</span> “生产”配置文件未激活时要启用的配置 <span class="attr">-</span> &gt;</span> </span><br><span class="line"><span class="tag">&lt;/ <span class="attr">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="环境属性"><a href="#环境属性" class="headerlink" title="环境属性"></a>环境属性</h4><p>该<code>&lt;springProperty&gt;</code>标记允许您公开Spring中的属性<code>Environment</code>以便在Logback中使用。如果要<code>application.properties</code>在Logback配置中访问文件中的值，则此操作非常有用 。标签的工作方式与Logback的标准<code>&lt;property&gt;</code>标签类似。但是，<code>value</code>您可以指定<code>source</code>属性（来自<code>Environment</code>），而不是指定直接 属性。如果需要将属性存储在<code>local</code>范围之外的其他位置，则可以使用该<code>scope</code> 属性。如果需要回退值（如果未在中设置属性 <code>Environment</code>），则可以使用该<code>defaultValue</code>属性。以下示例显示如何公开在Logback中使用的属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProperty</span>  <span class="attr">scope</span> = <span class="string">“context”</span>  <span class="attr">name</span> = <span class="string">“fluentHost”</span>  <span class="attr">source</span> = <span class="string">“myapp.fluentd.host”</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">defaultValue</span> = <span class="string">“localhost”</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">“FLUENT”</span> <span class="attr">class</span>=<span class="string">“ch.qos.logback.more.appenders.DataFluentAppender”</span> &gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">remoteHost</span>&gt;</span> $ &#123;fluentHost&#125; <span class="tag">&lt;/ <span class="attr">remoteHost</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">springProperty</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>在<code>source</code>必须在串的情况下（如指定<code>my.property-name</code>）。但是，可以<code>Environment</code>使用宽松规则将属性添加到属性中。</p>
</blockquote>
</div></div><a class="button-hover more" href="/2019/03/20/使用SpringBoot-Logging/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/20/个人想说一/">个人想说一</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/live/">live</a></div></div><div class="post-content"><div class="main-content content"><p>​    虽说纯看文档无聊，对于我个人来说，大部分都已经使用过的，因此理解起来并没有太大难度。在后续会推出相应的学习Demo，以便复习和具体应用</p>
</div></div><a class="button-hover more" href="/2019/03/20/个人想说一/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/20/使用SpringBoot-Profiles/">使用SpringBoot-Profiles</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/profiles/">profiles</a></div></div><div class="post-content"><div class="main-content content"><h2 id="Profiles"><a href="#Profiles" class="headerlink" title="Profiles"></a>Profiles</h2><p>Spring Profiles提供了一种隔离应用程序配置部分并使其仅在特定环境中可用的方法。任何<code>@Component</code>或<code>@Configuration</code> 可以标记<code>@Profile</code>以限制何时加载，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile</span>(<span class="string">"production"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductionConfiguration</span> </span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您可以使用<code>spring.profiles.active</code> <code>Environment</code>属性指定哪些配置文件处于活动状态。您可以使用本章前面介绍的任何方法指定属性。例如，您可以将其包含在您的中<code>application.properties</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.profiles.active = dev，hsqldb</span><br></pre></td></tr></table></figure>
<p>您还可以使用以下开关在命令行上指定它： <code>--spring.profiles.active=dev,hsqldb</code>。</p>
<h3 id="添加活动配置文件"><a href="#添加活动配置文件" class="headerlink" title="添加活动配置文件"></a>添加活动配置文件</h3><p>该<code>spring.profiles.active</code>属性遵循与其他属性相同的排序规则：最高<code>PropertySource</code>胜利。这意味着您可以在其中指定活动配置文件<code>application.properties</code>，然后使用命令行开关<strong>替换</strong>它们。</p>
<p>有时，将特定于配置文件的属性<strong>添加</strong>到活动配置文件而不是替换它们是有用的。该<code>spring.profiles.include</code>属性可用于无条件添加活动配置文件。该<code>SpringApplication</code>入口点还设置附加配置文件的Java API（即那些由活化的顶级 <code>spring.profiles.active</code>属性）。请参阅<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api/org/springframework/boot/SpringApplication.html" target="_blank" rel="noopener">SpringApplication中</a>的<code>setAdditionalProfiles()</code>方法 。</p>
<p>例如，当使用开关运行具有以下属性的应用程序时<code>--spring.profiles.active=prod</code>，也会激活<code>proddb</code>和<code>prodmq</code>配置文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">my.property:</span> <span class="string">fromyamlfile</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">spring.profiles:</span> <span class="string">prod</span></span><br><span class="line"><span class="string">spring.profiles.include:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">proddb</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">prodmq</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>请记住，<code>spring.profiles</code>可以在YAML文档中定义属性，以确定此特定文档何时包含在配置中。有关更多详细信息<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-change-configuration-depending-on-the-environment" target="_blank" rel="noopener">，</a>请参见 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-change-configuration-depending-on-the-environment" target="_blank" rel="noopener">第77.7节“根据环境更改配置”</a></p>
</blockquote>
<h3 id="以编程方式设置配置文件"><a href="#以编程方式设置配置文件" class="headerlink" title="以编程方式设置配置文件"></a>以编程方式设置配置文件</h3><p>您可以<code>SpringApplication.setAdditionalProfiles(…)</code>在应用程序运行之前通过调用以编程方式设置活动配置文 也可以使用Spring的<code>ConfigurableEnvironment</code>界面激活配置文件。</p>
<h3 id="特定于配置文件的配置文件"><a href="#特定于配置文件的配置文件" class="headerlink" title="特定于配置文件的配置文件"></a>特定于配置文件的配置文件</h3><p>引用的<code>application.properties</code>（或<code>application.yml</code>）和文件的特定于配置文件的变体<code>@ConfigurationProperties</code>被视为文件并加载。有关详细信息<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-external-config-profile-specific-properties" target="_blank" rel="noopener">，</a>请参见“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-external-config-profile-specific-properties" target="_blank" rel="noopener">第24.4节”“特定</a>于<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-external-config-profile-specific-properties" target="_blank" rel="noopener">配置文件的属性”</a>。</p>
</div></div><a class="button-hover more" href="/2019/03/20/使用SpringBoot-Profiles/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/20/使用SpringBoot-类型安全配置属性/">使用SpringBoot-类型安全配置属性</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/properties/">properties</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/yaml/">yaml</a></div></div><div class="post-content"><div class="main-content content"><h2 id="类型安全配置属性"><a href="#类型安全配置属性" class="headerlink" title="类型安全配置属性"></a>类型安全配置属性</h2><p>使用<code>@Value(&quot;${property}&quot;)</code>注释注入配置属性有时会很麻烦，尤其是在使用多个属性或数据本质上是分层的情况下。Spring Boot提供了一种使用属性的替代方法，该方法允许强类型bean管理和验证应用程序的配置，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"acme"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> enabled;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Security security = <span class="keyword">new</span> Security();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> InetAddress <span class="title">getRemoteAddress</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRemoteAddress</span><span class="params">(InetAddress remoteAddress)</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Security <span class="title">getSecurity</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> List&lt;String&gt; roles = <span class="keyword">new</span> ArrayList&lt;&gt;(Collections.singleton(<span class="string">"USER"</span>));</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getRoles</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(List&lt;String&gt; roles)</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面的POJO定义了以下属性：</p>
<ul>
<li><code>acme.enabled</code>，默认值为<code>false</code>。</li>
<li><code>acme.remote-address</code>，具有可以强制的类型<code>String</code>。</li>
<li><code>acme.security.username</code>，使用嵌套的“安全”对象，其名称由属性名称决定。特别是，那里根本没有使用返回类型<code>SecurityProperties</code>。</li>
<li><code>acme.security.password</code>。</li>
<li><code>acme.security.roles</code>，收集<code>String</code>。</li>
</ul>
<blockquote>
<p>getter和setter通常是必需的，因为绑定是通过标准的Java Beans属性描述符，就像在Spring MVC中一样。在下列情况下可以省略setter：</p>
<ul>
<li>映射，只要它们被初始化，就需要一个getter但不一定是setter，因为它们可以被绑定器变异。</li>
<li>可以通过索引（通常使用YAML）或使用单个逗号分隔值（属性）访问集合和数组。在后一种情况下，必须设置一个setter。我们建议始终为这些类型添加setter。如果初始化集合，请确保它不是不可变的（如上例所示）。</li>
<li>如果初始化嵌套的POJO属性（如<code>Security</code>前面示例中的字段），则不需要setter。如果您希望绑定器使用其默认构造函数动态创建实例，则需要一个setter。</li>
</ul>
<p>有些人使用Project Lombok自动添加getter和setter。确保Lombok不为此类型生成任何特定构造函数，因为容器会自动使用它来实例化对象。</p>
<p>最后，仅考虑标准Java Bean属性，并且不支持对静态属性的绑定。</p>
</blockquote>
<p>您还需要列出要在<code>@EnableConfigurationProperties</code>注释中注册的属性类 ，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>（AcmeProperties.class）</span><br><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当<code>@ConfigurationProperties</code>bean以这种方式注册时，bean具有常规名称：<code>&lt;prefix&gt;-&lt;fqn&gt;</code>，其中<code>&lt;prefix&gt;</code>是<code>@ConfigurationProperties</code>注释中指定的环境键前缀，并且<code>&lt;fqn&gt;</code>是bean的完全限定名称。如果注释未提供任何前缀，则仅使用bean的完全限定名称。</p>
<p>上例中的bean名称是<code>acme-com.example.AcmeProperties</code>。</p>
</blockquote>
<p>即使前面的配置创建了常规bean <code>AcmeProperties</code>，我们也建议<code>@ConfigurationProperties</code>只处理环境，特别是不从上下文中注入其他bean。话虽如此，<code>@EnableConfigurationProperties</code>注释<em>也会</em>自动应用于您的项目，以便从中配置任何注释的<em>现有</em> bean 。您可以通过确保 已经是bean 来快捷方式，如以下示例所示：<code>@ConfigurationProperties</code></p>
<p><code>Environment</code></p>
<p><code>MyConfiguration</code></p>
<p><code>AcmeProperties</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> </span><br><span class="line"><span class="meta">@ConfigurationProperties</span>（prefix =“acme”）</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line">	<span class="comment">// ...参见前面的例子</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种配置风格特别适用于<code>SpringApplication</code>外部YAML配置，如以下示例所示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">acme:</span></span><br><span class="line">	<span class="attr">remote-address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">	<span class="attr">security:</span></span><br><span class="line">		<span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">		<span class="attr">roles:</span></span><br><span class="line">		  <span class="bullet">-</span> <span class="string">USER</span></span><br><span class="line">		  <span class="bullet">-</span> <span class="string">ADMIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># additional configuration as required</span></span><br></pre></td></tr></table></figure>
<p>要使用<code>@ConfigurationProperties</code>bean，可以使用与任何其他bean相同的方式注入它们，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> AcmeProperties properties;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">(AcmeProperties properties)</span> </span>&#123;</span><br><span class="line">	    <span class="keyword">this</span>.properties = properties;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> 	<span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@PostConstruct</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Server server = <span class="keyword">new</span> Server(<span class="keyword">this</span>.properties.getRemoteAddress());</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用<code>@ConfigurationProperties</code>还可以生成元数据文件，IDE可以使用这些文件为您自己的密钥提供自动完成功能。有关详细信息<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#configuration-metadata" target="_blank" rel="noopener">，</a>请参阅 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#configuration-metadata" target="_blank" rel="noopener">附录B，</a><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#configuration-metadata" target="_blank" rel="noopener"><em>配置元数据</em></a>附录。</p>
</blockquote>
<h2 id="第三方配置"><a href="#第三方配置" class="headerlink" title="第三方配置"></a>第三方配置</h2><p>除了<code>@ConfigurationProperties</code>用于注释类之外，您还可以在公共<code>@Bean</code>方法上使用它。当您想要将属性绑定到控件之外的第三方组件时，这样做会特别有用。</p>
<p>要从<code>Environment</code>属性配置bean ，请添加<code>@ConfigurationProperties</code>到其bean注册，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>（prefix =“another”）</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"> <span class="keyword">public</span> AnotherComponent anotherComponent（）&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>another</code>前缀定义的任何属性都<code>AnotherComponent</code>以与前面<code>AcmeProperties</code>示例类似的方式映射到该bean 。</p>
<h2 id="松弛结合"><a href="#松弛结合" class="headerlink" title="松弛结合"></a>松弛结合</h2><p>Spring Boot使用一些宽松的规则来绑定bean的<code>Environment</code>属性 <code>@ConfigurationProperties</code>，因此不需要在<code>Environment</code>属性名和bean属性名之间进行精确匹配 。这有用的常见示例包括破折号分隔的环境属性（例如，<code>context-path</code>绑定到<code>contextPath</code>）和大写环境属性（例如，<code>PORT</code>绑定到 <code>port</code>）。</p>
<p>例如，请考虑以下<code>@ConfigurationProperties</code>类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"acme.my-project.person"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OwnerProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.firstName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstName</span><span class="params">(String firstName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在前面的示例中，可以使用以下属性名称：</p>
<table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">注意</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>acme.my-project.person.first-name</code></td>
<td style="text-align:center">建议用于<code>.properties</code>和<code>.yml</code>文件。</td>
</tr>
<tr>
<td style="text-align:center"><code>acme.myProject.person.firstName</code></td>
<td style="text-align:center">标准的驼峰案例语法。</td>
</tr>
<tr>
<td style="text-align:center"><code>acme.my_project.person.first_name</code></td>
<td style="text-align:center">下划线符号，这是在用另一种格式<code>.properties</code>和<code>.yml</code> 文件。</td>
</tr>
<tr>
<td style="text-align:center"><code>ACME_MYPROJECT_PERSON_FIRSTNAME</code></td>
<td style="text-align:center">大写格式，使用系统环境变量时建议使用。</td>
</tr>
</tbody>
</table>
<blockquote>
<p><code>prefix</code>注释的值<em>必须</em>是kebab大小写（小写并且用<code>-</code>，例如<code>acme.my-project.person</code>）。</p>
</blockquote>
<p>每个属性源放宽绑定规则：</p>
<table>
<thead>
<tr>
<th style="text-align:center">Property Source</th>
<th style="text-align:center">Simple</th>
<th style="text-align:center">List</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">属性文件</td>
<td style="text-align:center">骆驼案，kebab案例或下划线表示法</td>
<td style="text-align:center">标准列表语法使用<code>[ ]</code>或逗号分隔值</td>
</tr>
<tr>
<td style="text-align:center">YAML文件</td>
<td style="text-align:center">骆驼案，kebab案例或下划线表示法</td>
<td style="text-align:center">标准YAML列表语法或逗号分隔值</td>
</tr>
<tr>
<td style="text-align:center">环境变量</td>
<td style="text-align:center">大写格式，下划线作为分隔符。<code>_</code>不应在属性名称中使用</td>
<td style="text-align:center">由下划线包围的数字值，例如 <code>MY_ACME_1_OTHER = my.acme[1].other</code></td>
</tr>
<tr>
<td style="text-align:center">系统属性</td>
<td style="text-align:center">骆驼案，kebab案例或下划线表示法</td>
<td style="text-align:center">标准列表语法使用<code>[ ]</code>或逗号分隔值</td>
</tr>
</tbody>
</table>
<blockquote>
<p>我们建议，在可能的情况下，属性以小写的kebab格式存储，例如<code>my.property-name=acme</code>。</p>
</blockquote>
<p>绑定到<code>Map</code>属性时，如果<code>key</code>包含除小写字母数字字符以外的任何内容，则<code>-</code>需要使用括号表示法以保留原始值。如果密钥未被包围<code>[]</code>，则任何非字母数字或<code>-</code>删除的字符。例如，考虑将以下属性绑定到<code>Map</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line"><span class="attr">  map:</span></span><br><span class="line">    <span class="string">"[/key1]"</span><span class="string">:</span> <span class="string">value1</span></span><br><span class="line">    <span class="string">"[/key2]"</span><span class="string">:</span> <span class="string">value2</span></span><br><span class="line">    <span class="string">/key3:</span> <span class="string">value3</span></span><br></pre></td></tr></table></figure>
<p>上面的属性将绑定到<code>Map</code>with <code>/key1</code>，<code>/key2</code>并<code>key3</code>作为地图中的键。</p>
<h2 id="合并复杂类型"><a href="#合并复杂类型" class="headerlink" title="合并复杂类型"></a>合并复杂类型</h2><p>当列表在多个位置配置时，覆盖通过替换整个列表来工作。</p>
<p>例如，假设一个<code>MyPojo</code>具有对象<code>name</code>和<code>description</code>那些属性 <code>null</code>默认。以下示例公开了以下<code>MyPojo</code>对象 列表<code>AcmeProperties</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"acme"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> List&lt;MyPojo&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;MyPojo&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请考虑以下配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line"><span class="attr">  list:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">my</span> <span class="string">name</span></span><br><span class="line"><span class="attr">      description:</span> <span class="string">my</span> <span class="string">description</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">acme:</span></span><br><span class="line"><span class="attr">  list:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">my</span> <span class="string">another</span> <span class="string">name</span></span><br></pre></td></tr></table></figure>
<p>如果<code>dev</code>配置文件未激活，则<code>AcmeProperties.list</code>包含一个<code>MyPojo</code>条目，如先前定义的那样。<code>dev</code>但是，如果启用了配置文件，则<code>list</code> <em>仍然</em> 只包含一个条目（名称<code>my another name</code>和描述<code>null</code>）。此配置<em>不会</em><code>MyPojo</code>向列表添加第二个实例，也不会合并项目。</p>
<p>当<code>List</code>在多个配置文件中指定a时，将使用具有最高优先级（并且仅具有该优先级）的配置文件。请考虑以下示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line"><span class="attr">  list:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">my</span> <span class="string">name</span></span><br><span class="line"><span class="attr">      description:</span> <span class="string">my</span> <span class="string">description</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">another</span> <span class="string">name</span></span><br><span class="line">	  <span class="attr">description:</span> <span class="string">another</span> <span class="string">description</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">acme:</span></span><br><span class="line"><span class="attr">  list:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">my</span> <span class="string">another</span> <span class="string">name</span></span><br></pre></td></tr></table></figure>
<p>在前面的示例中，如果<code>dev</code>配置文件处于活动状态，则<code>AcmeProperties.list</code>包含 <em>一个</em> <code>MyPojo</code>条目（名称<code>my another name</code>和描述<code>null</code>）。对于YAML，逗号分隔列表和YAML列表都可用于完全覆盖列表的内容。</p>
<p>对于<code>Map</code>属性，您可以绑定从多个源中提取的属性值。但是，对于多个源中的相同属性，使用具有最高优先级的属性。以下示例公开了一个<code>Map&lt;String, MyPojo&gt;</code>from <code>AcmeProperties</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"acme"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, MyPojo&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, MyPojo&gt; <span class="title">getMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.map;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请考虑以下配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line"><span class="attr">  map:</span></span><br><span class="line"><span class="attr">    key1:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">my</span> <span class="string">name</span> <span class="number">1</span></span><br><span class="line"><span class="attr">      description:</span> <span class="string">my</span> <span class="string">description</span> <span class="number">1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">acme:</span></span><br><span class="line"><span class="attr">  map:</span></span><br><span class="line"><span class="attr">    key1:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">dev</span> <span class="string">name</span> <span class="number">1</span></span><br><span class="line"><span class="attr">    key2:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">dev</span> <span class="string">name</span> <span class="number">2</span></span><br><span class="line"><span class="attr">      description:</span> <span class="string">dev</span> <span class="string">description</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>如果<code>dev</code>配置文件未处于活动状态，则<code>AcmeProperties.map</code>包含一个带密钥的条目<code>key1</code> （名称<code>my name 1</code>和描述<code>my description 1</code>）。<code>dev</code>但是，如果启用了配置文件，则<code>map</code>包含两个带有键的条目<code>key1</code> （名称<code>dev name 1</code>和描述<code>my description 1</code>）和 <code>key2</code>（名称<code>dev name 2</code>和描述<code>dev description 2</code>）。</p>
<blockquote>
<p>前面的合并规则适用于所有属性源的属性，而不仅仅适用于YAML文件。</p>
</blockquote>
<h2 id="属性转换"><a href="#属性转换" class="headerlink" title="属性转换"></a>属性转换</h2><p>Spring Boot尝试在绑定到<code>@ConfigurationProperties</code>bean 时将外部应用程序属性强制转换为正确的类型。如果需要自定义类型转换，则可以提供<code>ConversionService</code>bean（带有bean命名<code>conversionService</code>）或自定义属性编辑器（通过<code>CustomEditorConfigurer</code>bean）或自定义<code>Converters</code>（带有注释为bean的bean定义<code>@ConfigurationPropertiesBinding</code>）。</p>
<blockquote>
<p>由于在应用程序生命周期中很早就请求此bean，因此请确保限制您<code>ConversionService</code>正在使用的依赖项。通常，您在创建时可能无法完全初始化所需的任何依赖项。<code>ConversionService</code>如果配置密钥强制不需要，您可能需要重命名自定义，并且只依赖于合格的自定义转换器<code>@ConfigurationPropertiesBinding</code>。</p>
</blockquote>
<h3 id="转换持续时间"><a href="#转换持续时间" class="headerlink" title="转换持续时间"></a>转换持续时间</h3><p>Spring Boot专门支持表达持续时间。如果公开 <code>java.time.Duration</code>属性，则可以使用应用程序属性中的以下格式：</p>
<ul>
<li>常规<code>long</code>表示（除非<code>@DurationUnit</code>已指定，否则使用毫秒作为默认单位 ）</li>
<li>标准的ISO-8601格式 <a href="https://docs.oracle.com/javase/8/docs/api//java/time/Duration.html#parse-java.lang.CharSequence-" target="_blank" rel="noopener"> <code>java.util.Duration</code></a>的使用</li>
<li>一种更易读的格式，其中值和单位耦合（例如<code>10s</code>10秒）</li>
</ul>
<p>请考虑以下示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"app.system"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppSystemProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@DurationUnit</span>(ChronoUnit.SECONDS)</span><br><span class="line">	<span class="keyword">private</span> Duration sessionTimeout = Duration.ofSeconds(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Duration readTimeout = Duration.ofMillis(<span class="number">1000</span>);</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Duration <span class="title">getSessionTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.sessionTimeout;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionTimeout</span><span class="params">(Duration sessionTimeout)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sessionTimeout = sessionTimeout;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Duration <span class="title">getReadTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.readTimeout;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReadTimeout</span><span class="params">(Duration readTimeout)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.readTimeout = readTimeout;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要指定30秒的会话超时<code>30</code>，<code>PT30S</code>并且<code>30s</code>都是等效的。的500ms的读超时可以以任何形式如下指定：<code>500</code>，<code>PT0.5S</code>和 <code>500ms</code>。</p>
<p>您也可以使用任何支持的单位。这些是：</p>
<ul>
<li><code>ns</code> 为纳秒</li>
<li><code>us</code> 微秒</li>
<li><code>ms</code> 毫秒</li>
<li><code>s</code> 几秒钟</li>
<li><code>m</code> 几分钟</li>
<li><code>h</code> 用了几个小时</li>
<li><code>d</code> 持续数天</li>
</ul>
<p>默认单位是毫秒，可以使用<code>@DurationUnit</code>上面的示例中所示进行覆盖。</p>
<blockquote>
<p>如果要从仅<code>Long</code>用于表示持续时间的先前版本升级，请确保定义单位（使用<code>@DurationUnit</code>），如果它不是交换机旁边的毫秒数<code>Duration</code>。这样做可以提供透明的升级路径，同时支持更丰富的格式。</p>
</blockquote>
<h3 id="转换数据大小"><a href="#转换数据大小" class="headerlink" title="转换数据大小"></a>转换数据大小</h3><p>Spring Framework有一个<code>DataSize</code>值类型，允许以字节为单位表示大小。如果公开<code>DataSize</code>属性，则可以使用应用程序属性中的以下格式：</p>
<ul>
<li>常规<code>long</code>表示（使用字节作为默认单位，除非 <code>@DataSizeUnit</code>已指定）</li>
<li>更可读的格式，其中值和单元耦合（例如，<code>10MB</code>意味着10兆字节）</li>
</ul>
<p>请考虑以下示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"app.io"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppIoProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@DataSizeUnit</span>(DataUnit.MEGABYTES)</span><br><span class="line">	<span class="keyword">private</span> DataSize bufferSize = DataSize.ofMegabytes(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> DataSize sizeThreshold = DataSize.ofBytes(<span class="number">512</span>);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSize <span class="title">getBufferSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.bufferSize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBufferSize</span><span class="params">(DataSize bufferSize)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.bufferSize = bufferSize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSize <span class="title">getSizeThreshold</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.sizeThreshold;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSizeThreshold</span><span class="params">(DataSize sizeThreshold)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sizeThreshold = sizeThreshold;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>指定10兆字节的缓冲区大小，<code>10</code>并且<code>10MB</code>是等效的。可以将大小阈值256个字节指定为<code>256</code>或<code>256B</code>。</p>
<p>您也可以使用任何支持的单位。这些是：</p>
<ul>
<li><code>B</code> 用于字节</li>
<li><code>KB</code> 为千字节</li>
<li><code>MB</code> 对于兆字节</li>
<li><code>GB</code> 为千兆字节</li>
<li><code>TB</code> 对于太字节</li>
</ul>
<p>默认单位是字节，可以使用<code>@DataSizeUnit</code>上面的示例中所示进行覆盖。</p>
<blockquote>
<p>如果要从仅<code>Long</code>用于表示大小的先前版本升级，请确保定义单位（使用<code>@DataSizeUnit</code>），如果它不是交换机旁边的字节<code>DataSize</code>。这样做可以提供透明的升级路径，同时支持更丰富的格式。</p>
</blockquote>
<h2 id="ConfigurationProperties验证"><a href="#ConfigurationProperties验证" class="headerlink" title="@ConfigurationProperties验证"></a>@ConfigurationProperties验证</h2><p>Spring Boot尝试在<code>@ConfigurationProperties</code>使用Spring的<code>@Validated</code>注释注释时验证类。您可以<code>javax.validation</code> 直接在配置类上使用JSR-303 约束注释。为此，请确保符合条件的JSR-303实现位于类路径上，然后将约束注释添加到字段中，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"acme"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>您还可以通过注释<code>@Bean</code>创建配置属性的方法来触发验证<code>@Validated</code>。</p>
</blockquote>
<p>虽然嵌套属性也会在绑定时进行验证，但最好还是将关联字段注释为<code>@Valid</code>。这确保即使没有找到嵌套属性也会触发验证。以下示例基于前面的<code>AcmeProperties</code>示例构建 ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"acme"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Valid</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Security security = <span class="keyword">new</span> Security();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@NotEmpty</span></span><br><span class="line">		<span class="keyword">public</span> String username;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您还可以<code>Validator</code>通过创建名为的bean定义 来添加自定义Spring <code>configurationPropertiesValidator</code>。<code>@Bean</code>应声明该方法<code>static</code>。配置属性验证器是在应用程序生命周期的早期创建的，并且将该<code>@Bean</code>方法声明为static可以创建bean而无需实例化<code>@Configuration</code>该类。这样做可以避免早期实例化可能导致的任何问题。有一个 <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-samples/spring-boot-sample-property-validation" target="_blank" rel="noopener">属性验证示例</a>，显示如何设置。</p>
<blockquote>
<p>该<code>spring-boot-actuator</code>模块包括一个暴露所有<code>@ConfigurationProperties</code>bean 的端点 。将Web浏览器指向 <code>/actuator/configprops</code>或使用等效的JMX端点。有关详细信息，请参阅“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#production-ready-endpoints" target="_blank" rel="noopener">生产就绪功能</a> ”部分。</p>
</blockquote>
<h2 id="ConfigurationProperties与-Value"><a href="#ConfigurationProperties与-Value" class="headerlink" title="@ConfigurationProperties与@Value"></a>@ConfigurationProperties与@Value</h2><p><code>@Value</code>的注释是核心容器的功能，和它不提供相同的功能，类型安全配置属性。下表汇总了支持的功能<code>@ConfigurationProperties</code>和<code>@Value</code>：</p>
<table>
<thead>
<tr>
<th style="text-align:center">特征</th>
<th style="text-align:center"><code>@ConfigurationProperties</code></th>
<th style="text-align:center"><code>@Value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding" target="_blank" rel="noopener">轻松绑定</a></td>
<td style="text-align:center">是</td>
<td style="text-align:center">没有</td>
</tr>
<tr>
<td style="text-align:center"><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#configuration-metadata" target="_blank" rel="noopener">元数据支持</a></td>
<td style="text-align:center">是</td>
<td style="text-align:center">没有</td>
</tr>
<tr>
<td style="text-align:center"><code>SpEL</code> 评测</td>
<td style="text-align:center">没有</td>
<td style="text-align:center">是</td>
</tr>
</tbody>
</table>
<p>如果为自己的组件定义一组配置键，我们建议您将它们分组到带注释的POJO中<code>@ConfigurationProperties</code>。您还应该知道，因为<code>@Value</code>不支持宽松绑定，所以如果您需要使用环境变量来提供值，则它不是一个好的候选者。</p>
<p>最后，虽然您可以编写<code>SpEL</code>表达式<code>@Value</code>，但不会从<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-external-config-application-property-files" target="_blank" rel="noopener">应用程序属性文件中</a>处理此类表达式。</p>
</div></div><a class="button-hover more" href="/2019/03/20/使用SpringBoot-类型安全配置属性/#more">阅读全文</a></div></div><div id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/3/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fas fa-angle-right"></i></a></div></div></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fas fa-user"></i></span><span id="busuanzi_value_site_uv"></span><span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fas fa-eye"></i></span><span id="busuanzi_value_site_pv"></span><span></span></div><div class="copyright">&copy;2019 By YoungDream</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/clicklove.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>