<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="正忙着优秀~~~"><meta name="keywords" content><meta name="author" content="YoungDream,undefined"><meta name="copyright" content="YoungDream"><title>小小搬砖工【YD Blog】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon-16x16-user.png"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!--link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!--link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!--script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"0BGAOITLJQ","apiKey":"2c864a8b4720c83c2ddfc7e53d4c1711","indexName":"article_NAME","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="author-info"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/user.jpg"></div><div class="author-info-name">YoungDream</div><div class="author-info-description">正忙着优秀~~~</div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/qq994300880" target="_blank">GitHub<i class="icon-dot bg-color4"></i></a><a class="links-button button-hover" href="http://wpa.qq.com/msgrd?v=3&amp;uin=994300880&amp;site=qq&amp;menu=yes" target="_blank">QQ<i class="icon-dot bg-color1"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">47</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">57</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">5</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">YD Blog</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><div id="recent-posts"><!-- each post in page.posts.sort('date', -1).limit(10).toArray()--><!-- config中配置按照什么排序--><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-WebService/">使用SpringBoot-WebService</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/service/">service</a></div></div><div class="post-content"><div class="main-content content"><h1 id="WebService"><a href="#WebService" class="headerlink" title="WebService"></a>WebService</h1><p>Spring Boot提供Web服务自动配置，因此您必须做的就是定义您的<code>Endpoints</code>。</p>
<p>在<a href="https://docs.spring.io/spring-ws/docs/3.0.6.RELEASE/reference/" target="_blank" rel="noopener">春天的Web服务功能</a>可以与轻松访问<code>spring-boot-starter-webservices</code>模块。</p>
<p><code>SimpleWsdl11Definition</code>和<code>SimpleXsdSchema</code>bean可以分别为您的WSDL和XSD自动创建。为此，请配置其位置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.webservices.wsdl-locations=classpath:/wsdl</span><br></pre></td></tr></table></figure>
<h2 id="使用Web调用Web服务-WebServiceTemplate"><a href="#使用Web调用Web服务-WebServiceTemplate" class="headerlink" title="使用Web调用Web服务 WebServiceTemplate"></a>使用Web调用Web服务 WebServiceTemplate</h2><p>如果需要从应用程序调用远程Web服务，则可以使用 <a href="https://docs.spring.io/spring-ws/docs/3.0.6.RELEASE/reference/#client-web-service-template" target="_blank" rel="noopener"><code>WebServiceTemplate</code></a>该类。由于<code>WebServiceTemplate</code>实例在使用之前通常需要自定义，因此Spring Boot不提供任何单个自动配置的<code>WebServiceTemplate</code>bean。但是，它会自动配置a <code>WebServiceTemplateBuilder</code>，可用于<code>WebServiceTemplate</code>在需要时创建 实例。</p>
<p>以下代码显示了一个典型示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> WebServiceTemplate webServiceTemplate;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">(WebServiceTemplateBuilder webServiceTemplateBuilder)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.webServiceTemplate = webServiceTemplateBuilder.build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DetailsResp <span class="title">someWsCall</span><span class="params">(DetailsReq detailsReq)</span> </span>&#123;</span><br><span class="line">		 <span class="keyword">return</span> (DetailsResp) <span class="keyword">this</span>.webServiceTemplate</span><br><span class="line">             .marshalSendAndReceive(detailsReq, <span class="keyword">new</span> SoapActionCallback(ACTION));</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认情况下，使用类路径上的可用HTTP客户端库<code>WebServiceTemplateBuilder</code>检测合适的基于 <code>WebServiceMessageSender</code>HTTP的。您还可以按如下方式自定义读取和连接超时：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebServiceTemplate <span class="title">webServiceTemplate</span><span class="params">(WebServiceTemplateBuilder builder)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> builder.messageSenders(<span class="keyword">new</span> HttpWebServiceMessageSenderBuilder()</span><br><span class="line">			.setConnectTimeout(<span class="number">5000</span>).setReadTimeout(<span class="number">2000</span>).build()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-WebService/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-WebSockets/">使用SpringBoot-WebSockets</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/websocket/">websocket</a></div></div><div class="post-content"><div class="main-content content"><h1 id="WebSockets"><a href="#WebSockets" class="headerlink" title="WebSockets"></a>WebSockets</h1><p>Spring Boot为嵌入式Tomcat，Jetty和Undertow提供WebSockets自动配置。如果将war文件部署到独立容器，则Spring Boot假定容器负责其WebSocket支持的配置。</p>
<p>Spring Framework 为MVC Web应用程序提供了<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web.html#websocket" target="_blank" rel="noopener">丰富的WebSocket支持</a>，可以通过该<code>spring-boot-starter-websocket</code>模块轻松访问 。</p>
<p>WebSocket支持也可用于 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web-reactive.html#webflux-websocket" target="_blank" rel="noopener">响应式Web应用程序，</a>并且需要包括WebSocket API以及<code>spring-boot-starter-webflux</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.websocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.websocket-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-WebSockets/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBott-test/">使用SpringBott-test</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/test/">test</a></div></div><div class="post-content"><div class="main-content content"><h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><p>Spring Boot提供了许多实用程序和注释来帮助您测试应用程序。测试支持由两个模块提供：<code>spring-boot-test</code>包含核心项，并<code>spring-boot-test-autoconfigure</code>支持测试的自动配置。</p>
<p>大多数开发人员使用<code>spring-boot-starter-test</code>启动器，它导入Spring Boot测试模块以及JUnit，AssertJ，Hamcrest和许多其他有用的库。</p>
<h2 id="测试范围依赖性"><a href="#测试范围依赖性" class="headerlink" title="测试范围依赖性"></a>测试范围依赖性</h2><p>在<code>spring-boot-starter-test</code>启动器中（<code>test</code> <code>scope</code>）包含以下提供的库：</p>
<ul>
<li><a href="http://junit.org/" target="_blank" rel="noopener">JUnit</a>：单元测试Java应用程序的事实上的标准。</li>
<li><a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/testing.html#integration-testing" target="_blank" rel="noopener">Spring Test</a>和Spring Boot测试：Spring Boot应用程序的实用程序和集成测试支持。</li>
<li><a href="https://joel-costigliola.github.io/assertj/" target="_blank" rel="noopener">AssertJ</a>：一个流畅的断言库。</li>
<li><a href="http://hamcrest.org/JavaHamcrest/" target="_blank" rel="noopener">Hamcrest</a>：匹配器对象库（也称为约束或谓词）。</li>
<li><a href="http://mockito.org/" target="_blank" rel="noopener">Mockito</a>：一个Java <a href="http://mockito.org/" target="_blank" rel="noopener">模拟</a>框架。</li>
<li><a href="https://github.com/skyscreamer/JSONassert" target="_blank" rel="noopener">JSONassert</a>：JSON的断言库。</li>
<li><a href="https://github.com/jayway/JsonPath" target="_blank" rel="noopener">JsonPath</a>：JSON的XPath。</li>
</ul>
<p>我们通常发现这些常用库在编写测试时很有用。如果这些库不符合您的需求，您可以添加自己的其他测试依赖项。</p>
<h2 id="测试Spring应用程序"><a href="#测试Spring应用程序" class="headerlink" title="测试Spring应用程序"></a>测试Spring应用程序</h2><p>依赖注入的一个主要优点是它应该使您的代码更容易进行单元测试。您可以使用<code>new</code>运算符实例化对象，甚至不涉及Spring。您还可以使用<em>模拟对象</em>而不是真正的依赖项。</p>
<p>通常，您需要超越单元测试并开始集成测试（使用Spring <code>ApplicationContext</code>）。能够在不需要部署应用程序或需要连接到其他基础架构的情况下执行集成测试非常有用。</p>
<p>Spring Framework包含一个用于此类集成测试的专用测试模块。您可以直接声明依赖关系<code>org.springframework:spring-test</code>或使用<code>spring-boot-starter-test</code>“Starter”来传递它。</p>
<p>如果您之前没有使用过该<code>spring-test</code>模块，那么首先应阅读Spring Framework参考文档的 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/testing.html#testing" target="_blank" rel="noopener">相关部分</a>。</p>
<h2 id="测试Spring-Boot应用程序"><a href="#测试Spring-Boot应用程序" class="headerlink" title="测试Spring Boot应用程序"></a>测试Spring Boot应用程序</h2><p>Spring Boot应用程序是一个Spring <code>ApplicationContext</code>，所以没有什么特别的东西可以用来测试它超出你通常使用的Spring语境。</p>
<blockquote>
<p>只有在您<code>SpringApplication</code>创建Spring Boot的外部属性，日志记录和其他功能时，默认情况下才会在上下文中安装它们。</p>
</blockquote>
<p>Spring Boot提供了一个<code>@SpringBootTest</code>注释，<code>spring-test</code> <code>@ContextConfiguration</code>当您需要Spring Boot功能时，它可以用作标准注释的替代方法。注释的工作原理是通过 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-detecting-config" target="_blank" rel="noopener">创建 <code>ApplicationContext</code>测试中使用的<code>SpringApplication</code></a>。除了 <code>@SpringBootTest</code>提供许多其他注释之外，还提供了用于 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" target="_blank" rel="noopener">测试</a>应用程序的<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" target="_blank" rel="noopener">更具体的切片</a>。</p>
<blockquote>
<p>如果您使用的是JUnit 4，请不要忘记添加<code>@RunWith(SpringRunner.class)</code>到测试中，否则注释将被忽略。如果您使用的是JUnit 5，则无需添加等效项<code>@ExtendWith(SpringExtension)</code>，<code>@SpringBootTest</code>并且其他<code>@…Test</code>注释已经使用它进行注释。</p>
</blockquote>
<p>默认情况下，<code>@SpringBootTest</code>不会启动服务器。您可以使用该<code>webEnvironment</code> 属性<code>@SpringBootTest</code>进一步优化测试的运行方式：</p>
<ul>
<li><code>MOCK</code>（默认）：加载Web <code>ApplicationContext</code>并提供模拟Web环境。使用此批注时，不会启动嵌入式服务器。如果类路径上没有Web环境，则此模式将透明地回退到创建常规非Web <code>ApplicationContext</code>。它可以与Web应用程序一起使用 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-with-mock-environment" target="_blank" rel="noopener"><code>@AutoConfigureMockMvc</code>或<code>@AutoConfigureWebTestClient</code></a>用于基于模拟的Web应用程序测试。</li>
<li><code>RANDOM_PORT</code>：加载a <code>WebServerApplicationContext</code>并提供真实的Web环境。嵌入式服务器启动并在随机端口上侦听。</li>
<li><code>DEFINED_PORT</code>：加载a <code>WebServerApplicationContext</code>并提供真实的Web环境。嵌入式服务器启动并侦听定义的端口（来自您的<code>application.properties</code>）或默认端口<code>8080</code>。</li>
<li><code>NONE</code>：<code>ApplicationContext</code>通过使用<code>SpringApplication</code>但不提供 <em>任何</em> Web环境（模拟或其他）来加载。</li>
</ul>
<blockquote>
<p>如果您的测试是<code>@Transactional</code>，则默认情况下会在每个测试方法结束时回滚事务。但是，当使用这种安排<code>RANDOM_PORT</code>或者 <code>DEFINED_PORT</code>隐式地提供真实的servlet环境时，HTTP客户端和服务器在不同的线程中运行，因此在单独的事务中运行。在这种情况下，在服务器上启动的任何事务都不会回滚。</p>
</blockquote>
<blockquote>
<p><code>@SpringBootTest`</code>webEnvironment = WebEnvironment.RANDOM_PORT`如果您的应用程序使用管理服务器的不同端口，则还将在单独的随机端口上启动管理服务器。</p>
</blockquote>
<h3 id="检测Web应用程序类型"><a href="#检测Web应用程序类型" class="headerlink" title="检测Web应用程序类型"></a>检测Web应用程序类型</h3><p>如果Spring MVC可用，则配置基于MVC的常规应用程序上下文。如果您只有Spring WebFlux，我们会检测到并配置基于WebFlux的应用程序上下文。</p>
<p>如果两者都存在，则Spring MVC优先。如果要在此方案中测试响应式Web应用程序，则必须设置该<code>spring.main.web-application-type</code> 属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span>(properties = <span class="string">"spring.main.web-application-type=reactive"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebFluxTests</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h3 id="检测测试配置"><a href="#检测测试配置" class="headerlink" title="检测测试配置"></a>检测测试配置</h3><p>如果您熟悉Spring Test Framework，则可能习惯使用 <code>@ContextConfiguration(classes=…)</code>以指定<code>@Configuration</code>要加载的Spring 。或者，您可能经常<code>@Configuration</code>在测试中使用嵌套类。</p>
<p>在测试Spring Boot应用程序时，通常不需要这样做。<code>@*Test</code> 只要您没有明确定义，Spring Boot的注释就会自动搜索您的主要配置。</p>
<p>搜索算法从包含测试的包开始工作，直到找到用<code>@SpringBootApplication</code>or 注释的类<code>@SpringBootConfiguration</code>。只要您以合理的方式<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#using-boot-structuring-your-code" target="_blank" rel="noopener">构建代码</a>，通常就会找到主要配置。</p>
<blockquote>
<p>如果使用 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" target="_blank" rel="noopener">测试批注来测试应用程序的更具体的片段</a>，则应避免在<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-user-configuration" target="_blank" rel="noopener">main方法的应用程序类中</a>添加特定于特定区域的配置设置 。</p>
<p><code>@SpringBootApplication</code>定义的基础组件扫描配置排除了用于确保切片按预期工作的过滤器。如果您<code>@ComponentScan</code>在已<code>@SpringBootApplication</code>注释的类上使用显式 指令，请注意将禁用这些过滤器。如果您正在使用切片，则应再次定义它们。</p>
</blockquote>
<p>如果要自定义主要配置，可以使用嵌套 <code>@TestConfiguration</code>类。与嵌套<code>@Configuration</code>类不同，嵌套类将用于代替应用程序的主要配置，<code>@TestConfiguration</code>除了应用程序的主要配置之外，还使用嵌套类。</p>
<blockquote>
<p>Spring的测试框架在测试之间缓存应用程序上下文。因此，只要您的测试共享相同的配置（无论如何发现），加载上下文的潜在耗时过程只发生一次。</p>
</blockquote>
<h3 id="排除测试配置"><a href="#排除测试配置" class="headerlink" title="排除测试配置"></a>排除测试配置</h3><p>如果您的应用程序使用组件扫描（例如，如果您使用 <code>@SpringBootApplication</code>或<code>@ComponentScan</code>），您可能会发现仅为特定测试创建的顶级配置类会意外地在任何地方被捕获。</p>
<p>正如我们<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-detecting-config" target="_blank" rel="noopener">之前所见</a>，<code>@TestConfiguration</code>可以在测试的内部类上使用来自定义主要配置。放置在顶级类时，<code>@TestConfiguration</code>表示<code>src/test/java</code>不应通过扫描拾取类。然后，您可以在需要的位置显式导入该类，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Import</span>(MyTestsConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exampleTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果您直接使用<code>@ComponentScan</code>（即不通过 <code>@SpringBootApplication</code>），则需要注册<code>TypeExcludeFilter</code>。有关详细信息，请参阅 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api/org/springframework/boot/context/TypeExcludeFilter.html" target="_blank" rel="noopener">Javadoc</a>。</p>
</blockquote>
<h3 id="使用模拟环境进行测试"><a href="#使用模拟环境进行测试" class="headerlink" title="使用模拟环境进行测试"></a>使用模拟环境进行测试</h3><p>默认情况下，<code>@SpringBootTest</code>不启动服务器。如果您要针对此模拟环境测试Web端点，则可以另外进行配置 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference//testing.html#spring-mvc-test-framework" target="_blank" rel="noopener"><code>MockMvc</code></a>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBoot</span><br><span class="line">Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockMvcExampleTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exampleTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mvc.perform(get(<span class="string">"/"</span>)).andExpect(status().isOk())</span><br><span class="line">				.andExpect(content().string(<span class="string">"Hello World"</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果你想只专注于网络层，而不是开始一个完整的 <code>ApplicationContext</code>，可以考虑 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests" target="_blank" rel="noopener">使用 <code>@WebMvcTest</code>替代</a>。</p>
</blockquote>
<p>或者，您可以配置一个 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/testing.html#webtestclient-tests" target="_blank" rel="noopener"><code>WebTestClient</code></a>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.AutoConfigureWebTestClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureWebTestClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockWebTestClientExampleTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> WebTestClient webClient;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exampleTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.webClient.get().uri(<span class="string">"/"</span>).exchange().expectStatus().isOk()</span><br><span class="line">            .expectBody(String.class).isEqualTo(<span class="string">"Hello World"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用正在运行的服务器进行测试"><a href="#使用正在运行的服务器进行测试" class="headerlink" title="使用正在运行的服务器进行测试"></a>使用正在运行的服务器进行测试</h3><p>如果您需要启动一个完整运行的服务器，我们建议您使用随机端口。如果使用<code>@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code>，每次测试运行时都会随机选取一个可用端口。</p>
<p>该<code>@LocalServerPort</code>注释可用于 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-discover-the-http-port-at-runtime" target="_blank" rel="noopener">注射使用的实际端口</a>到您的测试。为了方便起见，测试，需要做出REST调用启动的服务器可另外<code>@Autowire</code>一个<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/testing.html#webtestclient-tests" target="_blank" rel="noopener"><code>WebTestClient</code></a>，它解析为正在运行的服务器相对链接，并附带了用于验证响应的专用API，如下面的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest.WebEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span>(webEnvironment = WebEnvironment.RANDOM_PORT)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomPortWebTestClientExampleTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> WebTestClient webClient;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exampleTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.webClient.get().uri(<span class="string">"/"</span>).exchange().expectStatus().isOk()</span><br><span class="line">				.expectBody(String.class).isEqualTo(<span class="string">"Hello World"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此类设置需要<code>spring-webflux</code>在类路径上。如果您不能或不会添加webflux，Spring Boot还提供了一个<code>TestRestTemplate</code>工具：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest.WebEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.web.client.TestRestTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.assertThat;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span>(webEnvironment = WebEnvironment.RANDOM_PORT)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomPortTestRestTemplateExampleTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TestRestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exampleTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String body = <span class="keyword">this</span>.restTemplate.getForObject(<span class="string">"/"</span>, String.class);</span><br><span class="line">		assertThat(body).isEqualTo(<span class="string">"Hello World"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用JMX"><a href="#使用JMX" class="headerlink" title="使用JMX"></a>使用JMX</h3><p>当测试上下文框架缓存上下文时，默认情况下禁用JMX以防止相同的组件在同一域上注册。如果此类测试需要访问 <code>MBeanServer</code>，请考虑将其标记为脏：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span>(properties = <span class="string">"spring.jmx.enabled=true"</span>)</span><br><span class="line"><span class="meta">@DirtiesContext</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleJmxTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> MBeanServer mBeanServer;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exampleTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Mocking-and-Spying-Beans"><a href="#Mocking-and-Spying-Beans" class="headerlink" title="Mocking and Spying Beans"></a>Mocking and Spying Beans</h3><p>运行测试时，有时需要在应用程序上下文中模拟某些组件。例如，您可能拥有在开发期间不可用的某些远程服务的外观。当您想要模拟在真实环境中难以触发的故障时，模拟也很有用。</p>
<p>Spring Boot包含一个<code>@MockBean</code>注释，可用于为您内部的bean定义Mockito模拟<code>ApplicationContext</code>。您可以使用批注添加新bean或替换单个现有bean定义。注释可以直接用于测试类，测试中的字段，或<code>@Configuration</code>类和字段。在字段上使用时，也会注入创建的模拟的实例。每种测试方法后，模拟豆都会自动重置。</p>
<blockquote>
<p>如果您的测试使用Spring Boot的测试注释之一（例如<code>@SpringBootTest</code>），则会自动启用此功能。要以不同的排列方式使用此功能，必须显式添加侦听器，如以下示例所示：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestExecutionListeners</span>（MockitoTestExecutionListener.class）</span><br></pre></td></tr></table></figure>
<p>以下示例使用<code>RemoteService</code>模拟实现替换现有bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.mock.mockito.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.BDDMockito.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@MockBean</span></span><br><span class="line">	<span class="keyword">private</span> RemoteService remoteService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> Reverser reverser;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exampleTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// RemoteService has been injected into the reverser bean</span></span><br><span class="line">		given(<span class="keyword">this</span>.remoteService.someCall()).willReturn(<span class="string">"mock"</span>);</span><br><span class="line">		String reverse = reverser.reverseSomeCall();</span><br><span class="line">		assertThat(reverse).isEqualTo(<span class="string">"kcom"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此外，您可以使用<code>@SpyBean</code>Mockito来包装任何现有的bean <code>spy</code>。有关详细信息，请参阅<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api/org/springframework/boot/test/mock/mockito/SpyBean.html" target="_blank" rel="noopener">Javadoc</a>。</p>
<blockquote>
<p>虽然Spring的测试框架在测试之间缓存应用程序上下文并重用共享相同配置的测试的上下文，但是使用<code>@MockBean</code>或<code>@SpyBean</code> 影响缓存键，这很可能会增加上下文的数量。</p>
</blockquote>
<blockquote>
<p>如果您使用通过名称引用参数的方法<code>@SpyBean</code>来监视bean，则<code>@Cacheable</code>必须使用编译应用程序<code>-parameters</code>。这确保了一旦bean被监视，参数名称可用于缓存基础结构。</p>
</blockquote>
<h3 id="自动配置的测试"><a href="#自动配置的测试" class="headerlink" title="自动配置的测试"></a>自动配置的测试</h3><p>Spring Boot的自动配置系统适用于应用程序，但有时对于测试来说有点太多了。通常有助于仅加载测试应用程序“切片”所需的配置部分。例如，您可能希望测试Spring MVC控制器是否正确映射URL，并且您不希望在这些测试中涉及数据库调用，或者您可能想要测试JPA实体，并且您对Web层不感兴趣测试运行。</p>
<p>该<code>spring-boot-test-autoconfigure</code>模块包括许多可用于自动配置这种“切片”的注释。它们中的每一个都以类似的方式工作，提供一个<code>@…Test</code>注释，用于加载可用于自定义自动配置设置的<code>ApplicationContext</code>一个或多个<code>@AutoConfigure…</code>注释。</p>
<blockquote>
<p>每个切片将组件扫描限制为适当的组件，并加载一组非常有限的自动配置类。如果您需要排除其中一个，大多数<code>@…Test</code>注释都会提供一个<code>excludeAutoConfiguration</code>属性。或者，您可以使用<code>@ImportAutoConfiguration#exclude</code>。</p>
</blockquote>
<blockquote>
<p><code>@Test</code>不支持在一次测试中使用多个注释包括多个“切片” 。如果您需要多个“切片”，请选择其中一个<code>@…Test</code>注释并<code>@AutoConfigure…</code>手动包含其他“切片” 的注释。</p>
</blockquote>
<blockquote>
<p>也可以使用<code>@AutoConfigure…</code>带有标准 <code>@SpringBootTest</code>注释的注释。如果您对“切片”应用程序不感兴趣但想要一些自动配置的测试bean，则可以使用此组合。</p>
</blockquote>
<h3 id="自动配置的JSON测试"><a href="#自动配置的JSON测试" class="headerlink" title="自动配置的JSON测试"></a>自动配置的JSON测试</h3><p>要测试该对象JSON序列化和反序列化是否按预期工作，您可以使用<code>@JsonTest</code>注释。<code>@JsonTest</code>自动配置可用的受支持JSON映射器，它可以是以下库之一：</p>
<ul>
<li>Jackson<code>ObjectMapper</code>，任何<code>@JsonComponent</code>beans和Jackson<code>Module</code>S</li>
<li><code>Gson</code></li>
<li><code>Jsonb</code></li>
</ul>
<blockquote>
<p><code>@JsonTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置列表。</p>
</blockquote>
<p>如果需要配置自动配置的元素，可以使用 <code>@AutoConfigureJsonTesters</code>注释。</p>
<p>Spring Boot包括基于AssertJ的助手，它们与JSONAssert和JsonPath库一起使用，以检查JSON是否按预期显示。的<code>JacksonTester</code>，<code>GsonTester</code>，<code>JsonbTester</code>，和<code>BasicJsonTester</code>类可以分别用于杰克逊，GSON，Jsonb，和字符串。测试类上的任何辅助字段都可以<code>@Autowired</code>在使用时使用<code>@JsonTest</code>。以下示例显示了Jackson的测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.json.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.json.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@JsonTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJsonTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JacksonTester&lt;VehicleDetails&gt; json;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSerialize</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		VehicleDetails details = <span class="keyword">new</span> VehicleDetails(<span class="string">"Honda"</span>, <span class="string">"Civic"</span>);</span><br><span class="line">		<span class="comment">//在与测试断言相同的包中断言.json文件</span></span><br><span class="line">		assertThat(<span class="keyword">this</span>.json.write(details)).isEqualToJson(<span class="string">"expected.json"</span>);</span><br><span class="line">		<span class="comment">//或者使用基于JSON路径的断言</span></span><br><span class="line">		assertThat(<span class="keyword">this</span>.json.write(details)).hasJsonPathStringValue(<span class="string">"@.make"</span>);</span><br><span class="line">		assertThat(<span class="keyword">this</span>.json.write(details)).extractingJsonPathStringValue(<span class="string">"@.make"</span>)</span><br><span class="line">				.isEqualTo(<span class="string">"Honda"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeserialize</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		String content = <span class="string">"&#123;\"make\":\"Ford\",\"model\":\"Focus\"&#125;"</span>;</span><br><span class="line">		assertThat(<span class="keyword">this</span>.json.parse(content))</span><br><span class="line">				.isEqualTo(<span class="keyword">new</span> VehicleDetails(<span class="string">"Ford"</span>, <span class="string">"Focus"</span>));</span><br><span class="line">		assertThat(<span class="keyword">this</span>.json.parseObject(content).getMake()).isEqualTo(<span class="string">"Ford"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>JSON帮助程序类也可以直接在标准单元测试中使用。为此，如果不使用，请在<code>initFields</code>方法中调用帮助程序的<code>@Before</code>方法 <code>@JsonTest</code>。</p>
</blockquote>
<h3 id="自动配置的Spring-MVC测试"><a href="#自动配置的Spring-MVC测试" class="headerlink" title="自动配置的Spring MVC测试"></a>自动配置的Spring MVC测试</h3><p>要测试Spring MVC控制器是否按预期工作，请使用<code>@WebMvcTest</code> 注释。<code>@WebMvcTest</code>自动配置Spring MVC的基础设施和限制扫描豆<code>@Controller</code>，<code>@ControllerAdvice</code>，<code>@JsonComponent</code>，<code>Converter</code>， <code>GenericConverter</code>，<code>Filter</code>，<code>WebMvcConfigurer</code>，和<code>HandlerMethodArgumentResolver</code>。<code>@Component</code>使用此批注时不会扫描常规bean。</p>
<blockquote>
<p><code>@WebMvcTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置设置列表。</p>
</blockquote>
<blockquote>
<p>如果需要注册额外的组件，例如Jackson <code>Module</code>，则可以<code>@Import</code>在测试中使用其他配置类。</p>
</blockquote>
<p>通常，<code>@WebMvcTest</code>仅限于单个控制器，并与其结合使用 <code>@MockBean</code>，为所需的协作者提供模拟实现。</p>
<p><code>@WebMvcTest</code>还自动配置<code>MockMvc</code>。Mock MVC提供了一种快速测试MVC控制器的强大方法，无需启动完整的HTTP服务器。</p>
<blockquote>
<p>您还可以通过使用注释来<code>MockMvc</code>非自动配置<code>@WebMvcTest</code>（例如 <code>@SpringBootTest</code>）<code>@AutoConfigureMockMvc</code>。以下示例使用<code>MockMvc</code>：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.mock.mockito.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.BDDMockito.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@WebMvcTest</span>(UserVehicleController.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyControllerTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@MockBean</span></span><br><span class="line">	<span class="keyword">private</span> UserVehicleService userVehicleService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExample</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		given(<span class="keyword">this</span>.userVehicleService.getVehicleDetails(<span class="string">"sboot"</span>))</span><br><span class="line">				.willReturn(<span class="keyword">new</span> VehicleDetails(<span class="string">"Honda"</span>, <span class="string">"Civic"</span>));</span><br><span class="line">		<span class="keyword">this</span>.mvc.perform(get(<span class="string">"/sboot/vehicle"</span>).accept(MediaType.TEXT_PLAIN))</span><br><span class="line">            .andExpect(status().isOk()).andExpect(content().string(<span class="string">"Honda Civic"</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果需要配置自动配置的元素（例如，应该应用servlet过滤器时），则可以使用<code>@AutoConfigureMockMvc</code> 注释中的属性。</p>
</blockquote>
<p>如果您使用HtmlUnit或Selenium，则自动配置还提供HTMLUnit <code>WebClient</code> bean和/或<code>WebDriver</code>bean。以下示例使用HtmlUnit：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.gargoylesoftware.htmlunit.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.mock.mockito.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.BDDMockito.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@WebMvcTest</span>(UserVehicleController.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHtmlUnitTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> WebClient webClient;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@MockBean</span></span><br><span class="line">	<span class="keyword">private</span> UserVehicleService userVehicleService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExample</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		given(<span class="keyword">this</span>.userVehicleService.getVehicleDetails(<span class="string">"sboot"</span>))</span><br><span class="line">				.willReturn(<span class="keyword">new</span> VehicleDetails(<span class="string">"Honda"</span>, <span class="string">"Civic"</span>));</span><br><span class="line">		HtmlPage page = <span class="keyword">this</span>.webClient.getPage(<span class="string">"/sboot/vehicle.html"</span>);</span><br><span class="line">		assertThat(page.getBody().getTextContent()).isEqualTo(<span class="string">"Honda Civic"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认情况下，Spring Boot将<code>WebDriver</code>bean放在一个特殊的“范围”中，以确保驱动程序在每次测试后退出并注入新实例。如果您不想要此行为，可以添加<code>@Scope(&quot;singleton&quot;)</code>到您的<code>WebDriver</code> <code>@Bean</code> 定义中。</p>
</blockquote>
<blockquote>
<p><code>webDriver</code>Spring Boot创建的范围将替换任何用户定义的同名范围。如果您定义自己的<code>webDriver</code>范围，您可能会发现它在您使用时停止工作<code>@WebMvcTest</code>。</p>
</blockquote>
<p>如果在类路径上有Spring Security，<code>@WebMvcTest</code>则还会扫描<code>WebSecurityConfigurer</code> bean。您可以使用Spring Security的测试支持，而不是完全禁用此类测试的安全性。有关如何使用Spring Security <code>MockMvc</code>支持的更多详细信息，请参见<em>第80章“ 使用Spring Security测试</em>方法”部分。</p>
<blockquote>
<p>有时编写Spring MVC测试是不够的; Spring Boot可以帮助您<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener">使用实际服务器</a>运行 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener">完整的端到端测试</a>。</p>
</blockquote>
<h3 id="自动配置的Spring-WebFlux测试"><a href="#自动配置的Spring-WebFlux测试" class="headerlink" title="自动配置的Spring WebFlux测试"></a>自动配置的Spring WebFlux测试</h3><p>要测试<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference//web-reactive.html" target="_blank" rel="noopener">Spring WebFlux</a>控制器是否按预期工作，您可以使用<code>@WebFluxTest</code>注释。<code>@WebFluxTest</code> 自动配置春季WebFlux基础设施和限制扫描豆<code>@Controller</code>，<code>@ControllerAdvice</code>，<code>@JsonComponent</code>，<code>Converter</code>，<code>GenericConverter</code>，和 <code>WebFluxConfigurer</code>。 使用注释<code>@Component</code>时不会扫描常规bean <code>@WebFluxTest</code>。</p>
<blockquote>
<p><code>@WebFluxTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置列表。</p>
</blockquote>
<blockquote>
<p>如果需要注册额外的组件，例如Jackson <code>Module</code>，则可以<code>@Import</code>在测试中导入其他配置类。</p>
</blockquote>
<p>通常，<code>@WebFluxTest</code>仅限于单个控制器并与<code>@MockBean</code>注释结合使用， 以便为所需的协作者提供模拟实现。</p>
<p><code>@WebFluxTest</code>还有自动配置 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/testing.html#webtestclient" target="_blank" rel="noopener"><code>WebTestClient</code></a>，这提供了一种快速测试WebFlux控制器的强大方法，无需启动完整的HTTP服务器。</p>
<blockquote>
<p>您还可以通过使用注释来<code>WebTestClient</code>非自动配置<code>@WebFluxTest</code>（例如 <code>@SpringBootTest</code>）<code>@AutoConfigureWebTestClient</code>。以下示例显示了使用both <code>@WebFluxTest</code>和a的类<code>WebTestClient</code>：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.WebFluxTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@WebFluxTest</span>(UserVehicleController.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyControllerTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> WebTestClient webClient;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@MockBean</span></span><br><span class="line">	<span class="keyword">private</span> UserVehicleService userVehicleService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExample</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		given(<span class="keyword">this</span>.userVehicleService.getVehicleDetails(<span class="string">"sboot"</span>))</span><br><span class="line">				.willReturn(<span class="keyword">new</span> VehicleDetails(<span class="string">"Honda"</span>, <span class="string">"Civic"</span>));</span><br><span class="line">		<span class="keyword">this</span>.webClient.get().uri(<span class="string">"/sboot/vehicle"</span>).accept(MediaType.TEXT_PLAIN)</span><br><span class="line">				.exchange()</span><br><span class="line">				.expectStatus().isOk()</span><br><span class="line">				.expectBody(String.class).isEqualTo(<span class="string">"Honda Civic"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此设置仅由WebFlux应用程序支持，因为<code>WebTestClient</code>在模拟的Web应用程序中使用仅适用于WebFlux。</p>
</blockquote>
<blockquote>
<p><code>@WebFluxTest</code>无法检测通过功能Web框架注册的路由。要<code>RouterFunction</code>在上下文中测试bean，请考虑<code>RouterFunction</code> 通过<code>@Import</code>或使用自己导入<code>@SpringBootTest</code>。</p>
</blockquote>
<blockquote>
<p>有时编写Spring WebFlux测试是不够的; Spring Boot可以帮助您<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener">使用实际服务器</a>运行 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener">完整的端到端测试</a>。</p>
</blockquote>
<h3 id="自动配置的数据JPA测试"><a href="#自动配置的数据JPA测试" class="headerlink" title="自动配置的数据JPA测试"></a>自动配置的数据JPA测试</h3><p>您可以使用<code>@DataJpaTest</code>注释来测试JPA应用程序。默认情况下，它配置内存中的嵌入式数据库，扫描<code>@Entity</code>类并配置Spring Data JPA存储库。常规<code>@Component</code>bean没有加载到 <code>ApplicationContext</code>。</p>
<blockquote>
<p><code>@DataJpaTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置设置列表。</p>
</blockquote>
<p>默认情况下，数据JPA测试是事务性的，并在每次测试结束时回滚。有关 更多详细信息，请参阅Spring Framework Reference Documentation中的<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_blank" rel="noopener">相关部分</a>。如果这不是您想要的，您可以为测试或整个类禁用事务管理，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataJpaTest</span></span><br><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.NOT_SUPPORTED)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleNonTransactionalTests</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数据JPA测试也可以注入一个 <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/orm/jpa/TestEntityManager.java" target="_blank" rel="noopener"><code>TestEntityManager</code></a> bean，它提供了<code>EntityManager</code>专门为测试设计的标准JPA的替代方法。如果要<code>TestEntityManager</code>在<code>@DataJpaTest</code>实例外部 使用，也可以使用<code>@AutoConfigureTestEntityManager</code> 注释。<code>JdbcTemplate</code>如果您需要，也可以使用A. 以下示例显示<code>@DataJpaTest</code>正在使用的注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.orm.jpa.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataJpaTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleRepositoryTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TestEntityManager entityManager;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserRepository repository;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExample</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.entityManager.persist(<span class="keyword">new</span> User(<span class="string">"sboot"</span>, <span class="string">"1234"</span>));</span><br><span class="line">		User user = <span class="keyword">this</span>.repository.findByUsername(<span class="string">"sboot"</span>);</span><br><span class="line">		assertThat(user.getUsername()).isEqualTo(<span class="string">"sboot"</span>);</span><br><span class="line">		assertThat(user.getVin()).isEqualTo(<span class="string">"1234"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内存中的嵌入式数据库通常可以很好地用于测试，因为它们很快并且不需要任何安装。但是，如果您更喜欢对真实数据库运行测试，则可以使用<code>@AutoConfigureTestDatabase</code>注释，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataJpaTest</span></span><br><span class="line"><span class="meta">@AutoConfigureTestDatabase</span>(replace=Replace.NONE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleRepositoryTests</span> </span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自动配置的JDBC测试"><a href="#自动配置的JDBC测试" class="headerlink" title="自动配置的JDBC测试"></a>自动配置的JDBC测试</h3><p><code>@JdbcTest</code>类似于<code>@DataJpaTest</code>但仅适用于仅需要 <code>DataSource</code>并且不使用Spring Data JDBC的测试。默认情况下，它配置内存中的嵌入式数据库和<code>JdbcTemplate</code>。常规<code>@Component</code>bean没有加载到<code>ApplicationContext</code>。</p>
<blockquote>
<p><code>@JdbcTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置列表。</p>
</blockquote>
<p>默认情况下，JDBC测试是事务性的，并在每次测试结束时回滚。有关更多详细信息，请参阅Spring Framework Reference Documentation中的 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_blank" rel="noopener">相关部分</a>。如果这不是您想要的，您可以禁用测试或整个类的事务管理，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.jdbc.JdbcTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@JdbcTest</span></span><br><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.NOT_SUPPORTED)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleNonTransactionalTests</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果您希望测试针对真实数据库运行，则可以使用与<code>@AutoConfigureTestDatabase</code>注释相同的方式使用 注释<code>DataJpaTest</code>。（参见“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test" target="_blank" rel="noopener">第46.3.12节</a> ” ,”<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test" target="_blank" rel="noopener">自动配置的数据JPA测试</a> “）</p>
<h3 id="自动配置的数据JDBC测试"><a href="#自动配置的数据JDBC测试" class="headerlink" title="自动配置的数据JDBC测试"></a>自动配置的数据JDBC测试</h3><p><code>@DataJdbcTest</code>类似于<code>@JdbcTest</code>但是适用于使用Spring Data JDBC存储库的测试。默认情况下，它配置内存中的嵌入式数据库，a <code>JdbcTemplate</code>和Spring Data JDBC存储库。常规<code>@Component</code>bean没有加载到<code>ApplicationContext</code>。</p>
<blockquote>
<p><code>@DataJdbcTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置列表。</p>
</blockquote>
<p>默认情况下，数据JDBC测试是事务性的，并在每次测试结束时回滚。有关 更多详细信息，请参阅Spring Framework Reference Documentation中的<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_blank" rel="noopener">相关部分</a>。如果这不是您想要的，您可以禁用测试或整个测试类的事务管理，如 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test" target="_blank" rel="noopener">JDBC示例中所示</a>。</p>
<p>如果您希望测试针对真实数据库运行，则可以使用与<code>@AutoConfigureTestDatabase</code>注释相同的方式使用 注释<code>DataJpaTest</code>。（参见“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test" target="_blank" rel="noopener">第46.3.12节</a> ” ,”<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test" target="_blank" rel="noopener">自动配置的数据JPA测试</a> “）</p>
<h3 id="自动配置的jOOQ测试"><a href="#自动配置的jOOQ测试" class="headerlink" title="自动配置的jOOQ测试"></a>自动配置的jOOQ测试</h3><p>您可以使用<code>@JooqTest</code>与<code>@JdbcTest</code>jOOQ相关的测试类似的方式。由于jOOQ严重依赖于与数据库模式对应的基于Java的模式，因此使用现有模式<code>DataSource</code>。如果要将其替换为内存数据库，可以使用<code>@AutoConfigureTestDatabase</code>覆盖这些设置。（有关在Spring Boot中使用jOOQ的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-jooq" target="_blank" rel="noopener">第31.6节</a> ” <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-jooq" target="_blank" rel="noopener">，“使用jOOQ”</a>。）常规 <code>@Component</code>bean不会加载到<code>ApplicationContext</code>。</p>
<blockquote>
<p><code>@JooqTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置列表。</p>
</blockquote>
<p><code>@JooqTest</code>配置一个<code>DSLContext</code>。常规<code>@Component</code>bean没有加载到 <code>ApplicationContext</code>。以下示例显示<code>@JooqTest</code>正在使用的注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.jooq.DSLContext;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.jooq.JooqTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@JooqTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleJooqTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> DSLContext dslContext;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JOOQ测试是事务性的，默认情况下在每次测试结束时回滚。如果这不是您想要的，您可以禁用测试或整个测试类的事务管理，如 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test" target="_blank" rel="noopener">JDBC示例中所示</a>。</p>
<h3 id="自动配置的数据MongoDB测试"><a href="#自动配置的数据MongoDB测试" class="headerlink" title="自动配置的数据MongoDB测试"></a>自动配置的数据MongoDB测试</h3><p>您可以使用它<code>@DataMongoTest</code>来测试MongoDB应用程序。默认情况下，它配置内存中嵌入的MongoDB（如果可用），配置<code>MongoTemplate</code>，扫描 <code>@Document</code>类以及配置Spring Data MongoDB存储库。常规 <code>@Component</code>bean没有加载到<code>ApplicationContext</code>。（有关将MongoDB与Spring Boot一起使用的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-mongodb" target="_blank" rel="noopener">第32.2节”，“MongoDB”</a>。）</p>
<blockquote>
<p><code>@DataMongoTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置设置列表。</p>
</blockquote>
<p>以下类显示<code>@DataMongoTest</code>正在使用的注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.data.mongo.DataMongoTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataMongoTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleDataMongoTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内存中嵌入式MongoDB通常适用于测试，因为它速度快，不需要任何开发人员安装。但是，如果您更喜欢对真正的MongoDB服务器运行测试，则应排除嵌入式MongoDB自动配置，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.data.mongo.DataMongoTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataMongoTest</span>(excludeAutoConfiguration = EmbeddedMongoAutoConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleDataMongoNonEmbeddedTests</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自动配置的数据Neo4j测试"><a href="#自动配置的数据Neo4j测试" class="headerlink" title="自动配置的数据Neo4j测试"></a>自动配置的数据Neo4j测试</h3><p>您可以使用它<code>@DataNeo4jTest</code>来测试Neo4j应用程序。默认情况下，它使用内存中嵌入式Neo4j（如果嵌入式驱动程序可用），扫描<code>@NodeEntity</code>类并配置Spring Data Neo4j存储库。常规<code>@Component</code>bean没有加载到<code>ApplicationContext</code>。（有关使用带有Spring Boot的Neo4J的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-neo4j" target="_blank" rel="noopener">第32.3节”，“Neo4j”</a>。）</p>
<blockquote>
<p><code>@DataNeo4jTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置设置列表。</p>
</blockquote>
<p>以下示例显示了在Spring Boot中使用Neo4J测试的典型设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.data.neo4j.DataNeo4jTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataNeo</span>4jTest</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleDataNeo4jTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> YourRepository repository;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认情况下，Data Neo4j测试是事务性的，并在每次测试结束时回滚。有关更多详细信息，请参阅Spring Framework Reference Documentation中的<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_blank" rel="noopener">相关部分</a>。如果这不是您想要的，您可以禁用测试或整个类的事务管理，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.data.neo4j.DataNeo4jTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataNeo</span>4jTest</span><br><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.NOT_SUPPORTED)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleNonTransactionalTests</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自动配置的数据Redis测试"><a href="#自动配置的数据Redis测试" class="headerlink" title="自动配置的数据Redis测试"></a>自动配置的数据Redis测试</h3><p>您可以使用它<code>@DataRedisTest</code>来测试Redis应用程序。默认情况下，它会扫描 <code>@RedisHash</code>类并配置Spring Data Redis存储库。常规<code>@Component</code> bean没有加载到<code>ApplicationContext</code>。（有关使用带有Spring Boot的Redis的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-redis" target="_blank" rel="noopener">第32.1节”，“Redis”</a>。）</p>
<blockquote>
<p><code>@DataRedisTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置设置列表。</p>
</blockquote>
<p>以下示例显示<code>@DataRedisTest</code>正在使用的注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.data.redis.DataRedisTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataRedisTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleDataRedisTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> YourRepository repository;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自动配置的数据LDAP测试"><a href="#自动配置的数据LDAP测试" class="headerlink" title="自动配置的数据LDAP测试"></a>自动配置的数据LDAP测试</h3><p>您可以使用它<code>@DataLdapTest</code>来测试LDAP应用程序。默认情况下，它配置内存中嵌入式LDAP（如果可用），配置<code>LdapTemplate</code>，扫描<code>@Entry</code> 类以及配置Spring Data LDAP存储库。常规<code>@Component</code>bean没有加载到<code>ApplicationContext</code>。（有关在Spring Boot中使用LDAP的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-ldap" target="_blank" rel="noopener">第32.9节”，“LDAP”</a>。）</p>
<blockquote>
<p><code>@DataLdapTest</code>可以 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置设置列表。</p>
</blockquote>
<p>以下示例显示<code>@DataLdapTest</code>正在使用的注释：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.data.ldap.DataLdapTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ldap.core.LdapTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataLdapTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleDataLdapTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> LdapTemplate ldapTemplate;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内存中嵌入式LDAP通常适用于测试，因为它速度快，不需要任何开发人员安装。但是，如果您更喜欢针对真实LDAP服务器运行测试，则应排除嵌入式LDAP自动配置，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.data.ldap.DataLdapTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@DataLdapTest</span>(excludeAutoConfiguration = EmbeddedLdapAutoConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleDataLdapNonEmbeddedTests</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自动配置的REST客户端"><a href="#自动配置的REST客户端" class="headerlink" title="自动配置的REST客户端"></a>自动配置的REST客户端</h3><p>您可以使用<code>@RestClientTest</code>注释来测试REST客户端。默认情况下，它会自动配置Jackson，GSON和Jsonb支持，配置<code>RestTemplateBuilder</code>并添加支持<code>MockRestServiceServer</code>。常规<code>@Component</code>bean没有加载到<code>ApplicationContext</code>。</p>
<blockquote>
<p><code>@RestClientTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#test-auto-configuration" target="_blank" rel="noopener">在附录中找到</a>启用的自动配置设置列表。</p>
</blockquote>
<p>应使用<code>value</code>or <code>components</code>属性指定要测试的特定bean <code>@RestClientTest</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@RestClientTest</span>(RemoteVehicleDetailsService.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleRestClientTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> RemoteVehicleDetailsService service;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> MockRestServiceServer server;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getVehicleDetailsWhenResultIsSuccessShouldReturnDetails</span><span class="params">()</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.server.expect(requestTo(<span class="string">"/greet/details"</span>))</span><br><span class="line">				.andRespond(withSuccess(<span class="string">"hello"</span>, MediaType.TEXT_PLAIN));</span><br><span class="line">		String greeting = <span class="keyword">this</span>.service.callRestService();</span><br><span class="line">		assertThat(greeting).isEqualTo(<span class="string">"hello"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自动配置的Spring-REST-Docs测试"><a href="#自动配置的Spring-REST-Docs测试" class="headerlink" title="自动配置的Spring REST Docs测试"></a>自动配置的Spring REST Docs测试</h3><p>您可以使用<code>@AutoConfigureRestDocs</code>注释在Mock MVC，REST Assured或WebTestClient的测试中使用<a href="https://projects.spring.io/spring-restdocs/" target="_blank" rel="noopener">Spring REST Docs</a>。它消除了对Spring REST Docs中JUnit规则的需求。</p>
<p><code>@AutoConfigureRestDocs</code>可用于覆盖默认输出目录（<code>target/generated-snippets</code>如果您使用的是Maven，或者<code>build/generated-snippets</code>如果您使用的是Gradle）。它还可用于配置出现在任何已记录的URI中的主机，方案和端口。</p>
<h4 id="使用Mock-MVC自动配置Spring-REST-Docs测试"><a href="#使用Mock-MVC自动配置Spring-REST-Docs测试" class="headerlink" title="使用Mock MVC自动配置Spring REST Docs测试"></a>使用Mock MVC自动配置Spring REST Docs测试</h4><p><code>@AutoConfigureRestDocs</code>自定义<code>MockMvc</code>bean以使用Spring REST Docs。您可以<code>@Autowired</code>像在通常使用Mock MVC和Spring REST Docs时那样在测试中使用它来注入它，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@WebMvcTest</span>(UserController.class)</span><br><span class="line"><span class="meta">@AutoConfigureRestDocs</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDocumentationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listUsers</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mvc.perform(get(<span class="string">"/users"</span>).accept(MediaType.TEXT_PLAIN))</span><br><span class="line">				.andExpect(status().isOk())</span><br><span class="line">				.andDo(document(<span class="string">"list-users"</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果您需要对Spring REST Docs配置的更多控制而不是属性提供，则<code>@AutoConfigureRestDocs</code>可以使用 <code>RestDocsMockMvcConfigurationCustomizer</code>bean，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestConfiguration</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomizationConfiguration</span></span></span><br><span class="line"><span class="class">		<span class="keyword">implements</span> <span class="title">RestDocsMockMvcConfigurationCustomizer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(MockMvcRestDocumentationConfigurer configurer)</span> </span>&#123;</span><br><span class="line">		configurer.snippets().withTemplateFormat(TemplateFormats.markdown());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要对参数化输出目录使用Spring REST Docs支持，可以创建<code>RestDocumentationResultHandler</code>bean。自动配置<code>alwaysDo</code>使用此结果处理程序调用 ，从而使每个<code>MockMvc</code>调用自动生成默认代码段。以下示例显示了 <code>RestDocumentationResultHandler</code>正在定义的内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestConfiguration</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultHandlerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RestDocumentationResultHandler <span class="title">restDocumentation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> MockMvcRestDocumentation.document(<span class="string">"&#123;method-name&#125;"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用REST-Assured自动配置Spring-REST-Docs测试"><a href="#使用REST-Assured自动配置Spring-REST-Docs测试" class="headerlink" title="使用REST Assured自动配置Spring REST Docs测试"></a>使用REST Assured自动配置Spring REST Docs测试</h4><p><code>@AutoConfigureRestDocs</code>制作一个<code>RequestSpecification</code>预先配置为使用Spring REST Docs 的bean，可用于您的测试。您可以<code>@Autowired</code>像在通常使用REST Assured和Spring REST Doc时那样在测试中使用它来注入它，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.restassured.specification.RequestSpecification;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest.WebEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.server.LocalServerPort;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.restassured.RestAssured.given;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.is;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.restdocs.restassured3.RestAssuredRestDocumentation.document;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span>(webEnvironment = WebEnvironment.RANDOM_PORT)</span><br><span class="line"><span class="meta">@AutoConfigureRestDocs</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDocumentationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@LocalServerPort</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> RequestSpecification documentationSpec;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		given(<span class="keyword">this</span>.documentationSpec).filter(document(<span class="string">"list-users"</span>)).when()</span><br><span class="line">				.port(<span class="keyword">this</span>.port).get(<span class="string">"/"</span>).then().assertThat().statusCode(is(<span class="number">200</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果您需要对Spring REST Docs配置的更多控制而不是属性提供<code>@AutoConfigureRestDocs</code>，<code>RestDocsRestAssuredConfigurationCustomizer</code> 则可以使用bean，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomizationConfiguration</span></span></span><br><span class="line"><span class="class">		<span class="keyword">implements</span> <span class="title">RestDocsRestAssuredConfigurationCustomizer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(RestAssuredRestDocumentationConfigurer configurer)</span> </span>&#123;</span><br><span class="line">		configurer.snippets().withTemplateFormat(TemplateFormats.markdown());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="附加自动配置和切片"><a href="#附加自动配置和切片" class="headerlink" title="附加自动配置和切片"></a>附加自动配置和切片</h3><p>每个切片提供一个或多个<code>@AutoConfigure…</code>注释，即定义应作为切片的一部分包括的自动配置。可以通过创建自定义<code>@AutoConfigure…</code>注释或仅通过添加<code>@ImportAutoConfiguration</code>到测试来添加其他自动配置，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@JdbcTest</span></span><br><span class="line"><span class="meta">@ImportAutoConfiguration</span>(IntegrationAutoConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleJdbcTests</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>确保不使用常规<code>@Import</code>注释来导入自动配置，因为Spring Boot会以特定方式处理它们。</p>
</blockquote>
<h3 id="用户配置和切片"><a href="#用户配置和切片" class="headerlink" title="用户配置和切片"></a>用户配置和切片</h3><p>如果以合理的方式<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#using-boot-structuring-your-code" target="_blank" rel="noopener">构造代码</a>，<code>@SpringBootApplication</code>则<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-detecting-config" target="_blank" rel="noopener">默认情况下</a>会将您的 类 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-detecting-config" target="_blank" rel="noopener">用作</a>测试的配置。</p>
<p>然后，重要的是不要使用特定于其功能的特定区域的配置设置来丢弃应用程序的主类。</p>
<p>假设您正在使用Spring Batch并依赖于它的自动配置。您可以<code>@SpringBootApplication</code>按如下方式定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableBatchProcessing</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleApplication</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>因为此类是测试的源配置，所以任何切片测试实际上都会尝试启动Spring Batch，这绝对不是您想要做的。建议的方法是将特定于区域的配置移动到与<code>@Configuration</code>应用程序相同级别的单独类中，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableBatchProcessing</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BatchConfiguration</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>根据应用程序的复杂程度，您可能只有一个 <code>@Configuration</code>类用于自定义，或者每个域区域有一个类。后一种方法允许您在必要时使用<code>@Import</code>注释在其中一个测试中启用它。</p>
</blockquote>
<p>混淆的另一个原因是类路径扫描。假设您以合理的方式构建代码，则需要扫描其他包。您的应用程序可能类似于以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(&#123; <span class="string">"com.example.app"</span>, <span class="string">"org.acme.another"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleApplication</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>这样做会有效地覆盖默认组件扫描指令，并且无论您选择哪个切片，都会扫描这两个包。例如， <code>@DataJpaTest</code>似乎突然扫描了应用程序的组件和用户配置。同样，将自定义指令移动到单独的类是解决此问题的好方法。</p>
<blockquote>
<p>如果这不是您的选项，您可以<code>@SpringBootConfiguration</code> 在测试的层次结构中创建一个位置，以便使用它。或者，您可以为测试指定源，这会禁用查找默认源的行为。</p>
</blockquote>
<h3 id="使用Spock测试Spring-Boot应用程序"><a href="#使用Spock测试Spring-Boot应用程序" class="headerlink" title="使用Spock测试Spring Boot应用程序"></a>使用Spock测试Spring Boot应用程序</h3><p>如果您希望使用Spock来测试Spring Boot应用程序，您应该将Spock <code>spock-spring</code>模块的依赖项添加到应用程序的构建中。<code>spock-spring</code>将Spring的测试框架集成到Spock中。建议您使用Spock 1.2或更高版本从Spock的Spring Framework和Spring Boot集成的许多改进中受益。有关更多详细信息，请参阅<a href="http://spockframework.org/spock/docs/1.2/modules.html#_spring_module" target="_blank" rel="noopener">Spock Spring模块的文档</a>。</p>
<h2 id="测试应用程序"><a href="#测试应用程序" class="headerlink" title="测试应用程序"></a>测试应用程序</h2><p>在测试应用程序时通常有用的一些测试实用程序类是作为其一部分打包的<code>spring-boot</code>。</p>
<h3 id="ConfigFileApplicationContextInitializer"><a href="#ConfigFileApplicationContextInitializer" class="headerlink" title="ConfigFileApplicationContextInitializer"></a>ConfigFileApplicationContextInitializer</h3><p><code>ConfigFileApplicationContextInitializer</code>是一个<code>ApplicationContextInitializer</code>可以应用于测试以加载Spring Boot <code>application.properties</code>文件的。当您不需要提供的全部功能时，可以使用它<code>@SpringBootTest</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ContextConfiguration</span>(classes = Config.class,</span><br><span class="line">	initializers = ConfigFileApplicationContextInitializer.class)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>ConfigFileApplicationContextInitializer</code>单独使用不提供<code>@Value(&quot;${…}&quot;)</code>注射支持 。它唯一的工作是确保将<code>application.properties</code>文件加载到Spring中<code>Environment</code>。要获得<code>@Value</code>支持，您需要另外配置<code>PropertySourcesPlaceholderConfigurer</code>或使用<code>@SpringBootTest</code>，为您自动配置一个。</p>
</blockquote>
<h3 id="TestPropertyValues"><a href="#TestPropertyValues" class="headerlink" title="TestPropertyValues"></a>TestPropertyValues</h3><p><code>TestPropertyValues</code>让您快速添加属性 <code>ConfigurableEnvironment</code>或<code>ConfigurableApplicationContext</code>。您可以使用<code>key=value</code>字符串调用它 ，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TestPropertyValues.of(<span class="string">"org=Spring"</span>, <span class="string">"name=Boot"</span>).applyTo(env);</span><br></pre></td></tr></table></figure>
<h3 id="OutputCapture"><a href="#OutputCapture" class="headerlink" title="OutputCapture"></a>OutputCapture</h3><p><code>OutputCapture</code>是一个<code>Rule</code>可以用来捕获<code>System.out</code>和 <code>System.err</code>输出的JUnit 。您可以将捕获声明为a <code>@Rule</code>然后<code>toString()</code> 用于断言，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Rule;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.rule.OutputCapture;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Rule</span></span><br><span class="line">	<span class="keyword">public</span> OutputCapture capture = <span class="keyword">new</span> OutputCapture();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testName</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Hello World!"</span>);</span><br><span class="line">		assertThat(capture.toString(), containsString(<span class="string">"World"</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="TestRestTemplate"><a href="#TestRestTemplate" class="headerlink" title="TestRestTemplate"></a>TestRestTemplate</h3><blockquote>
<p>Spring Framework 5.0提供了一个<code>WebTestClient</code>适用于 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests" target="_blank" rel="noopener">WebFlux集成测试</a>以及 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener">WebFlux和MVC端到端测试的新功能</a>。它提供了一个流畅的断言API，不像<code>TestRestTemplate</code>。</p>
</blockquote>
<p><code>TestRestTemplate</code>是Spring的便捷替代品，<code>RestTemplate</code>在集成测试中很有用。您可以获得一个vanilla模板或一个发送基本HTTP身份验证（使用用户名和密码）的模板。在任何一种情况下，模板都以一种测试友好的方式运行，不会在服务器端错误上抛出异常。建议（但不是强制性的）使用Apache HTTP Client（版本4.3.2或更高版本）。如果您在类路径中有这个，则<code>TestRestTemplate</code>通过适当地配置客户端来响应。如果您确实使用Apache的HTTP客户端，则启用一些其他测试友好功能：</p>
<ul>
<li>不遵循重定向（因此您可以断言响应位置）。</li>
<li>Cookie被忽略（因此模板是无状态的）。</li>
</ul>
<p><code>TestRestTemplate</code> 可以直接在集成测试中实例化，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> TestRestTemplate template = <span class="keyword">new</span> TestRestTemplate();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRequest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		HttpHeaders headers = <span class="keyword">this</span>.template</span><br><span class="line">            .getForEntity(<span class="string">"http://myhost.example.com/example"</span>, String.class)</span><br><span class="line">            .getHeaders();</span><br><span class="line">		assertThat(headers.getLocation()).hasHost(<span class="string">"other.example.com"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者，如果您使用或使用<code>@SpringBootTest</code>注释 ，则可以注入完全配置并开始使用它。如有必要，可以通过bean 应用其他自定义。任何未指定主机和端口的URL都会自动连接到嵌入式服务器，<code>WebEnvironment.RANDOM_PORT</code> <code>WebEnvironment.DEFINED_PORT</code> <code>TestRestTemplate</code> <code>RestTemplateBuilder</code>如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span>(webEnvironment = WebEnvironment.RANDOM_PORT)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleWebClientTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TestRestTemplate template;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		HttpHeaders headers = <span class="keyword">this</span>.template.getForEntity(<span class="string">"/example"</span>, String.class)</span><br><span class="line">				.getHeaders();</span><br><span class="line">		assertThat(headers.getLocation()).hasHost(<span class="string">"other.example.com"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@TestConfiguration</span></span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> RestTemplateBuilder <span class="title">restTemplateBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> RestTemplateBuilder().setConnectTimeout(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">					.setReadTimeout(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><a class="button-hover more" href="/2019/03/21/使用SpringBott-test/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-JMX的监测和管理/">使用SpringBoot-JMX的监测和管理</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/jmx/">jmx</a></div></div><div class="post-content"><div class="main-content content"><h1 id="对JMX的监测和管理"><a href="#对JMX的监测和管理" class="headerlink" title="对JMX的监测和管理"></a>对JMX的监测和管理</h1><p>Java Management Extensions（JMX）提供了一种监视和管理应用程序的标准机制。Spring Boot公开了最适合<code>MBeanServer</code>作为ID为的bean <code>mbeanServer</code>。您的任何豆被标注有春天JMX注释（ <code>@ManagedResource</code>，<code>@ManagedAttribute</code>，或<code>@ManagedOperation</code>）接触到它。</p>
<p>如果您的平台提供标准<code>MBeanServer</code>，Spring Boot将使用它，并<code>MBeanServer</code>在必要时默认使用VM 。如果全部失败，<code>MBeanServer</code>将创建一个新的。</p>
<p>有关详细信息，请参阅 课程<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jmx/JmxAutoConfiguration.java" target="_blank" rel="noopener"><code>JmxAutoConfiguration</code></a>。</p>
</div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-JMX的监测和管理/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-Integration和Session/">使用SpringBoot-Integration和Session</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/integration/">integration</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/session/">session</a></div></div><div class="post-content"><div class="main-content content"><h1 id="Spring-Integration-整合"><a href="#Spring-Integration-整合" class="headerlink" title="Spring Integration(整合)"></a>Spring Integration(整合)</h1><p>Spring Boot为使用<a href="https://projects.spring.io/spring-integration/" target="_blank" rel="noopener">Spring Integration</a>提供了一些便利，包括<code>spring-boot-starter-integration</code>“Starter”。Spring Integration提供了有关消息传递以及其他传输（如HTTP，TCP等）的抽象。如果类路径上有Spring Integration，则通过<code>@EnableIntegration</code>注释初始化它。</p>
<p>Spring Boot还配置了一些由于存在其他Spring Integration模块而触发的功能。如果<code>spring-integration-jmx</code>也在类路径上，则通过JMX发布消息处理统计信息。如果<code>spring-integration-jdbc</code>可用，则可以在启动时创建默认数据库模式，如以下行所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.integration.jdbc.initialize-schema = always</span><br></pre></td></tr></table></figure>
<p>有关 详细信息，请参阅 <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/integration/IntegrationAutoConfiguration.java" target="_blank" rel="noopener"><code>IntegrationAutoConfiguration</code></a> 和<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/integration/IntegrationProperties.java" target="_blank" rel="noopener"><code>IntegrationProperties</code></a>类。</p>
<p>默认情况下，如果存在千分尺<code>meterRegistry</code>bean，则由Micrometer管理Spring Integration指标。如果您希望使用旧版Spring Integration度量标准，请将<code>DefaultMetricsFactory</code>bean 添加到应用程序上下文中。</p>
<h1 id="Spring-Session"><a href="#Spring-Session" class="headerlink" title="Spring Session"></a>Spring Session</h1><p>Spring Boot为各种数据存储提供<a href="https://projects.spring.io/spring-session/" target="_blank" rel="noopener">Spring Session</a>自动配置。构建Servlet Web应用程序时，可以自动配置以下存储：</p>
<ul>
<li>JDBC</li>
<li>Redis</li>
<li>Hazelcast</li>
<li>MongoDB</li>
</ul>
<p>构建响应式Web应用程序时，可以自动配置以下存储：</p>
<ul>
<li>Redis</li>
<li>MongoDB</li>
</ul>
<p>如果类路径上存在单个Spring Session模块，则Spring Boot会自动使用该存储实现。如果您有多个实现，则必须选择<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/session/StoreType.java" target="_blank" rel="noopener"><code>StoreType</code></a>要用于存储会话的实现。例如，要使用JDBC作为后端存储，您可以按如下方式配置应用程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.session.store-type=jdbc</span><br></pre></td></tr></table></figure>
<blockquote>
<p>您可以通过设置禁用春季会议<code>store-type</code>到<code>none</code>。</p>
</blockquote>
<p>每个商店都有特定的附加设置。例如，可以为JDBC存储定制表的名称，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.session.jdbc.table-name=SESSIONS</span><br></pre></td></tr></table></figure>
<p>要设置会话超时，可以使用该<code>spring.session.timeout</code>属性。如果未设置该属性，则自动配置将回退到值 <code>server.servlet.session.timeout</code>。</p>
</div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-Integration和Session/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-Quartz/">使用SpringBoot-Quartz</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/quartz/">quartz</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/schedul/">schedul</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/task/">task</a></div></div><div class="post-content"><div class="main-content content"><h1 id="Quartz-Scheduler"><a href="#Quartz-Scheduler" class="headerlink" title="Quartz Scheduler"></a>Quartz Scheduler</h1><p>Spring Boot为使用<a href="http://www.quartz-scheduler.org/" target="_blank" rel="noopener">Quartz调度程序</a>提供了一些便利 ，包括 <code>spring-boot-starter-quartz</code>“Starter”。如果Quartz可用，<code>Scheduler</code>则自动配置a（通过<code>SchedulerFactoryBean</code>抽象）。</p>
<p>自动拾取以下类型的豆并与以下相关联 <code>Scheduler</code>：</p>
<ul>
<li><code>JobDetail</code>：定义一个特定的Job。<code>JobDetail</code>可以使用<code>JobBuilder</code>API 构建实例 。</li>
<li><code>Calendar</code>。</li>
<li><code>Trigger</code>：定义何时触发特定作业。</li>
</ul>
<p>默认情况下，使用内存<code>JobStore</code>。但是，如果<code>DataSource</code>应用程序中有bean可用，并且相应地<code>spring.quartz.job-store-type</code>配置了 属性，则可以配置基于JDBC的存储，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.quartz.job-store-type=jdbc</span><br></pre></td></tr></table></figure>
<p>使用JDBC存储时，可以在启动时初始化模式，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.quartz.jdbc.initialize-schema=always</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认情况下，使用Quartz库提供的标准脚本检测并初始化数据库。这些脚本删除现有表，在每次重启时删除所有触发器。也可以通过设置<code>spring.quartz.jdbc.schema</code>属性来提供自定义脚本 。</p>
</blockquote>
<p>要让Quartz使用<code>DataSource</code>除应用程序main之外的其他东西<code>DataSource</code>，请声明一个<code>DataSource</code>bean，用它来注释其<code>@Bean</code>方法<code>@QuartzDataSource</code>。这样做可确保 架构初始化和架构初始化<code>DataSource</code>都使用Quartz特定的<code>SchedulerFactoryBean</code>。</p>
<p>默认情况下，配置创建的作业不会覆盖已从永久性作业存储读取的已注册作业。要启用覆盖现有作业定义，请设置该<code>spring.quartz.overwrite-existing-jobs</code>属性。</p>
<p>可以使用<code>spring.quartz</code>属性和 <code>SchedulerFactoryBeanCustomizer</code>bean 自定义Quartz Scheduler配置，这允许进行编程<code>SchedulerFactoryBean</code> 自定义。可以使用高级Quartz配置属性进行自定义 <code>spring.quartz.properties.*</code>。</p>
<blockquote>
<p>特别是，<code>Executor</code>bean不与调度程序相关联，因为Quartz提供了一种通过配置调度程序的方法<code>spring.quartz.properties</code>。如果需要自定义任务执行程序，请考虑实现<code>SchedulerFactoryBeanCustomizer</code>。</p>
</blockquote>
<p>作业可以定义setter以注入数据映射属性。也可以以类似的方式注入常规bean，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleJob</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> MyService myService;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Inject "MyService" bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyService</span><span class="params">(MyService myService)</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Inject the "name" job data property</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="任务执行和调度"><a href="#任务执行和调度" class="headerlink" title="任务执行和调度"></a>任务执行和调度</h1><p>在<code>Executor</code>上下文中没有bean的情况下，Spring Boot会自动配置一个 <code>ThreadPoolTaskExecutor</code>合理的默认值，这些默认值可以自动关联到异步任务执行（<code>@EnableAsync</code>）和Spring MVC异步请求处理。</p>
<blockquote>
<p>如果您<code>Executor</code>在上下文中定义了自定义，则常规任务执行（即 <code>@EnableAsync</code>）将透明地使用它，但不会配置Spring MVC支持，因为它需要<code>AsyncTaskExecutor</code>实现（命名 <code>applicationTaskExecutor</code>）。根据您的目标安排，您可以将您更改 <code>Executor</code>为a <code>ThreadPoolTaskExecutor</code>或定义a <code>ThreadPoolTaskExecutor</code>和<code>AsyncConfigurer</code>包装自定义<code>Executor</code>。</p>
<p>自动配置<code>TaskExecutorBuilder</code>允许您轻松创建实例，以重现默认情况下自动配置的功能。</p>
</blockquote>
<p>线程池使用8个核心线程，可根据负载增长和缩小。可以使用<code>spring.task.execution</code>命名空间对这些默认设置进行微调，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.task.execution.pool.max-threads=16</span><br><span class="line">spring.task.execution.pool.queue-capacity=100</span><br><span class="line">spring.task.execution.pool.keep-alive=10s</span><br></pre></td></tr></table></figure>
<p>这会将线程池更改为使用有界队列，以便在队列满（100个任务）时，线程池增加到最多16个线程。当线程在闲置10秒（而不是默认为60秒）时回收线程时，池的收缩会更加激进。</p>
<p><code>ThreadPoolTaskScheduler</code>如果需要与计划任务执行（<code>@EnableScheduling</code>）相关联，也可以自动配置A. 默认情况下，线程池使用一个线程，并且可以使用<code>spring.task.scheduling</code>命名空间对这些设置进行微调。</p>
<p>既是<code>TaskExecutorBuilder</code>豆和<code>TaskSchedulerBuilder</code>绿豆可在上下文提供如果自定义遗嘱执行人或调度需要创建。</p>
</div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-Quartz/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-Hazelcast/">使用SpringBoot-Hazelcast</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/hazelcast/">hazelcast</a></div></div><div class="post-content"><div class="main-content content"><h1 id="Hazelcast"><a href="#Hazelcast" class="headerlink" title="Hazelcast"></a>Hazelcast</h1><p>如果<a href="https://hazelcast.com/" target="_blank" rel="noopener">Hazelcast</a>位于类路径上并找到合适的配置，则Spring Boot会自动配置<code>HazelcastInstance</code>您可以在应用程序中注入的内容。</p>
<p>如果你定义一个<code>com.hazelcast.config.Config</code>bean，Spring Boot会使用它。如果您的配置定义了实例名称，Spring Boot会尝试查找现有实例，而不是创建新实例。</p>
<p>您还可以指定<code>hazelcast.xml</code>要通过配置使用的配置文件，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.hazelcast.config = classpath：config / my-hazelcast.xml</span><br></pre></td></tr></table></figure>
<p>否则，Spring Boot会尝试从默认位置查找Hazelcast配置：<code>hazelcast.xml</code>在工作目录中或类路径的根目录。我们还检查是否<code>hazelcast.config</code>设置了系统属性。有关更多详细信息，请参阅 <a href="http://docs.hazelcast.org/docs/latest/manual/html-single/" target="_blank" rel="noopener">Hazelcast文档</a>。</p>
<p>如果<code>hazelcast-client</code>类路径中存在，则Spring Boot首先尝试通过检查以下配置选项来创建客户端：</p>
<ul>
<li><code>com.hazelcast.client.config.ClientConfig</code>豆的存在。</li>
<li>由<code>spring.hazelcast.config</code>属性定义的配置文件。</li>
<li><code>hazelcast.client.config</code>系统属性的存在。</li>
<li><code>hazelcast-client.xml</code>在工作目录中或类路径的根目录。</li>
</ul>
<blockquote>
<p>Spring Boot还为<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-hazelcast" target="_blank" rel="noopener">Hazelcast</a>提供了 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-hazelcast" target="_blank" rel="noopener">明确的缓存支持</a>。如果启用了缓存，<code>HazelcastInstance</code>则会自动将其包装在<code>CacheManager</code> 实现中。</p>
</blockquote>
</div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-Hazelcast/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-JTA的分布式事务/">使用SpringBoot-JTA的分布式事务</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/jta/">jta</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/atomikos/">atomikos</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/bitronix/">bitronix</a></div></div><div class="post-content"><div class="main-content content"><h1 id="JTA的分布式事务"><a href="#JTA的分布式事务" class="headerlink" title="JTA的分布式事务"></a>JTA的分布式事务</h1><p>Spring Boot通过使用<a href="http://www.atomikos.com/" target="_blank" rel="noopener">Atomikos</a>或<a href="https://github.com/bitronix/btm" target="_blank" rel="noopener">Bitronix</a> 嵌入式事务管理器支持跨多个XA资源的分布式JTA事务。部署到合适的Java EE Application Server时，也支持JTA事务。</p>
<p>检测到JTA环境时，Spring <code>JtaTransactionManager</code>用于管理事务。自动配置的JMS，DataSource和JPA bean已升级为支持XA事务。您可以使用标准的Spring惯用语，例如<code>@Transactional</code>，参与分布式事务。如果您在JTA环境中并仍希望使用本地事务，则可以将该<code>spring.jta.enabled</code>属性设置<code>false</code>为禁用JTA自动配置。</p>
<h2 id="使用Atomikos事务管理器"><a href="#使用Atomikos事务管理器" class="headerlink" title="使用Atomikos事务管理器"></a>使用Atomikos事务管理器</h2><p><a href="https://www.atomikos.com/" target="_blank" rel="noopener">Atomikos</a>是一个流行的开源事务管理器，可以嵌入到Spring Boot应用程序中。您可以使用 <code>spring-boot-starter-jta-atomikos</code>Starter引入相应的Atomikos库。Spring Boot自动配置Atomikos并确保将适当的<code>depends-on</code>设置应用于Spring bean以正确启动和关闭顺序。</p>
<p>默认情况下，Atomikos事务日志将写入<code>transaction-logs</code>应用程序主目录（应用程序jar文件所在的目录）中的目录。您可以通过<code>spring.jta.log-dir</code>在<code>application.properties</code>文件中设置属性来自定义此目录的位置 。以…开头的属性<code>spring.jta.atomikos.properties</code>也可用于自定义Atomikos<code>UserTransactionServiceImp</code>。有关 完整的详细信息，请参阅 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api/org/springframework/boot/jta/atomikos/AtomikosProperties.html" target="_blank" rel="noopener"><code>AtomikosProperties</code>Javadoc</a>。</p>
<blockquote>
<p>为确保多个事务管理器可以安全地协调相同的资源管理器，必须使用唯一ID配置每个Atomikos实例。默认情况下，此ID是运行Atomikos的计算机的IP地址。要确保生产中的唯一性，应<code>spring.jta.transaction-manager-id</code> 为应用程序的每个实例配置具有不同值的属性。</p>
</blockquote>
<h2 id="使用Bitronix事务管理器"><a href="#使用Bitronix事务管理器" class="headerlink" title="使用Bitronix事务管理器"></a>使用Bitronix事务管理器</h2><p><a href="https://github.com/bitronix/btm" target="_blank" rel="noopener">Bitronix</a>是一种流行的开源JTA事务管理器实现。您可以使用<code>spring-boot-starter-jta-bitronix</code>starter将适当的Bitronix依赖项添加到项目中。与Atomikos一样，Spring Boot会自动配置Bitronix并对bean进行后处理，以确保启动和关闭顺序正确。</p>
<p>默认情况下，Bitronix事务日志文件（<code>part1.btm</code>和<code>part2.btm</code>）将写入<code>transaction-logs</code>应用程序主目录中的目录。您可以通过设置<code>spring.jta.log-dir</code>属性来自定义此目录的位置。以…开头的属性<code>spring.jta.bitronix.properties</code>也绑定到 <code>bitronix.tm.Configuration</code>bean，允许完全自定义。有关详细信息，请参阅 <a href="https://github.com/bitronix/btm/wiki/Transaction-manager-configuration" target="_blank" rel="noopener">Bitronix文档</a>。</p>
<blockquote>
<p>为确保多个事务管理器可以安全地协调相同的资源管理器，必须为每个Bitronix实例配置唯一ID。默认情况下，此ID是运行Bitronix的计算机的IP地址。要确保生产中的唯一性，应<code>spring.jta.transaction-manager-id</code> 为应用程序的每个实例配置具有不同值的属性。</p>
</blockquote>
<h2 id="使用Java-EE托管事务管理器"><a href="#使用Java-EE托管事务管理器" class="headerlink" title="使用Java EE托管事务管理器"></a>使用Java EE托管事务管理器</h2><p>如果将Spring Boot应用程序打包为一个<code>war</code>或一个<code>ear</code>文件并将其部署到Java EE应用程序服务器，则可以使用应用程序服务器的内置事务管理器。Spring Boot尝试通过查看常见的JNDI位置（<code>java:comp/UserTransaction</code>，<code>java:comp/TransactionManager</code>等等）来自动配置事务管理器。如果使用应用程序服务器提供的事务服务，通常还需要确保所有资源都由服务器管理并通过JNDI公开。Spring Boot尝试通过查找<code>ConnectionFactory</code>JNDI路径（<code>java:/JmsXA</code>或<code>java:/XAConnectionFactory</code>）来自动配置JMS ，您可以使用该 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-connecting-to-a-jndi-datasource" target="_blank" rel="noopener"><code>spring.datasource.jndi-name</code>属性</a> 来配置您的<code>DataSource</code>。</p>
<h2 id="混合XA和非XA-JMS连接"><a href="#混合XA和非XA-JMS连接" class="headerlink" title="混合XA和非XA JMS连接"></a>混合XA和非XA JMS连接</h2><p>使用JTA时，主JMS <code>ConnectionFactory</code>bean可识别XA并参与分布式事务。在某些情况下，您可能希望使用非XA处理某些JMS消息<code>ConnectionFactory</code>。例如，您的JMS处理逻辑可能需要比XA超时更长的时间。</p>
<p>如果要使用非XA <code>ConnectionFactory</code>，可以注入 <code>nonXaJmsConnectionFactory</code>bean而不是<code>@Primary</code> <code>jmsConnectionFactory</code>bean。为了保持一致性，<code>jmsConnectionFactory</code>还使用bean别名提供bean <code>xaJmsConnectionFactory</code>。</p>
<p>以下示例显示了如何注入<code>ConnectionFactory</code>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注入主（XA感知）ConnectionFactory</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ConnectionFactory defaultConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注入XA感知ConnectionFactory（使用别名并注入与上面相同的内容）</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier</span>(<span class="string">"xaJmsConnectionFactory"</span>)</span><br><span class="line"><span class="keyword">private</span> ConnectionFactory xaConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注入非XA感知的ConnectionFactory</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier</span>(<span class="string">"nonXaJmsConnectionFactory"</span>)</span><br><span class="line"><span class="keyword">private</span> ConnectionFactory nonXaConnectionFactory;</span><br></pre></td></tr></table></figure>
<h2 id="支持替代嵌入式事务管理器"><a href="#支持替代嵌入式事务管理器" class="headerlink" title="支持替代嵌入式事务管理器"></a>支持替代嵌入式事务管理器</h2><p>该<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jms/XAConnectionFactoryWrapper.java" target="_blank" rel="noopener"><code>XAConnectionFactoryWrapper</code></a> 和<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jdbc/XADataSourceWrapper.java" target="_blank" rel="noopener"><code>XADataSourceWrapper</code></a>接口可用于支持替代嵌入式事务经理。接口负责包装<code>XAConnectionFactory</code>和<code>XADataSource</code>bean，并将它们作为常规<code>ConnectionFactory</code>和<code>DataSource</code>bean 公开，它们透明地注册到分布式事务中。DataSource和JMS自动配置使用JTA变体，前提是您有一个<code>JtaTransactionManager</code>bean和在您的域中注册的相应XA包装bean <code>ApplicationContext</code>。</p>
<p>该<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jta/bitronix/BitronixXAConnectionFactoryWrapper.java" target="_blank" rel="noopener">BitronixXAConnectionFactoryWrapper</a> 和<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jta/bitronix/BitronixXADataSourceWrapper.java" target="_blank" rel="noopener">BitronixXADataSourceWrapper</a> 提供了如何编写XA包装很好的例子。</p>
</div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-JTA的分布式事务/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-Mail/">使用SpringBoot-Mail</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/mail/">mail</a></div></div><div class="post-content"><div class="main-content content"><h1 id="Sending-Email"><a href="#Sending-Email" class="headerlink" title="Sending Email"></a>Sending Email</h1><p>Spring Framework提供了一个使用<code>JavaMailSender</code>界面发送电子邮件的简单抽象 ，Spring Boot为它提供了自动配置以及启动器模块。</p>
<blockquote>
<p>有关如何使用<code>JavaMailSender</code>的详细说明，请参阅<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/integration.html#mail" target="_blank" rel="noopener">参考文档</a>。</p>
</blockquote>
<p>如果<code>spring.mail.host</code>和相关库（由定义的 <code>spring-boot-starter-mail</code>）可用，<code>JavaMailSender</code>则创建默认值（如果不存在）。可以通过<code>spring.mail</code>命名空间中的配置项进一步自定义发送方 。有关<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mail/MailProperties.java" target="_blank" rel="noopener"><code>MailProperties</code></a>详细信息，请参阅</p>
<p>特别是，某些默认超时值是无限的，您可能希望更改它以避免线程被无响应的邮件服务器阻塞，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.mail.properties.mail.smtp.connectiontimeout=5000</span><br><span class="line">spring.mail.properties.mail.smtp.timeout=3000</span><br><span class="line">spring.mail.properties.mail.smtp.writetimeout=5000</span><br></pre></td></tr></table></figure>
<p>也可以<code>JavaMailSender</code>使用<code>Session</code>JNDI中的现有配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mail.jndi-name=mail/Session</span><br></pre></td></tr></table></figure>
<p>当<code>jndi-name</code>设置，它优先于所有其他会话相关的设置。</p>
</div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-Mail/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/03/21/使用SpringBoot-Validation/">使用SpringBoot-Validation</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-03-21</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/validation/">validation</a></div></div><div class="post-content"><div class="main-content content"><h1 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h1><p>只要JSR-303实现（例如Hibernate验证器）在类路径上，就会自动启用Bean Validation 1.1支持的方法验证功能。这使得bean方法可以使用<code>javax.validation</code>对其参数和/或返回值的约束进行注释。具有此类带注释方法的目标类需要使用<code>@Validated</code>类型级别的注释进行注释，以便搜索其内联约束注释的方法。</p>
<p>例如，以下服务触发第一个参数的验证，确保其大小在8到10之间：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Archive <span class="title">findByCodeAndAuthor</span><span class="params">(@Size(min = <span class="number">8</span>, max = <span class="number">10</span>)</span> String code,</span></span><br><span class="line"><span class="function">			Author author) </span>&#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div><a class="button-hover more" href="/2019/03/21/使用SpringBoot-Validation/#more">阅读全文</a></div></div><div id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fas fa-angle-right"></i></a></div></div></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fas fa-user"></i></span><span id="busuanzi_value_site_uv"></span><span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fas fa-eye"></i></span><span id="busuanzi_value_site_pv"></span><span></span></div><div class="copyright">&copy;2019 By YoungDream</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/clicklove.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>