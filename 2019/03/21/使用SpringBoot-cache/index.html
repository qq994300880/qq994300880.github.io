<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="使用SpringBoot-cache"><meta name="keywords" content="cache"><meta name="author" content="YoungDream,undefined"><meta name="copyright" content="YoungDream"><title>使用SpringBoot-cache【YD Blog】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!--link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!--link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!--script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"0BGAOITLJQ","apiKey":"2c864a8b4720c83c2ddfc7e53d4c1711","indexName":"article_NAME","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#缓存"><span class="toc-number">1.</span> <span class="toc-text">缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#支持的缓存提供程序"><span class="toc-number">1.1.</span> <span class="toc-text">支持的缓存提供程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Generic"><span class="toc-number">1.1.1.</span> <span class="toc-text">Generic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JCache（JSR-107）"><span class="toc-number">1.1.2.</span> <span class="toc-text">JCache（JSR-107）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EhCache-2-x"><span class="toc-number">1.1.3.</span> <span class="toc-text">EhCache 2.x</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hazelcast"><span class="toc-number">1.1.4.</span> <span class="toc-text">Hazelcast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Infinispan"><span class="toc-number">1.1.5.</span> <span class="toc-text">Infinispan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Couchbase"><span class="toc-number">1.1.6.</span> <span class="toc-text">Couchbase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis"><span class="toc-number">1.1.7.</span> <span class="toc-text">Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Caffeine"><span class="toc-number">1.1.8.</span> <span class="toc-text">Caffeine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Simple"><span class="toc-number">1.1.9.</span> <span class="toc-text">Simple</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#None"><span class="toc-number">1.1.10.</span> <span class="toc-text">None</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">YoungDream</div><div class="author-info-description">正忙着优秀~~~</div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/qq994300880" target="_blank">GitHub<i class="icon-dot bg-color6"></i></a><a class="links-button button-hover" href="http://wpa.qq.com/msgrd?v=3&amp;uin=994300880&amp;site=qq&amp;menu=yes" target="_blank">QQ<i class="icon-dot bg-color2"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">124</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">75</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">17</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">YD Blog</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">使用SpringBoot-cache</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-03-21 | 更新于 2019-03-30</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/springboot/">springboot</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/cache/">cache</a></div></div></div><div class="main-content"><h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><p>Spring Framework支持透明地向应用程序添加缓存。从本质上讲，抽象将缓存应用于方法，从而根据缓存中可用的信息减少执行次数。缓存逻辑是透明应用的，不会对调用者造成任何干扰。只要通过<code>@EnableCaching</code> 注释启用了缓存支持，Spring Boot就会自动配置缓存基础结构。</p>
<blockquote>
<p><a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/integration.html#cache" target="_blank" rel="noopener">有关</a>更多详细信息，请查看Spring Framework参考的<a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/integration.html#cache" target="_blank" rel="noopener">相关部分</a>。</p>
</blockquote>
<a id="more"></a>
<p>简而言之，将缓存添加到服务操作就像在其方法中添加相关注释一样简单，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MathService</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Cacheable</span>(<span class="string">"piDecimals"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">computePiDecimal</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此示例演示了如何在可能代价高昂的操作上使用缓存。在调用之前<code>computePiDecimal</code>，抽象会在<code>piDecimals</code>缓存中查找与<code>i</code>参数匹配的条目。如果找到条目，则缓存中的内容会立即返回给调用者，并且不会调用该方法。否则，将调用该方法，并在返回值之前更新缓存。</p>
<blockquote>
<p>您还可以<code>@CacheResult</code>透明地使用标准JSR-107（JCache）注释（例如 ）。但是，我们强烈建议您不要混淆和匹配Spring Cache和JCache注释。</p>
</blockquote>
<p>如果您不添加任何特定的缓存库，Spring Boot会自动配置一个在内存中使用并发映射的 <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-simple" target="_blank" rel="noopener">简单提供程序</a>。当需要缓存时（例如<code>piDecimals</code>在前面的示例中），此提供程序会为您创建缓存。简单的提供程序并不是真正推荐用于生产用途，但它非常适合入门并确保您了解这些功能。当您决定使用缓存提供程序时，请务必阅读其文档以了解如何配置应用程序使用的缓存。几乎所有提供程序都要求您显式配置在应用程序中使用的每个缓存。有些提供了一种自定义<code>spring.cache.cache-names</code>属性定义的默认缓存的方法。</p>
<blockquote>
<p>还可以透明地 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/integration.html#cache-annotations-put" target="_blank" rel="noopener">更新</a>或 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/integration.html#cache-annotations-evict" target="_blank" rel="noopener">逐出</a>缓存中的数据。</p>
</blockquote>
<h2 id="支持的缓存提供程序"><a href="#支持的缓存提供程序" class="headerlink" title="支持的缓存提供程序"></a>支持的缓存提供程序</h2><p>缓存抽象不提供实际存储，而是依赖于<code>org.springframework.cache.Cache</code>和 <code>org.springframework.cache.CacheManager</code>接口实现的抽象。</p>
<p>如果尚未定义类型的bean <code>CacheManager</code>或<code>CacheResolver</code>命名 的bean <code>cacheResolver</code>（请参阅参考资料 <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html" target="_blank" rel="noopener"><code>CachingConfigurer</code></a>），Spring Boot会尝试检测以下提供程序（按指示的顺序）：</p>
<ol>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-generic" target="_blank" rel="noopener">Generic</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-jcache" target="_blank" rel="noopener">JCache（JSR-107）</a>（EhCache 3，Hazelcast，Infinispan等）</li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-ehcache2" target="_blank" rel="noopener">EhCache 2.x</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-hazelcast" target="_blank" rel="noopener">Hazelcast</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-infinispan" target="_blank" rel="noopener">Infinispan</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-couchbase" target="_blank" rel="noopener">Couchbase</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-redis" target="_blank" rel="noopener">Redis</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-caffeine" target="_blank" rel="noopener">Caffeine</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-simple" target="_blank" rel="noopener">Simple</a></li>
</ol>
<blockquote>
<p>也可以通过设置属性来<em>强制</em>特定的缓存提供程序 <code>spring.cache.type</code>。如果您需要在某些环境（例如测试）中<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-caching-provider-none" target="_blank" rel="noopener">完全禁用缓存，</a>请使用此属性 。</p>
</blockquote>
<blockquote>
<p>使用<code>spring-boot-starter-cache</code>“Starter”快速添加基本缓存依赖项。首发引入<code>spring-context-support</code>。如果手动添加依赖项，则必须包括<code>spring-context-support</code>才能使用JCache，EhCache 2.x或Guava支持。</p>
</blockquote>
<p>如果<code>CacheManager</code>由Spring Boot自动配置，则可以通过公开实现该<code>CacheManagerCustomizer</code>接口的bean完全初始化之前进一步调整其配置 。以下示例设置一个标志，表示应将null值传递给底层映射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CacheManagerCustomizer&lt;ConcurrentMapCacheManager&gt; <span class="title">cacheManagerCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> CacheManagerCustomizer&lt;ConcurrentMapCacheManager&gt;() &#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConcurrentMapCacheManager cacheManager)</span> </span>&#123;</span><br><span class="line">			cacheManager.setAllowNullValues(<span class="keyword">false</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在前面的示例中，<code>ConcurrentMapCacheManager</code>预期会自动配置。如果不是这种情况（您提供了自己的配置或自动配置了不同的缓存提供程序），则根本不会调用自定义程序。您可以拥有任意数量的自定义程序，也可以使用<code>@Order</code>或订购它们<code>Ordered</code>。</p>
</blockquote>
<h3 id="Generic"><a href="#Generic" class="headerlink" title="Generic"></a>Generic</h3><p>如果上下文定义<em>至少</em>一个 <code>org.springframework.cache.Cache</code>bean，则使用通用高速缓存。将<code>CacheManager</code>创建包装该类型的所有bean。</p>
<h3 id="JCache（JSR-107）"><a href="#JCache（JSR-107）" class="headerlink" title="JCache（JSR-107）"></a>JCache（JSR-107）</h3><p><a href="https://jcp.org/en/jsr/detail?id=107" target="_blank" rel="noopener">JCache</a>通过<code>javax.cache.spi.CachingProvider</code>类路径上的存在（即类路径上存在符合JSR-107的缓存库）进行引导 ，<code>JCacheCacheManager</code>并由<code>spring-boot-starter-cache</code>“Starter”提供。可以使用各种兼容库，Spring Boot为Ehcache 3，Hazelcast和Infinispan提供依赖管理。还可以添加任何其他兼容库。</p>
<p>可能会出现多个提供程序，在这种情况下，必须明确指定提供程序。即使JSR-107标准没有强制执行定义配置文件位置的标准化方法，Spring Boot也会尽力满足设置缓存的实现细节，如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   #仅在存在多个提供程序时才需要</span><br><span class="line">spring.cache.jcache.provider=com.acme.MyCachingProvider</span><br><span class="line">spring.cache.jcache.config=classpath:acme.xml</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当缓存库同时提供本机实现和JSR-107支持时，Spring Boot更喜欢JSR-107支持，因此如果切换到不同的JSR-107实现，则可以使用相同的功能。</p>
</blockquote>
<blockquote>
<p>Spring Boot <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-hazelcast" target="_blank" rel="noopener">对Hazelcast</a>有<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-hazelcast" target="_blank" rel="noopener">一般支持</a>。如果单个<code>HazelcastInstance</code>可用，则<code>CacheManager</code>除非<code>spring.cache.jcache.config</code>指定了属性，否则它也会自动重复使用 。</p>
</blockquote>
<p>有两种方法可以自定义底层<code>javax.cache.cacheManager</code>：</p>
<ul>
<li>可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建缓存。如果定义了自定义<code>javax.cache.configuration.Configuration</code>bean，则会使用它来自定义它们。</li>
<li><code>org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer</code>使用<code>CacheManager</code>for完全自定义的引用调用bean 。</li>
</ul>
<blockquote>
<p>如果<code>javax.cache.CacheManager</code>定义了标准bean，它将自动包装在<code>org.springframework.cache.CacheManager</code>抽象所期望的实现中。没有进一步的自定义。</p>
</blockquote>
<h3 id="EhCache-2-x"><a href="#EhCache-2-x" class="headerlink" title="EhCache 2.x"></a>EhCache 2.x</h3><p>如果<code>ehcache.xml</code>可以在类路径的根目录中找到名为的文件，则使用<a href="http://www.ehcache.org/" target="_blank" rel="noopener">EhCache 2.x. </a>如果找到EhCache 2.x，则使用“Starter” <code>EhCacheCacheManager</code>提供的<code>spring-boot-starter-cache</code>引导缓存管理器。还可以提供备用配置文件，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.ehcache.config=classpath:config/another-config.xml</span><br></pre></td></tr></table></figure>
<h3 id="Hazelcast"><a href="#Hazelcast" class="headerlink" title="Hazelcast"></a>Hazelcast</h3><p>Spring Boot <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-hazelcast" target="_blank" rel="noopener">对Hazelcast</a>有<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-hazelcast" target="_blank" rel="noopener">一般支持</a>。如果a <code>HazelcastInstance</code>已自动配置，则会自动包装在a中 <code>CacheManager</code>。</p>
<h3 id="Infinispan"><a href="#Infinispan" class="headerlink" title="Infinispan"></a>Infinispan</h3><p><a href="http://infinispan.org/" target="_blank" rel="noopener">Infinispan</a>没有默认配置文件位置，因此必须明确指定。否则，使用默认引导程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.infinispan.config=infinispan.xml</span><br></pre></td></tr></table></figure>
<p>可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建缓存。如果定义了自定义<code>ConfigurationBuilder</code>bean，则它用于自定义缓存。</p>
<blockquote>
<p>Infinispan在Spring Boot中的支持仅限于嵌入式模式，非常基础。如果你想要更多选项，你应该使用官方的Infinispan Spring Boot启动器。有关更多详细信息，请参阅 <a href="https://github.com/infinispan/infinispan-spring-boot" target="_blank" rel="noopener">Infinispan的文档</a>。</p>
</blockquote>
<h3 id="Couchbase"><a href="#Couchbase" class="headerlink" title="Couchbase"></a>Couchbase</h3><p>如果<a href="https://www.couchbase.com/" target="_blank" rel="noopener">Couchbase</a> Java客户端和<code>couchbase-spring-cache</code> 实现可用且<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#boot-features-couchbase" target="_blank" rel="noopener">配置</a>了Couchbase ， <code>CouchbaseCacheManager</code>则会自动配置a。也可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建其他缓存。这些缓存在<code>Bucket</code>自动配置的情况下运行。您可以<em>还</em>创建另一个附加缓存中<code>Bucket</code>，通过使用定制。假设在“main” 和one（）缓存上需要两个缓存（<code>cache1</code>和 <code>cache2</code>），<code>Bucket</code>并且<code>cache3</code>“另一个”上的自定义时间为2秒<code>Bucket</code>。您可以通过配置创建前两个缓存，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.cache-names=cache1,cache2</span><br></pre></td></tr></table></figure>
<p>然后，您可以定义一个<code>@Configuration</code>类来配置额外<code>Bucket</code>和 <code>cache3</code>缓存，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouchbaseCacheConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Cluster cluster;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CouchbaseCacheConfiguration</span><span class="params">(Cluster cluster)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cluster = cluster;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Bucket <span class="title">anotherBucket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.cluster.openBucket(<span class="string">"another"</span>, <span class="string">"secret"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> CacheManagerCustomizer&lt;CouchbaseCacheManager&gt; <span class="title">cacheManagerCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> c -&gt; &#123;</span><br><span class="line">			c.prepareCache(<span class="string">"cache3"</span>, CacheBuilder.newInstance(anotherBucket())</span><br><span class="line">					.withExpiration(<span class="number">2</span>));</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此示例配置重用<code>Cluster</code>通过自动配置创建的配置。</p>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>如果<a href="http://redis.io/" target="_blank" rel="noopener">Redis</a>可用且已配置，<code>RedisCacheManager</code>则会自动配置。可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建其他缓存， 并可以使用<code>spring.cache.redis.*</code>属性配置缓存默认值 。例如，以下配置创建 <code>cache1</code>并<code>cache2</code>缓存10分钟的<em>生存</em>时间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.cache-names=cache1,cache2</span><br><span class="line">spring.cache.redis.time-to-live=600000</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认情况下，会添加一个键前缀，这样，如果两个单独的缓存使用相同的键，则Redis没有重叠键，也不能返回无效值。如果您创建自己的设置，我们强烈建议您启用此设置<code>RedisCacheManager</code>。</p>
</blockquote>
<blockquote>
<p>您可以通过添加<code>RedisCacheConfiguration</code> <code>@Bean</code>自己的配置来完全控制配置。如果您正在寻找自定义序列化策略，这可能很有用。</p>
</blockquote>
<h3 id="Caffeine"><a href="#Caffeine" class="headerlink" title="Caffeine"></a>Caffeine</h3><p><a href="https://github.com/ben-manes/caffeine" target="_blank" rel="noopener">Caffeine</a>是Java 8重写的Guava缓存，取代了对Guava的支持。如果存在Caffeine，则自动配置一个 <code>CaffeineCacheManager</code>（由<code>spring-boot-starter-cache</code>启动器提供）。可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建缓存，并且可以通过以下之一（按指示的顺序）自定义缓存：</p>
<ol>
<li>由…定义的缓存规范 <code>spring.cache.caffeine.spec</code></li>
<li><code>com.github.benmanes.caffeine.cache.CaffeineSpec</code>定义了一个bean</li>
<li><code>com.github.benmanes.caffeine.cache.Caffeine</code>定义了一个bean</li>
</ol>
<p>例如，以下配置创建<code>cache1</code>和<code>cache2</code>缓存，最大大小为500，<em>生存时间为</em> 10分钟</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.cache-names=cache1,cache2</span><br><span class="line">spring.cache.caffeine.spec=maximumSize=500,expireAfterAccess=600s</span><br></pre></td></tr></table></figure>
<p>如果<code>com.github.benmanes.caffeine.cache.CacheLoader</code>定义了bean，它将自动关联到<code>CaffeineCacheManager</code>。由于<code>CacheLoader</code>它将与缓存管理器管理的<em>所有</em>缓存相关联，因此必须将其定义为 <code>CacheLoader&lt;Object, Object&gt;</code>。自动配置忽略任何其他泛型类型。</p>
<h3 id="Simple"><a href="#Simple" class="headerlink" title="Simple"></a>Simple</h3><p>如果找不到其他提供程序，<code>ConcurrentHashMap</code>则配置使用一个作为缓存存储的简单实现 。如果应用程序中不存在缓存库，则这是默认值。默认情况下，会根据需要创建缓存，但您可以通过设置<code>cache-names</code>属性来限制可用缓存列表。例如，如果只需要<code>cache1</code>和<code>cache2</code>缓存，请<code>cache-names</code>按如下方式设置属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.cache-names=cache1,cache2</span><br></pre></td></tr></table></figure>
<p>如果这样做并且您的应用程序使用未列出的缓存，则在需要缓存时它会在运行时失败，但在启动时则不会。这类似于“真实”缓存提供程序在使用未声明的缓存时的行为方式。</p>
<h3 id="None"><a href="#None" class="headerlink" title="None"></a>None</h3><p>如果<code>@EnableCaching</code>配置中存在，则还需要合适的缓存配置。如果需要在某些环境中完全禁用缓存，请强制缓存类型<code>none</code>使用no-op实现，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.type=none</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">YoungDream</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="http://qq994300880.github.io/2019/03/21/使用SpringBoot-cache/">http://qq994300880.github.io/2019/03/21/使用SpringBoot-cache/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://qq994300880.github.io">YD Blog</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/03/21/使用SpringBoot-消息中间件/"><i class="fas fa-angle-left">&nbsp;</i><span>使用SpringBoot-消息中间件</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/03/21/使用SpringBoot-NoSQL数据库/"><span>使用SpringBoot-NoSQL数据库</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script><div id="gitalk-container"></div><script src="/js/gitalk.js"></script></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 By YoungDream</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/clicklove.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>